<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chameleon Card Studio | Create Beautiful Cards for Every Occasion</title>
    <meta name="description" content="Design stunning e-cards, foldable cards, invitations, and business cards with beautiful themes for all ages.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü¶é</text></svg>">
    <style>
:root {
    /* Core Colors */
    --bg: #faf9f7;
    --surface: #ffffff;
    --surface-alt: #f5f3f0;
    --border: #e5e2dd;
    --border-dark: #d0ccc5;
    --text: #2d2a26;
    --text-dim: #6b6560;
    --text-muted: #9a948c;
    
    /* Brand Colors */
    --primary: #e85d04;
    --primary-light: #fef0e6;
    --primary-dark: #bc4b03;
    --accent: #7c3aed;
    --accent-light: #f3eeff;
    --success: #059669;
    --success-light: #ecfdf5;
    --warning: #d97706;
    --error: #dc2626;
    
    /* Spacing & Sizing */
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 20px;
    --radius-xl: 28px;
    --radius-full: 9999px;
    
    /* Shadows */
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
    --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
    --shadow-lg: 0 12px 40px rgba(0,0,0,0.12);
    --shadow-xl: 0 24px 60px rgba(0,0,0,0.15);
    
    /* Typography */
    --font-display: 'Georgia', 'Times New Roman', serif;
    --font-body: system-ui, -apple-system, 'Segoe UI', sans-serif;
    
    /* Accessibility - Font Sizes (adjustable) */
    --text-xs: 12px;
    --text-sm: 14px;
    --text-base: 16px;
    --text-lg: 18px;
    --text-xl: 20px;
    --text-2xl: 24px;
    --text-3xl: 32px;
    --text-4xl: 40px;
}

/* Dark Mode */
[data-theme="dark"] {
    --bg: #1a1918;
    --surface: #252422;
    --surface-alt: #2d2b28;
    --border: #3d3a36;
    --border-dark: #4a4640;
    --text: #f5f3f0;
    --text-dim: #b5b0a8;
    --text-muted: #7a756d;
    --primary-light: #3d2a1a;
    --accent-light: #2a2040;
    --success-light: #1a2d25;
}

/* High Contrast Mode */
[data-contrast="high"] {
    --text: #000000;
    --text-dim: #333333;
    --border: #000000;
    --primary: #c44000;
}
[data-theme="dark"][data-contrast="high"] {
    --text: #ffffff;
    --text-dim: #cccccc;
    --border: #ffffff;
}

/* Large Text Mode */
[data-textsize="large"] {
    --text-xs: 14px;
    --text-sm: 16px;
    --text-base: 18px;
    --text-lg: 20px;
    --text-xl: 24px;
    --text-2xl: 28px;
    --text-3xl: 36px;
    --text-4xl: 48px;
}

[data-textsize="xlarge"] {
    --text-xs: 16px;
    --text-sm: 18px;
    --text-base: 20px;
    --text-lg: 24px;
    --text-xl: 28px;
    --text-2xl: 32px;
    --text-3xl: 42px;
    --text-4xl: 56px;
}

/* Reset & Base */
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; font-size: var(--text-base); }
body {
    font-family: var(--font-body);
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    min-height: 100vh;
    overflow-x: hidden;
}

/* Animations */
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
@keyframes spin { to { transform: rotate(360deg); } }
@keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
@keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
@keyframes wiggle { 0%, 100% { transform: rotate(-3deg); } 50% { transform: rotate(3deg); } }

.animate-fadeIn { animation: fadeIn 0.4s ease; }
.animate-slideUp { animation: slideUp 0.5s ease; }
.animate-scaleIn { animation: scaleIn 0.3s ease; }
.animate-bounce { animation: bounce 2s ease-in-out infinite; }

/* Skip Link for Accessibility */
.skip-link {
    position: absolute;
    top: -100px;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 24px;
    background: var(--primary);
    color: white;
    border-radius: var(--radius-md);
    z-index: 10000;
    font-weight: 600;
    text-decoration: none;
}
.skip-link:focus {
    top: 10px;
}

/* Header */
header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 0 24px;
}
.header-inner {
    max-width: 1600px;
    margin: 0 auto;
    height: 72px;
    display: flex;
    align-items: center;
    gap: 20px;
}
.logo {
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    text-decoration: none;
    color: inherit;
}
.logo-icon {
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, var(--primary), var(--warning));
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    box-shadow: var(--shadow-sm);
}
.logo-text {
    font-family: var(--font-display);
    font-size: var(--text-xl);
    font-weight: 700;
    color: var(--text);
}
.logo-tagline {
    font-size: var(--text-xs);
    color: var(--text-muted);
    margin-top: 2px;
}

/* Navigation */
.nav-main {
    display: flex;
    gap: 4px;
    margin-left: auto;
    background: var(--surface-alt);
    padding: 4px;
    border-radius: var(--radius-lg);
}
.nav-btn {
    padding: 10px 16px;
    border: none;
    background: transparent;
    color: var(--text-dim);
    font-size: var(--text-sm);
    font-weight: 600;
    cursor: pointer;
    border-radius: var(--radius-md);
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
}
.nav-btn:hover {
    color: var(--text);
    background: var(--surface);
}
.nav-btn.active {
    background: var(--primary);
    color: white;
    box-shadow: var(--shadow-sm);
}
.nav-btn .icon { font-size: 18px; }

/* Accessibility Controls */
.a11y-controls {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px;
    background: var(--surface-alt);
    border-radius: var(--radius-lg);
    margin-left: 12px;
}
.a11y-btn {
    width: 36px;
    height: 36px;
    border: 1px solid var(--border);
    background: var(--surface);
    border-radius: var(--radius-sm);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    transition: all 0.2s;
}
.a11y-btn:hover {
    background: var(--primary-light);
    border-color: var(--primary);
}
.a11y-btn.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}
.a11y-btn[title]::after {
    content: attr(title);
    position: absolute;
    bottom: -30px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--text);
    color: var(--bg);
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
}
.a11y-btn:hover[title]::after {
    opacity: 1;
}

/* Main Content */
main {
    min-height: calc(100vh - 72px);
    padding: 32px 24px 60px;
}
.main-container {
    max-width: 1600px;
    margin: 0 auto;
}

/* Section Styles */
.section {
    display: none;
    animation: fadeIn 0.3s ease;
}
.section.active {
    display: block;
}

/* Page Title */
.page-title {
    text-align: center;
    margin-bottom: 40px;
}
.page-title h1 {
    font-family: var(--font-display);
    font-size: var(--text-3xl);
    font-weight: 700;
    margin-bottom: 8px;
    color: var(--text);
}
.page-title p {
    font-size: var(--text-lg);
    color: var(--text-dim);
    max-width: 600px;
    margin: 0 auto;
}

/* Card Type Selector */
.card-type-section {
    margin-bottom: 40px;
}
.card-type-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 16px;
    max-width: 900px;
    margin: 0 auto;
}
.card-type-item {
    background: var(--surface);
    border: 2px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 24px 16px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
}
.card-type-item:hover {
    border-color: var(--primary);
    transform: translateY(-4px);
    box-shadow: var(--shadow-md);
}
.card-type-item.active {
    border-color: var(--primary);
    background: var(--primary-light);
}
.card-type-item .icon {
    font-size: 40px;
    margin-bottom: 12px;
    display: block;
}
.card-type-item .name {
    font-size: var(--text-base);
    font-weight: 700;
    margin-bottom: 4px;
}
.card-type-item .desc {
    font-size: var(--text-sm);
    color: var(--text-muted);
}

/* Theme Categories */
.theme-categories {
    margin-bottom: 32px;
}
.category-tabs {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: center;
    margin-bottom: 24px;
}
.category-tab {
    padding: 10px 20px;
    border: 1px solid var(--border);
    background: var(--surface);
    border-radius: var(--radius-full);
    font-size: var(--text-sm);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
}
.category-tab:hover {
    border-color: var(--primary);
    background: var(--primary-light);
}
.category-tab.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

/* Theme Grid */
.theme-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 16px;
}
.theme-card {
    aspect-ratio: 4/5;
    border-radius: var(--radius-lg);
    overflow: hidden;
    cursor: pointer;
    position: relative;
    border: 3px solid transparent;
    transition: all 0.3s;
    box-shadow: var(--shadow-sm);
}
.theme-card:hover {
    transform: scale(1.03);
    box-shadow: var(--shadow-lg);
}
.theme-card.active {
    border-color: var(--primary);
    box-shadow: 0 0 0 4px var(--primary-light), var(--shadow-lg);
}
.theme-card-bg {
    position: absolute;
    inset: 0;
}
.theme-card-icon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 48px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
}
.theme-card-name {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 12px 8px;
    background: linear-gradient(transparent, rgba(0,0,0,0.8));
    color: white;
    font-size: var(--text-sm);
    font-weight: 600;
    text-align: center;
}
.theme-card-badge {
    position: absolute;
    top: 8px;
    right: 8px;
    padding: 4px 8px;
    background: var(--primary);
    color: white;
    font-size: 10px;
    font-weight: 700;
    border-radius: var(--radius-full);
    text-transform: uppercase;
}

/* Workspace Layout */
.workspace {
    display: grid;
    grid-template-columns: 300px 1fr 320px;
    gap: 24px;
    margin-top: 32px;
}
@media (max-width: 1200px) {
    .workspace {
        grid-template-columns: 1fr;
    }
}

/* Sidebar Panels */
.sidebar-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    overflow: hidden;
}
.sidebar-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    font-size: var(--text-sm);
    font-weight: 700;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    gap: 8px;
}
.sidebar-content {
    padding: 16px;
}

/* Element Grid */
.element-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 8px;
}
.element-item {
    aspect-ratio: 1;
    border: 1px solid var(--border);
    background: var(--surface-alt);
    border-radius: var(--radius-sm);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    transition: all 0.2s;
}
.element-item:hover {
    background: var(--primary-light);
    border-color: var(--primary);
    transform: scale(1.1);
}

/* Canvas Area */
.canvas-workspace {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 24px;
    display: flex;
    flex-direction: column;
    align-items: center;
}
.canvas-toolbar {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: center;
    margin-bottom: 20px;
    padding: 12px;
    background: var(--surface-alt);
    border-radius: var(--radius-md);
    width: 100%;
}
.toolbar-btn {
    padding: 10px 16px;
    border: 1px solid var(--border);
    background: var(--surface);
    border-radius: var(--radius-sm);
    font-size: var(--text-sm);
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.2s;
    color: var(--text);
}
.toolbar-btn:hover {
    background: var(--primary-light);
    border-color: var(--primary);
}
.toolbar-btn.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}
.toolbar-btn.success {
    background: var(--success);
    color: white;
    border-color: var(--success);
}

/* Card Preview */
.card-preview-container {
    position: relative;
    width: 100%;
    max-width: 400px;
}
.card-preview {
    position: relative;
    width: 100%;
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-xl);
}
.card-preview.ecard { aspect-ratio: 4/3; }
.card-preview.foldable { aspect-ratio: 5/7; }
.card-preview.invite { aspect-ratio: 5/7; }
.card-preview.business { aspect-ratio: 3.5/2; }
#cardCanvas {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
}
.card-elements-layer {
    position: absolute;
    inset: 0;
    pointer-events: none;
}
.card-elements-layer > * {
    pointer-events: auto;
}

/* Placed Elements */
.placed-element {
    position: absolute;
    cursor: move;
    user-select: none;
    filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
    transition: filter 0.2s;
}
.placed-element:hover {
    filter: drop-shadow(0 0 8px var(--primary));
}
.placed-element.selected {
    outline: 3px dashed var(--primary);
    outline-offset: 4px;
}

/* Text Blocks */
.text-block {
    position: absolute;
    cursor: move;
    padding: 6px 10px;
    border: 2px solid transparent;
    border-radius: 4px;
    user-select: none;
    max-width: 90%;
    word-wrap: break-word;
    transition: border-color 0.2s;
}
.text-block:hover {
    border-color: var(--border-dark);
}
.text-block.selected {
    border-color: var(--primary);
    background: rgba(232, 93, 4, 0.1);
}
.text-block.editing {
    cursor: text;
    border-color: var(--success);
    background: rgba(5, 150, 105, 0.1);
}

/* Right Panel - Text Controls */
.text-controls-panel {
    display: flex;
    flex-direction: column;
    gap: 16px;
}
.control-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.control-label {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-dim);
}
.control-row {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
}
.ctrl-btn {
    width: 40px;
    height: 40px;
    border: 1px solid var(--border);
    background: var(--surface);
    border-radius: var(--radius-sm);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--text-base);
    transition: all 0.2s;
    color: var(--text);
}
.ctrl-btn:hover {
    background: var(--primary-light);
    border-color: var(--primary);
}
.ctrl-btn.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}
input[type="color"] {
    width: 40px;
    height: 40px;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    cursor: pointer;
    padding: 4px;
}
input[type="range"] {
    width: 100%;
    accent-color: var(--primary);
    height: 8px;
}
select.form-select {
    width: 100%;
    padding: 12px;
    border: 1px solid var(--border);
    background: var(--surface);
    border-radius: var(--radius-sm);
    font-size: var(--text-base);
    color: var(--text);
    cursor: pointer;
}
select.form-select:focus {
    outline: none;
    border-color: var(--primary);
}

/* Quick Text Buttons */
.quick-text-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
}
.quick-text-btn {
    padding: 12px;
    border: 1px solid var(--border);
    background: var(--surface);
    border-radius: var(--radius-sm);
    font-size: var(--text-sm);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    text-align: left;
    color: var(--text);
}
.quick-text-btn:hover {
    background: var(--primary-light);
    border-color: var(--primary);
}

/* Message Templates */
.message-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}
.message-chip {
    padding: 8px 14px;
    background: var(--surface-alt);
    border: 1px solid var(--border);
    border-radius: var(--radius-full);
    font-size: var(--text-sm);
    cursor: pointer;
    transition: all 0.2s;
    color: var(--text);
}
.message-chip:hover {
    background: var(--primary-light);
    border-color: var(--primary);
}

/* Upload Area */
.upload-area {
    border: 2px dashed var(--border);
    border-radius: var(--radius-lg);
    padding: 32px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    background: var(--surface-alt);
}
.upload-area:hover {
    border-color: var(--primary);
    background: var(--primary-light);
}
.upload-area .icon {
    font-size: 48px;
    margin-bottom: 12px;
}
.upload-area .text {
    font-size: var(--text-base);
    color: var(--text-dim);
}
.upload-area input {
    display: none;
}

/* Toast */
.toast {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    padding: 16px 28px;
    border-radius: var(--radius-lg);
    font-size: var(--text-base);
    font-weight: 600;
    background: var(--success);
    color: white;
    z-index: 1000;
    transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    box-shadow: var(--shadow-lg);
}
.toast.show {
    transform: translateX(-50%) translateY(0);
}
.toast.error {
    background: var(--error);
}
.toast.info {
    background: var(--accent);
}

/* Footer */
footer {
    background: var(--surface);
    border-top: 1px solid var(--border);
    padding: 32px 24px;
    text-align: center;
}
.footer-logo {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 12px;
}
.footer-logo .icon {
    font-size: 24px;
}
.footer-logo .text {
    font-family: var(--font-display);
    font-size: var(--text-lg);
    font-weight: 700;
}
.footer-tagline {
    color: var(--text-muted);
    font-size: var(--text-sm);
    margin-bottom: 16px;
}
.footer-copy {
    color: var(--text-muted);
    font-size: var(--text-xs);
}

/* Mobile Responsive */
@media (max-width: 900px) {
    .nav-main { display: none; }
    .a11y-controls { margin-left: auto; }
    .workspace { grid-template-columns: 1fr; }
    .sidebar-panel { order: 1; }
    .canvas-workspace { order: 0; }
    .card-type-grid { grid-template-columns: repeat(2, 1fr); }
    .theme-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); }
}

@media (max-width: 600px) {
    header { padding: 0 16px; }
    .header-inner { height: 64px; }
    .logo-text { font-size: var(--text-lg); }
    main { padding: 20px 16px 40px; }
    .card-type-grid { grid-template-columns: 1fr; }
    .theme-grid { grid-template-columns: repeat(2, 1fr); }
}

/* Print Styles */
@media print {
    header, footer, .sidebar-panel, .canvas-toolbar, .a11y-controls { display: none !important; }
    .workspace { display: block !important; }
    .canvas-workspace { border: none !important; padding: 0 !important; }
}
    </style>
</head>
<body data-theme="light" data-contrast="normal" data-textsize="normal">
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <header>
        <div class="header-inner">
            <a href="#" class="logo" onclick="showSection('home'); return false;" aria-label="Chameleon Card Studio Home">
                <div class="logo-icon">ü¶é</div>
                <div>
                    <div class="logo-text">Chameleon Card Studio</div>
                    <div class="logo-tagline">Cards for Every Occasion</div>
                </div>
            </a>
            
            <nav class="nav-main" role="navigation" aria-label="Main navigation">
                <button class="nav-btn active" onclick="showSection('home')" data-section="home" aria-current="page">
                    <span class="icon">üè†</span> Home
                </button>
                <button class="nav-btn" onclick="showSection('create')" data-section="create">
                    <span class="icon">‚ú®</span> Create Card
                </button>
                <button class="nav-btn" onclick="showSection('templates')" data-section="templates">
                    <span class="icon">üìö</span> Templates
                </button>
            </nav>
            
            <div class="a11y-controls" role="group" aria-label="Accessibility options">
                <button class="a11y-btn" onclick="toggleDarkMode()" title="Toggle Dark Mode" aria-label="Toggle dark mode">üåô</button>
                <button class="a11y-btn" onclick="toggleTextSize()" title="Text Size" aria-label="Increase text size">Aa</button>
                <button class="a11y-btn" onclick="toggleContrast()" title="High Contrast" aria-label="Toggle high contrast">‚óê</button>
            </div>
        </div>
    </header>

    <main id="main-content">
        <div class="main-container">
            <!-- HOME SECTION -->
            <section class="section active" id="section-home" aria-labelledby="home-title">
                <div class="page-title">
                    <h1 id="home-title">Create Beautiful Cards ‚ú®</h1>
                    <p>Design stunning cards for every occasion. Easy to use for kids, seniors, and everyone in between!</p>
                </div>

                <!-- Card Type Selection -->
                <div class="card-type-section">
                    <h2 style="text-align:center;font-size:var(--text-xl);margin-bottom:24px;color:var(--text-dim);">What would you like to create?</h2>
                    <div class="card-type-grid" role="listbox" aria-label="Card types">
                        <div class="card-type-item active" onclick="selectCardType('ecard')" role="option" aria-selected="true" tabindex="0">
                            <span class="icon">üìß</span>
                            <div class="name">E-Card</div>
                            <div class="desc">Digital cards to share online</div>
                        </div>
                        <div class="card-type-item" onclick="selectCardType('foldable')" role="option" aria-selected="false" tabindex="0">
                            <span class="icon">üìÑ</span>
                            <div class="name">Foldable Card</div>
                            <div class="desc">Print & fold greeting cards</div>
                        </div>
                        <div class="card-type-item" onclick="selectCardType('invite')" role="option" aria-selected="false" tabindex="0">
                            <span class="icon">üíå</span>
                            <div class="name">Invitation</div>
                            <div class="desc">Party & event invitations</div>
                        </div>
                        <div class="card-type-item" onclick="selectCardType('business')" role="option" aria-selected="false" tabindex="0">
                            <span class="icon">üíº</span>
                            <div class="name">Business Card</div>
                            <div class="desc">Professional contact cards</div>
                        </div>
                    </div>
                </div>

                <!-- Theme Categories -->
                <div class="theme-categories">
                    <h2 style="text-align:center;font-size:var(--text-xl);margin-bottom:24px;color:var(--text-dim);">Choose a Style</h2>
                    <div class="category-tabs" role="tablist" aria-label="Theme categories">
                        <button class="category-tab active" onclick="filterThemes('all')" role="tab" aria-selected="true">üé® All Styles</button>
                        <button class="category-tab" onclick="filterThemes('professional')" role="tab">üíº Professional</button>
                        <button class="category-tab" onclick="filterThemes('vintage')" role="tab">üì∫ Vintage & Retro</button>
                        <button class="category-tab" onclick="filterThemes('nature')" role="tab">üåø Nature & Calm</button>
                        <button class="category-tab" onclick="filterThemes('kids')" role="tab">üéà Fun & Kids</button>
                        <button class="category-tab" onclick="filterThemes('occasions')" role="tab">üéÇ Occasions</button>
                    </div>
                    <div class="theme-grid" id="themeGrid" role="listbox" aria-label="Available themes"></div>
                </div>

                <div style="text-align:center;margin-top:40px;">
                    <button class="toolbar-btn success" style="font-size:var(--text-lg);padding:16px 40px;" onclick="startCreating()">
                        ‚ú® Start Creating!
                    </button>
                </div>
            </section>

            <!-- CREATE SECTION -->
            <section class="section" id="section-create" aria-labelledby="create-title">
                <div class="page-title">
                    <h1 id="create-title">Design Your Card</h1>
                    <p>Add text, stickers, and make it your own!</p>
                </div>

                <div class="workspace">
                    <!-- Left Sidebar - Elements -->
                    <div class="sidebar-panel">
                        <div class="sidebar-header">‚ú® Add Elements</div>
                        <div class="sidebar-content">
                            <div style="margin-bottom:20px;">
                                <div class="control-label" style="margin-bottom:8px;">Stickers & Decorations</div>
                                <div class="element-grid" id="elementGrid"></div>
                            </div>
                            <div style="margin-bottom:20px;">
                                <div class="control-label" style="margin-bottom:8px;">Borders & Frames</div>
                                <div class="element-grid" id="frameGrid"></div>
                            </div>
                            <div>
                                <div class="control-label" style="margin-bottom:8px;">Upload Your Image</div>
                                <label class="upload-area" for="imageUpload">
                                    <span class="icon">üì∑</span>
                                    <div class="text">Click or drag to upload</div>
                                    <input type="file" id="imageUpload" accept="image/*" onchange="handleImageUpload(event)">
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Center - Canvas -->
                    <div class="canvas-workspace">
                        <div class="canvas-toolbar">
                            <button class="toolbar-btn" onclick="addCardText()">üìù Add Text</button>
                            <button class="toolbar-btn" onclick="regenerateBackground()">üé® New Background</button>
                            <button class="toolbar-btn" onclick="undoAction()">‚Ü©Ô∏è Undo</button>
                            <button class="toolbar-btn" onclick="clearAll()">üóëÔ∏è Clear All</button>
                            <div style="flex:1"></div>
                            <button class="toolbar-btn success" onclick="downloadCard()">üíæ Download</button>
                            <button class="toolbar-btn" onclick="printCard()">üñ®Ô∏è Print</button>
                        </div>
                        <div class="card-preview-container">
                            <div class="card-preview ecard" id="cardPreview">
                                <canvas id="cardCanvas"></canvas>
                                <div class="card-elements-layer" id="cardElements"></div>
                            </div>
                        </div>
                        <p style="text-align:center;color:var(--text-muted);font-size:var(--text-sm);margin-top:16px;">
                            üí° Tip: Click elements to select, drag to move, double-click text to edit
                        </p>
                    </div>

                    <!-- Right Sidebar - Text Controls -->
                    <div class="sidebar-panel">
                        <div class="sidebar-header">üìù Text Controls</div>
                        <div class="sidebar-content text-controls-panel">
                            <div class="control-group">
                                <div class="control-label">Font Size</div>
                                <div class="control-row" style="align-items:center;">
                                    <button class="ctrl-btn" onclick="changeTextSize(-4)" aria-label="Decrease font size">‚àí</button>
                                    <span id="fontSizeDisplay" style="min-width:50px;text-align:center;font-weight:600;">24px</span>
                                    <button class="ctrl-btn" onclick="changeTextSize(4)" aria-label="Increase font size">+</button>
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="control-label">Text Style</div>
                                <div class="control-row">
                                    <button class="ctrl-btn" id="boldBtn" onclick="toggleBold()" aria-label="Bold"><b>B</b></button>
                                    <button class="ctrl-btn" id="italicBtn" onclick="toggleItalic()" aria-label="Italic"><i>I</i></button>
                                    <input type="color" id="textColor" value="#333333" onchange="updateTextStyle()" aria-label="Text color">
                                    <button class="ctrl-btn" onclick="deleteSelected()" aria-label="Delete selected">üóëÔ∏è</button>
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="control-label">Font Family</div>
                                <select class="form-select" id="fontFamily" onchange="updateTextStyle()" aria-label="Font family">
                                    <option value="Georgia, serif">Georgia (Elegant)</option>
                                    <option value="Arial, sans-serif">Arial (Clean)</option>
                                    <option value="'Comic Sans MS', cursive">Comic Sans (Fun)</option>
                                    <option value="'Times New Roman', serif">Times (Classic)</option>
                                    <option value="Verdana, sans-serif">Verdana (Modern)</option>
                                    <option value="Impact, sans-serif">Impact (Bold)</option>
                                    <option value="'Courier New', monospace">Courier (Typewriter)</option>
                                    <option value="'Brush Script MT', cursive">Brush Script (Fancy)</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <div class="control-label">Quick Add Text</div>
                                <div class="quick-text-grid">
                                    <button class="quick-text-btn" onclick="addPresetText('title')">+ Title</button>
                                    <button class="quick-text-btn" onclick="addPresetText('message')">+ Message</button>
                                    <button class="quick-text-btn" onclick="addPresetText('signature')">+ Signature</button>
                                    <button class="quick-text-btn" onclick="addPresetText('date')">+ Date</button>
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="control-label">Message Ideas</div>
                                <div class="message-chips" id="messageChips"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- TEMPLATES SECTION -->
            <section class="section" id="section-templates" aria-labelledby="templates-title">
                <div class="page-title">
                    <h1 id="templates-title">Ready-Made Templates</h1>
                    <p>Start with a beautiful template and customize it your way!</p>
                </div>
                <div class="theme-categories">
                    <div class="category-tabs" role="tablist">
                        <button class="category-tab active" onclick="filterTemplates('all')">üé® All</button>
                        <button class="category-tab" onclick="filterTemplates('birthday')">üéÇ Birthday</button>
                        <button class="category-tab" onclick="filterTemplates('holiday')">üéÑ Holiday</button>
                        <button class="category-tab" onclick="filterTemplates('thankyou')">üôè Thank You</button>
                        <button class="category-tab" onclick="filterTemplates('wedding')">üíí Wedding</button>
                        <button class="category-tab" onclick="filterTemplates('business')">üíº Business</button>
                    </div>
                    <div class="theme-grid" id="templateGrid"></div>
                </div>
            </section>
        </div>
    </main>

    <footer>
        <div class="footer-logo">
            <span class="icon">ü¶é</span>
            <span class="text">Chameleon Card Studio</span>
        </div>
        <div class="footer-tagline">Creating memories, one card at a time ‚ú®</div>
        <div class="footer-copy">¬© 2025 Chameleon Studios. Made with ‚ù§Ô∏è for everyone.</div>
    </footer>

    <div class="toast" id="toast" role="alert" aria-live="polite"></div>
<script>
(function(){
"use strict";

// ========== THEME DATA ==========
const THEMES = [
    // Professional
    { id: 'professional', name: 'Professional', icon: 'üíº', category: 'professional', bg: ['#1a1a2e', '#16213e'], colors: ['#0f3460', '#e94560', '#533483'], featured: true },
    { id: 'corporate', name: 'Corporate', icon: 'üè¢', category: 'professional', bg: ['#2c3e50', '#34495e'], colors: ['#3498db', '#2ecc71', '#f1c40f'] },
    { id: 'minimal', name: 'Minimal', icon: '‚¨ú', category: 'professional', bg: ['#ffffff', '#f8f9fa'], colors: ['#212529', '#6c757d', '#adb5bd'] },
    { id: 'elegant', name: 'Elegant', icon: '‚ú®', category: 'professional', bg: ['#1a1a1a', '#2d2d2d'], colors: ['#d4af37', '#c0c0c0', '#ffffff'] },
    
    // Vintage & Retro
    { id: 'steampunk', name: 'Steampunk', icon: '‚öôÔ∏è', category: 'vintage', bg: ['#1a1510', '#2c2218'], colors: ['#8B4513', '#D4A574', '#C9A227'], featured: true },
    { id: 'leavebeaver', name: 'Leave It To Beaver', icon: 'üì∫', category: 'vintage', bg: ['#f5f0e6', '#e8dcc8'], colors: ['#8b7355', '#5c4a3d', '#a69076'], featured: true },
    { id: 'littlehouse', name: 'Little House', icon: 'üè°', category: 'vintage', bg: ['#f4ece4', '#e6d5c3'], colors: ['#8b6914', '#5d4e37', '#a0522d'], featured: true },
    { id: 'victorian', name: 'Victorian', icon: 'üëë', category: 'vintage', bg: ['#2d1b3d', '#1a1025'], colors: ['#800020', '#DAA520', '#DDA0DD'] },
    { id: 'artdeco', name: 'Art Deco', icon: 'üíé', category: 'vintage', bg: ['#0a0a0a', '#1a1a1a'], colors: ['#FFD700', '#C0C0C0', '#000000'] },
    { id: 'retro70s', name: '70s Retro', icon: 'üï∫', category: 'vintage', bg: ['#f4a460', '#cd853f'], colors: ['#ff6347', '#ffd700', '#8b4513'] },
    
    // Nature & Calm
    { id: 'zen', name: 'Zen Garden', icon: 'üßò', category: 'nature', bg: ['#f5f5f0', '#e8e6df'], colors: ['#6b8e23', '#808080', '#4a4a4a'], featured: true },
    { id: 'botanical', name: 'Botanical', icon: 'üåø', category: 'nature', bg: ['#f0f8f0', '#e0f0e0'], colors: ['#228B22', '#90EE90', '#6B8E23'] },
    { id: 'celestial', name: 'Celestial', icon: 'üåô', category: 'nature', bg: ['#0a0a20', '#151530'], colors: ['#191970', '#FFD700', '#9370DB'] },
    { id: 'ocean', name: 'Ocean Calm', icon: 'üåä', category: 'nature', bg: ['#e0f7fa', '#b2ebf2'], colors: ['#00838f', '#4dd0e1', '#006064'] },
    { id: 'forest', name: 'Forest', icon: 'üå≤', category: 'nature', bg: ['#1a2f1a', '#0d1f0d'], colors: ['#228b22', '#90ee90', '#006400'] },
    { id: 'sunset', name: 'Sunset', icon: 'üåÖ', category: 'nature', bg: ['#ff7e5f', '#feb47b'], colors: ['#ff4500', '#ffd700', '#ff6347'] },
    
    // Fun & Kids
    { id: 'cartoon', name: 'Cartoon Fun', icon: 'üé®', category: 'kids', bg: ['#fff3e0', '#ffe0b2'], colors: ['#ff5722', '#4caf50', '#2196f3'], featured: true },
    { id: 'kawaii', name: 'Kawaii', icon: 'üå∏', category: 'kids', bg: ['#fff5f8', '#fff0f5'], colors: ['#FFB7C5', '#FFDAB9', '#E6E6FA'], featured: true },
    { id: 'superhero', name: 'Superhero', icon: 'ü¶∏', category: 'kids', bg: ['#1a237e', '#283593'], colors: ['#f44336', '#ffeb3b', '#2196f3'] },
    { id: 'unicorn', name: 'Unicorn Magic', icon: 'ü¶Ñ', category: 'kids', bg: ['#e8daef', '#d2b4de'], colors: ['#9b59b6', '#e91e63', '#00bcd4'] },
    { id: 'dinosaur', name: 'Dino World', icon: 'ü¶ï', category: 'kids', bg: ['#c8e6c9', '#a5d6a7'], colors: ['#4caf50', '#8bc34a', '#795548'] },
    { id: 'space', name: 'Space Adventure', icon: 'üöÄ', category: 'kids', bg: ['#0d0d2b', '#1a1a4e'], colors: ['#7c4dff', '#00e5ff', '#ff4081'] },
    { id: 'princess', name: 'Princess', icon: 'üë∏', category: 'kids', bg: ['#fce4ec', '#f8bbd9'], colors: ['#e91e63', '#9c27b0', '#ffd700'] },
    { id: 'pirate', name: 'Pirate', icon: 'üè¥‚Äç‚ò†Ô∏è', category: 'kids', bg: ['#3e2723', '#4e342e'], colors: ['#d4af37', '#8d6e63', '#ffffff'] },
    
    // Occasions
    { id: 'birthday', name: 'Birthday Party', icon: 'üéÇ', category: 'occasions', bg: ['#fff8e1', '#ffecb3'], colors: ['#ff9800', '#e91e63', '#9c27b0'], featured: true },
    { id: 'wedding', name: 'Wedding', icon: 'üíí', category: 'occasions', bg: ['#fafafa', '#f5f5f5'], colors: ['#d4af37', '#c0c0c0', '#ffffff'] },
    { id: 'christmas', name: 'Christmas', icon: 'üéÑ', category: 'occasions', bg: ['#1b5e20', '#2e7d32'], colors: ['#c62828', '#ffd700', '#ffffff'] },
    { id: 'halloween', name: 'Halloween', icon: 'üéÉ', category: 'occasions', bg: ['#1a1a1a', '#2d2d2d'], colors: ['#ff6f00', '#7b1fa2', '#4caf50'] },
    { id: 'valentine', name: 'Valentine', icon: 'üíï', category: 'occasions', bg: ['#ffebee', '#fce4ec'], colors: ['#e91e63', '#f44336', '#ff4081'] },
    { id: 'easter', name: 'Easter', icon: 'üê∞', category: 'occasions', bg: ['#e8f5e9', '#f3e5f5'], colors: ['#ab47bc', '#66bb6a', '#ffee58'] },
    { id: 'graduation', name: 'Graduation', icon: 'üéì', category: 'occasions', bg: ['#1a237e', '#303f9f'], colors: ['#ffd700', '#ffffff', '#c0c0c0'] },
    { id: 'babyshower', name: 'Baby Shower', icon: 'üë∂', category: 'occasions', bg: ['#e3f2fd', '#f3e5f5'], colors: ['#90caf9', '#f48fb1', '#a5d6a7'] },
    { id: 'anniversary', name: 'Anniversary', icon: 'üíç', category: 'occasions', bg: ['#fff8e1', '#ffe0b2'], colors: ['#d4af37', '#c0c0c0', '#b71c1c'] },
    { id: 'thankyou', name: 'Thank You', icon: 'üôè', category: 'occasions', bg: ['#e8f5e9', '#c8e6c9'], colors: ['#2e7d32', '#66bb6a', '#a5d6a7'] }
];

// ========== ELEMENTS BY THEME ==========
const ELEMENTS = {
    professional: ['üìä', 'üìà', 'üíº', 'ü§ù', '‚úÖ', 'üìã', 'üí°', 'üéØ'],
    vintage: ['‚öôÔ∏è', 'üîß', 'üìª', '‚òéÔ∏è', 'üé©', 'üì∫', 'üï∞Ô∏è', '‚úíÔ∏è'],
    nature: ['üåø', 'üå∏', 'ü¶ã', 'üå∫', 'üçÉ', 'üåº', 'üêù', 'üåô'],
    kids: ['üéà', '‚≠ê', 'üåà', 'üéâ', 'üéÄ', 'üç≠', 'üé™', 'üé†'],
    occasions: ['üéÇ', 'üéÅ', 'üéä', 'üéâ', 'üíù', 'üåü', '‚ú®', 'üéà']
};

const FRAMES = ['üî≤', '‚¨ú', 'üí†', '‚ùáÔ∏è', '‚ú¥Ô∏è', 'üí´', '‚≠ê', '‚ú®', '‚ùÑÔ∏è', 'üíé'];

const MESSAGE_TEMPLATES = {
    birthday: ['Happy Birthday!', 'Wishing you joy!', 'Make a wish!', 'Celebrate you!'],
    thankyou: ['Thank you!', 'So grateful!', 'You\'re the best!', 'Much appreciated!'],
    wedding: ['Congratulations!', 'Best wishes!', 'Forever & Always', 'Love wins!'],
    holiday: ['Happy Holidays!', 'Season\'s Greetings!', 'Joy & Peace', 'Merry & Bright!'],
    general: ['Thinking of you', 'With love', 'Just because', 'You matter!']
};

// ========== STATE ==========
let currentSection = 'home';
let currentCardType = 'ecard';
let currentTheme = THEMES[0];
let currentCategory = 'all';
let cardCanvas, cardCtx;
let cardElements = [];
let cardTexts = [];
let cardSelected = null;
let cardIdCounter = 0;
let undoStack = [];

// ========== INITIALIZATION ==========
document.addEventListener('DOMContentLoaded', init);

function init() {
    initCanvas();
    renderThemeGrid();
    renderElements();
    renderMessageChips();
    loadPreferences();
}

function initCanvas() {
    cardCanvas = document.getElementById('cardCanvas');
    if (!cardCanvas) return;
    
    updateCanvasSize();
    cardCtx = cardCanvas.getContext('2d');
    generateBackground();
}

function updateCanvasSize() {
    const sizes = {
        ecard: { w: 800, h: 600 },
        foldable: { w: 700, h: 980 },
        invite: { w: 700, h: 980 },
        business: { w: 700, h: 400 }
    };
    const size = sizes[currentCardType] || sizes.ecard;
    cardCanvas.width = size.w;
    cardCanvas.height = size.h;
    
    // Update preview class
    const preview = document.getElementById('cardPreview');
    if (preview) {
        preview.className = 'card-preview ' + currentCardType;
    }
}

// ========== NAVIGATION ==========
window.showSection = function(section) {
    currentSection = section;
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById('section-' + section)?.classList.add('active');
    document.querySelectorAll('.nav-btn').forEach(b => {
        b.classList.toggle('active', b.dataset.section === section);
        b.setAttribute('aria-current', b.dataset.section === section ? 'page' : 'false');
    });
    
    // Announce for screen readers
    const title = document.querySelector('#section-' + section + ' h1');
    if (title) announceToScreenReader('Navigated to ' + title.textContent);
};

window.startCreating = function() {
    showSection('create');
    toast('Let\'s create something amazing! üé®');
};

// ========== CARD TYPE ==========
window.selectCardType = function(type) {
    currentCardType = type;
    document.querySelectorAll('.card-type-item').forEach(item => {
        const isActive = item.onclick.toString().includes(type);
        item.classList.toggle('active', isActive);
        item.setAttribute('aria-selected', isActive);
    });
    updateCanvasSize();
    generateBackground();
    toast('Card type: ' + type.charAt(0).toUpperCase() + type.slice(1));
};

// ========== THEMES ==========
function renderThemeGrid(filter = 'all') {
    const grid = document.getElementById('themeGrid');
    if (!grid) return;
    
    let themes = filter === 'all' ? THEMES : THEMES.filter(t => t.category === filter);
    
    grid.innerHTML = themes.map(t => `
        <div class="theme-card ${t.id === currentTheme.id ? 'active' : ''}" 
             onclick="selectTheme('${t.id}')" 
             role="option" 
             aria-selected="${t.id === currentTheme.id}"
             tabindex="0"
             onkeypress="if(event.key==='Enter')selectTheme('${t.id}')">
            <div class="theme-card-bg" style="background:linear-gradient(135deg,${t.bg[0]},${t.bg[1]})"></div>
            <span class="theme-card-icon">${t.icon}</span>
            <div class="theme-card-name">${t.name}</div>
            ${t.featured ? '<div class="theme-card-badge">Popular</div>' : ''}
        </div>
    `).join('');
}

window.filterThemes = function(category) {
    currentCategory = category;
    document.querySelectorAll('.category-tab').forEach(tab => {
        const isActive = tab.onclick.toString().includes(category);
        tab.classList.toggle('active', isActive);
        tab.setAttribute('aria-selected', isActive);
    });
    renderThemeGrid(category);
};

window.selectTheme = function(id) {
    currentTheme = THEMES.find(t => t.id === id) || THEMES[0];
    document.querySelectorAll('.theme-card').forEach(card => {
        const isActive = card.onclick.toString().includes(id);
        card.classList.toggle('active', isActive);
        card.setAttribute('aria-selected', isActive);
    });
    renderElements();
    generateBackground();
    toast('Theme: ' + currentTheme.name + ' ' + currentTheme.icon);
};

// ========== ELEMENTS ==========
function renderElements() {
    const elementGrid = document.getElementById('elementGrid');
    const frameGrid = document.getElementById('frameGrid');
    
    const categoryElements = ELEMENTS[currentTheme.category] || ELEMENTS.general || ELEMENTS.occasions;
    
    if (elementGrid) {
        elementGrid.innerHTML = categoryElements.map(e => 
            `<div class="element-item" onclick="placeElement('${e}')" tabindex="0" role="button" aria-label="Add ${e}">${e}</div>`
        ).join('');
    }
    
    if (frameGrid) {
        frameGrid.innerHTML = FRAMES.map(f => 
            `<div class="element-item" onclick="placeElement('${f}')" tabindex="0" role="button" aria-label="Add ${f}">${f}</div>`
        ).join('');
    }
}

function renderMessageChips() {
    const container = document.getElementById('messageChips');
    if (!container) return;
    
    const messages = MESSAGE_TEMPLATES.general;
    container.innerHTML = messages.map(m => 
        `<button class="message-chip" onclick="insertMessage('${m}')">${m}</button>`
    ).join('');
}

window.placeElement = function(emoji) {
    saveUndo();
    const id = 'elem-' + (++cardIdCounter);
    cardElements.push({
        id,
        emoji,
        x: 30 + Math.random() * 40,
        y: 30 + Math.random() * 40,
        size: 48
    });
    renderCardElements();
    toast('Added ' + emoji);
};

window.insertMessage = function(msg) {
    const id = 'text-' + (++cardIdCounter);
    cardTexts.push({
        id,
        text: msg,
        x: 50 - (msg.length * 0.8),
        y: 45,
        fontSize: 28,
        fontFamily: 'Georgia, serif',
        color: currentTheme.colors[0] || '#333333',
        bold: true,
        italic: false,
        editing: false
    });
    renderCardElements();
    showSection('create');
};

// ========== BACKGROUND GENERATION ==========
function generateBackground() {
    if (!cardCtx) return;
    
    const w = cardCanvas.width;
    const h = cardCanvas.height;
    const theme = currentTheme;
    
    // Gradient background
    const grad = cardCtx.createLinearGradient(0, 0, 0, h);
    grad.addColorStop(0, theme.bg[0]);
    grad.addColorStop(1, theme.bg[1]);
    cardCtx.fillStyle = grad;
    cardCtx.fillRect(0, 0, w, h);
    
    // Add decorative elements based on theme
    cardCtx.globalAlpha = 0.1;
    for (let i = 0; i < 15; i++) {
        cardCtx.fillStyle = theme.colors[i % theme.colors.length];
        cardCtx.beginPath();
        cardCtx.arc(
            Math.random() * w,
            Math.random() * h,
            20 + Math.random() * 60,
            0, Math.PI * 2
        );
        cardCtx.fill();
    }
    
    // Border
    cardCtx.globalAlpha = 0.3;
    cardCtx.strokeStyle = theme.colors[0];
    cardCtx.lineWidth = 8;
    cardCtx.strokeRect(20, 20, w - 40, h - 40);
    
    cardCtx.globalAlpha = 1;
}

window.regenerateBackground = function() {
    saveUndo();
    generateBackground();
    toast('New background! üé®');
};

// ========== CARD ELEMENTS RENDERING ==========
function renderCardElements() {
    const layer = document.getElementById('cardElements');
    if (!layer) return;
    
    let html = '';
    
    // Render emoji elements
    html += cardElements.map(e => `
        <div class="placed-element ${cardSelected?.id === e.id ? 'selected' : ''}" 
             id="${e.id}" 
             style="left:${e.x}%;top:${e.y}%;font-size:${e.size}px"
             onmousedown="startDrag(event,'${e.id}','element')"
             onclick="selectItem('${e.id}')"
             tabindex="0"
             role="button"
             aria-label="Element ${e.emoji}">${e.emoji}</div>
    `).join('');
    
    // Render text blocks
    html += cardTexts.map(t => `
        <div class="text-block ${cardSelected?.id === t.id ? 'selected' : ''} ${t.editing ? 'editing' : ''}"
             id="${t.id}"
             style="left:${t.x}%;top:${t.y}%;font-size:${t.fontSize}px;color:${t.color};font-family:${t.fontFamily};${t.bold ? 'font-weight:bold;' : ''}${t.italic ? 'font-style:italic;' : ''}text-shadow:1px 1px 3px rgba(0,0,0,0.3);"
             onmousedown="startDrag(event,'${t.id}','text')"
             onclick="selectItem('${t.id}')"
             ondblclick="editText('${t.id}')"
             ${t.editing ? 'contenteditable="true"' : ''}
             tabindex="0"
             role="textbox"
             aria-label="Text: ${t.text}">${t.text}</div>
    `).join('');
    
    layer.innerHTML = html;
}

// ========== DRAG & DROP ==========
let dragItem = null;
let dragType = null;
let dragOffset = { x: 0, y: 0 };

window.startDrag = function(e, id, type) {
    e.preventDefault();
    dragType = type;
    
    if (type === 'element') {
        dragItem = cardElements.find(el => el.id === id);
    } else {
        const textItem = cardTexts.find(t => t.id === id);
        if (textItem?.editing) return;
        dragItem = textItem;
    }
    
    if (!dragItem) return;
    
    const container = document.getElementById('cardPreview').getBoundingClientRect();
    dragOffset.x = e.clientX - (dragItem.x / 100 * container.width);
    dragOffset.y = e.clientY - (dragItem.y / 100 * container.height);
    
    document.addEventListener('mousemove', doDrag);
    document.addEventListener('mouseup', endDrag);
    document.addEventListener('touchmove', doDragTouch, { passive: false });
    document.addEventListener('touchend', endDrag);
};

function doDrag(e) {
    if (!dragItem) return;
    const container = document.getElementById('cardPreview').getBoundingClientRect();
    dragItem.x = Math.max(0, Math.min(90, ((e.clientX - dragOffset.x) / container.width) * 100));
    dragItem.y = Math.max(0, Math.min(90, ((e.clientY - dragOffset.y) / container.height) * 100));
    renderCardElements();
}

function doDragTouch(e) {
    e.preventDefault();
    doDrag(e.touches[0]);
}

function endDrag() {
    dragItem = null;
    dragType = null;
    document.removeEventListener('mousemove', doDrag);
    document.removeEventListener('mouseup', endDrag);
    document.removeEventListener('touchmove', doDragTouch);
    document.removeEventListener('touchend', endDrag);
}

// ========== SELECTION ==========
window.selectItem = function(id) {
    cardSelected = cardElements.find(e => e.id === id) || cardTexts.find(t => t.id === id) || null;
    
    if (cardSelected?.fontSize) {
        document.getElementById('fontSizeDisplay').textContent = cardSelected.fontSize + 'px';
        document.getElementById('textColor').value = cardSelected.color || '#333333';
        document.getElementById('boldBtn')?.classList.toggle('active', cardSelected.bold);
        document.getElementById('italicBtn')?.classList.toggle('active', cardSelected.italic);
    }
    
    renderCardElements();
};

window.deleteSelected = function() {
    if (!cardSelected) {
        toast('Select something first', 'info');
        return;
    }
    saveUndo();
    cardElements = cardElements.filter(e => e.id !== cardSelected.id);
    cardTexts = cardTexts.filter(t => t.id !== cardSelected.id);
    cardSelected = null;
    renderCardElements();
    toast('Deleted! üóëÔ∏è');
};

// ========== TEXT FUNCTIONS ==========
window.addCardText = function() {
    saveUndo();
    const id = 'text-' + (++cardIdCounter);
    cardTexts.push({
        id,
        text: 'Double-click to edit',
        x: 20 + Math.random() * 60,
        y: 40 + Math.random() * 20,
        fontSize: 24,
        fontFamily: 'Georgia, serif',
        color: '#333333',
        bold: false,
        italic: false,
        editing: false
    });
    renderCardElements();
    toast('Text added! Double-click to edit üìù');
};

window.addPresetText = function(type) {
    saveUndo();
    const id = 'text-' + (++cardIdCounter);
    const presets = {
        title: { text: 'Your Title Here', fontSize: 36, y: 15, bold: true },
        message: { text: MESSAGE_TEMPLATES.general[0], fontSize: 24, y: 45 },
        signature: { text: 'With love', fontSize: 20, y: 80, italic: true },
        date: { text: new Date().toLocaleDateString(), fontSize: 16, y: 90 }
    };
    const p = presets[type];
    cardTexts.push({
        id,
        text: p.text,
        x: 50 - (p.text.length * 0.8),
        y: p.y,
        fontSize: p.fontSize,
        fontFamily: 'Georgia, serif',
        color: '#333333',
        bold: p.bold || false,
        italic: p.italic || false,
        editing: false
    });
    renderCardElements();
};

window.editText = function(id) {
    cardTexts.forEach(t => t.editing = (t.id === id));
    renderCardElements();
    setTimeout(() => {
        const el = document.getElementById(id);
        if (el) {
            el.focus();
            const range = document.createRange();
            range.selectNodeContents(el);
            const sel = window.getSelection();
            sel.removeAllRanges();
            sel.addRange(range);
        }
    }, 50);
};

// Save text on click outside
document.addEventListener('click', function(e) {
    if (!e.target.classList.contains('text-block')) {
        cardTexts.forEach(t => {
            if (t.editing) {
                const el = document.getElementById(t.id);
                if (el) t.text = el.textContent;
                t.editing = false;
            }
        });
        renderCardElements();
    }
});

window.updateTextStyle = function() {
    if (!cardSelected?.fontSize) return;
    cardSelected.fontFamily = document.getElementById('fontFamily').value;
    cardSelected.color = document.getElementById('textColor').value;
    renderCardElements();
};

window.changeTextSize = function(delta) {
    if (!cardSelected?.fontSize) {
        toast('Select text first', 'info');
        return;
    }
    cardSelected.fontSize = Math.max(12, Math.min(72, cardSelected.fontSize + delta));
    document.getElementById('fontSizeDisplay').textContent = cardSelected.fontSize + 'px';
    renderCardElements();
};

window.toggleBold = function() {
    if (!cardSelected?.fontSize) return;
    cardSelected.bold = !cardSelected.bold;
    document.getElementById('boldBtn')?.classList.toggle('active', cardSelected.bold);
    renderCardElements();
};

window.toggleItalic = function() {
    if (!cardSelected?.fontSize) return;
    cardSelected.italic = !cardSelected.italic;
    document.getElementById('italicBtn')?.classList.toggle('active', cardSelected.italic);
    renderCardElements();
};

// ========== UNDO ==========
function saveUndo() {
    undoStack.push({
        elements: JSON.parse(JSON.stringify(cardElements)),
        texts: JSON.parse(JSON.stringify(cardTexts))
    });
    if (undoStack.length > 20) undoStack.shift();
}

window.undoAction = function() {
    if (undoStack.length === 0) {
        toast('Nothing to undo', 'info');
        return;
    }
    const state = undoStack.pop();
    cardElements = state.elements;
    cardTexts = state.texts;
    cardSelected = null;
    renderCardElements();
    toast('Undone! ‚Ü©Ô∏è');
};

window.clearAll = function() {
    if (!confirm('Clear everything and start fresh?')) return;
    saveUndo();
    cardElements = [];
    cardTexts = [];
    cardSelected = null;
    generateBackground();
    renderCardElements();
    toast('All cleared! üßπ');
};

// ========== IMAGE UPLOAD ==========
window.handleImageUpload = function(e) {
    const file = e.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(event) {
        const img = new Image();
        img.onload = function() {
            // Draw image on canvas
            cardCtx.drawImage(img, 0, 0, cardCanvas.width, cardCanvas.height);
            toast('Image added! üì∑');
        };
        img.src = event.target.result;
    };
    reader.readAsDataURL(file);
};

// ========== DOWNLOAD & PRINT ==========
window.downloadCard = function() {
    const exportCanvas = document.createElement('canvas');
    exportCanvas.width = cardCanvas.width;
    exportCanvas.height = cardCanvas.height;
    const ctx = exportCanvas.getContext('2d');
    
    // Draw background
    ctx.drawImage(cardCanvas, 0, 0);
    
    // Draw elements
    cardElements.forEach(e => {
        ctx.font = (e.size * 2) + 'px Arial';
        ctx.fillText(e.emoji, (e.x / 100) * exportCanvas.width, (e.y / 100) * exportCanvas.height + e.size);
    });
    
    // Draw text
    cardTexts.forEach(t => {
        let font = '';
        if (t.italic) font += 'italic ';
        if (t.bold) font += 'bold ';
        font += (t.fontSize * 2) + 'px ' + t.fontFamily;
        ctx.font = font;
        ctx.fillStyle = t.color || '#333';
        ctx.shadowColor = 'rgba(0,0,0,0.3)';
        ctx.shadowBlur = 4;
        ctx.shadowOffsetX = 2;
        ctx.shadowOffsetY = 2;
        (t.text || '').split('\n').forEach((line, i) => {
            ctx.fillText(line, (t.x / 100) * exportCanvas.width, (t.y / 100) * exportCanvas.height + (t.fontSize * 2) + (i * t.fontSize * 2.4));
        });
    });
    
    // Download
    const link = document.createElement('a');
    link.download = `chameleon-${currentCardType}-${currentTheme.id}-${Date.now()}.png`;
    link.href = exportCanvas.toDataURL('image/png');
    link.click();
    toast('Downloaded! üíæ');
};

window.printCard = function() {
    window.print();
    toast('Opening print dialog... üñ®Ô∏è');
};

// ========== ACCESSIBILITY ==========
window.toggleDarkMode = function() {
    const current = document.body.dataset.theme;
    document.body.dataset.theme = current === 'dark' ? 'light' : 'dark';
    localStorage.setItem('theme', document.body.dataset.theme);
    toast(document.body.dataset.theme === 'dark' ? 'üåô Dark mode' : '‚òÄÔ∏è Light mode');
};

window.toggleTextSize = function() {
    const sizes = ['normal', 'large', 'xlarge'];
    const current = document.body.dataset.textsize || 'normal';
    const next = sizes[(sizes.indexOf(current) + 1) % sizes.length];
    document.body.dataset.textsize = next;
    localStorage.setItem('textsize', next);
    toast('Text size: ' + next);
};

window.toggleContrast = function() {
    const current = document.body.dataset.contrast;
    document.body.dataset.contrast = current === 'high' ? 'normal' : 'high';
    localStorage.setItem('contrast', document.body.dataset.contrast);
    toast(document.body.dataset.contrast === 'high' ? '‚óê High contrast' : '‚óã Normal contrast');
};

function loadPreferences() {
    const theme = localStorage.getItem('theme');
    const textsize = localStorage.getItem('textsize');
    const contrast = localStorage.getItem('contrast');
    
    if (theme) document.body.dataset.theme = theme;
    if (textsize) document.body.dataset.textsize = textsize;
    if (contrast) document.body.dataset.contrast = contrast;
}

function announceToScreenReader(message) {
    const el = document.createElement('div');
    el.setAttribute('role', 'status');
    el.setAttribute('aria-live', 'polite');
    el.setAttribute('aria-atomic', 'true');
    el.style.cssText = 'position:absolute;left:-9999px;';
    el.textContent = message;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 1000);
}

// ========== TOAST ==========
window.toast = function(msg, type = 'success') {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.className = 'toast ' + type;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 3000);
};

// ========== KEYBOARD SHORTCUTS ==========
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        selectItem(null);
    }
    if ((e.key === 'Delete' || e.key === 'Backspace') && cardSelected && 
        !['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName) && 
        !document.activeElement.isContentEditable) {
        e.preventDefault();
        deleteSelected();
    }
    if (e.ctrlKey && e.key === 'z') {
        e.preventDefault();
        undoAction();
    }
});

// ========== TEMPLATES SECTION ==========
window.filterTemplates = function(category) {
    document.querySelectorAll('#section-templates .category-tab').forEach(tab => {
        const isActive = tab.onclick.toString().includes(category);
        tab.classList.toggle('active', isActive);
    });
    
    const grid = document.getElementById('templateGrid');
    if (!grid) return;
    
    let templates = category === 'all' ? THEMES : THEMES.filter(t => 
        t.category === category || (category === 'birthday' && t.id === 'birthday') ||
        (category === 'holiday' && ['christmas', 'halloween', 'easter'].includes(t.id)) ||
        (category === 'thankyou' && t.id === 'thankyou') ||
        (category === 'wedding' && t.id === 'wedding') ||
        (category === 'business' && t.category === 'professional')
    );
    
    grid.innerHTML = templates.map(t => `
        <div class="theme-card" onclick="useTemplate('${t.id}')" tabindex="0">
            <div class="theme-card-bg" style="background:linear-gradient(135deg,${t.bg[0]},${t.bg[1]})"></div>
            <span class="theme-card-icon">${t.icon}</span>
            <div class="theme-card-name">${t.name}</div>
        </div>
    `).join('');
};

window.useTemplate = function(id) {
    selectTheme(id);
    showSection('create');
    toast('Template loaded! Start customizing! ‚ú®');
};

})();
</script>
</body>
</html>
