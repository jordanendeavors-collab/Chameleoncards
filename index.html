<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chameleon Studios‚Ñ¢ | Professional Card Creator</title>
    <meta name="description" content="Create stunning business cards, greeting cards, e-cards, foldables, postcards & invitations. AI-powered styles. 100% offline.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü¶é</text></svg>">
    <style>
        :root {
            --bg:#030306;--surface:#0a0a0f;--card:#101018;--elevated:#181822;
            --border:rgba(255,255,255,0.05);--border-hover:rgba(255,255,255,0.12);
            --text:#f5f5f7;--text-dim:#9898a8;--text-muted:#5c5c6c;
            --accent:#00d4aa;--accent-glow:rgba(0,212,170,0.35);
            --purple:#9c5cff;--pink:#ff5c9c;--orange:#ff8c42;--blue:#4c9cff;
            --success:#22c55e;--error:#ff4466;
            --radius:16px;--radius-lg:24px;--radius-xl:32px;
        }
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;line-height:1.5;overflow-x:hidden}
        
        @keyframes glow{0%,100%{filter:drop-shadow(0 0 20px var(--accent-glow))}50%{filter:drop-shadow(0 0 40px var(--accent-glow))}}
        @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
        @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
        @keyframes spin{to{transform:rotate(360deg)}}
        @keyframes reveal{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
        @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
        @keyframes cardFlip{0%{transform:rotateY(0)}50%{transform:rotateY(90deg)}100%{transform:rotateY(0)}}
        @keyframes magic{0%{transform:scale(1);filter:blur(0)}50%{transform:scale(1.05);filter:blur(6px) brightness(1.3)}100%{transform:scale(1);filter:blur(0)}}
        
        /* Header */
        header{position:sticky;top:0;z-index:100;background:rgba(3,3,6,0.92);backdrop-filter:blur(24px);border-bottom:1px solid var(--border)}
        .header-inner{max-width:1800px;margin:0 auto;padding:12px 24px;display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap}
        .logo{display:flex;align-items:center;gap:12px;cursor:pointer}
        .logo-icon{width:52px;height:52px;border-radius:14px;background:linear-gradient(135deg,var(--accent),var(--purple));display:flex;align-items:center;justify-content:center;font-size:28px;animation:glow 3s ease-in-out infinite}
        .logo-text h1{font-size:24px;font-weight:800;background:linear-gradient(135deg,var(--accent),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .logo-text p{font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:1.5px}
        
        .nav{display:flex;gap:4px;background:var(--surface);padding:5px;border-radius:12px;border:1px solid var(--border)}
        .nav-btn{padding:10px 16px;border:none;background:transparent;color:var(--text-dim);font-size:12px;font-weight:600;cursor:pointer;border-radius:8px;transition:all 0.2s;white-space:nowrap}
        .nav-btn:hover{color:var(--text);background:var(--card)}
        .nav-btn.active{background:var(--accent);color:#000}
        
        /* Main */
        main{max-width:1800px;margin:0 auto;padding:24px}
        .section{display:none}.section.active{display:block;animation:reveal 0.4s ease}
        
        /* Hero */
        .hero{text-align:center;margin-bottom:40px;position:relative}
        .hero::before{content:'';position:absolute;top:-80px;left:50%;transform:translateX(-50%);width:500px;height:500px;background:radial-gradient(circle,var(--accent-glow) 0%,transparent 70%);opacity:0.25;pointer-events:none}
        .hero-badge{display:inline-flex;align-items:center;gap:8px;padding:10px 20px;background:var(--card);border:1px solid var(--accent);border-radius:50px;font-size:12px;font-weight:600;color:var(--accent);margin-bottom:20px}
        .hero-badge .dot{width:6px;height:6px;background:var(--accent);border-radius:50%;animation:pulse 2s infinite}
        .hero h2{font-size:clamp(28px,5vw,48px);font-weight:800;margin-bottom:12px}
        .hero h2 span{background:linear-gradient(135deg,var(--accent),var(--purple),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .hero p{font-size:16px;color:var(--text-dim);max-width:550px;margin:0 auto}
        
        /* Category Selector */
        .category-bar{display:flex;gap:12px;justify-content:center;margin-bottom:32px;flex-wrap:wrap}
        .category-btn{padding:14px 24px;background:var(--card);border:2px solid var(--border);border-radius:14px;color:var(--text-dim);font-size:13px;font-weight:600;cursor:pointer;transition:all 0.3s;display:flex;flex-direction:column;align-items:center;gap:6px;min-width:100px}
        .category-btn:hover{border-color:var(--border-hover);transform:translateY(-3px)}
        .category-btn.active{border-color:var(--accent);background:rgba(0,212,170,0.1);color:var(--accent)}
        .category-btn .icon{font-size:28px}
        .category-btn .label{font-size:11px}
        
        /* Format Selector */
        .format-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px;margin-bottom:24px}
        .format-btn{padding:16px 12px;background:var(--surface);border:2px solid var(--border);border-radius:12px;text-align:center;cursor:pointer;transition:all 0.3s}
        .format-btn:hover{border-color:var(--border-hover);transform:translateY(-2px)}
        .format-btn.active{border-color:var(--accent);background:rgba(0,212,170,0.08)}
        .format-btn .icon{font-size:32px;margin-bottom:6px;display:block}
        .format-btn .name{font-size:12px;font-weight:600;margin-bottom:2px}
        .format-btn .size{font-size:10px;color:var(--text-muted)}
        
        /* Panels */
        .app-grid{display:grid;grid-template-columns:1fr;gap:24px}
        @media(min-width:1200px){.app-grid{grid-template-columns:480px 1fr}}
        
        .panel{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden;position:relative}
        .panel::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--accent),var(--purple),var(--pink))}
        .panel-body{padding:20px}
        .panel-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:10px}
        .panel-title{font-size:18px;font-weight:700;display:flex;align-items:center;gap:8px}
        .badge{font-size:10px;font-weight:700;padding:4px 10px;border-radius:16px;text-transform:uppercase}
        .badge-ai{background:linear-gradient(135deg,var(--accent),var(--purple));color:#000}
        
        /* Canvas */
        .canvas-wrap{position:relative;background:var(--surface);border-radius:var(--radius);overflow:hidden;margin-bottom:16px;border:2px solid var(--border);transition:all 0.3s}
        .canvas-wrap.active{border-color:var(--accent)}
        .canvas-wrap.magic{animation:magic 1.2s ease}
        #drawCanvas{width:100%;display:block;cursor:crosshair;touch-action:none;background:#fafafa}
        .canvas-hint{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;pointer-events:none;text-align:center;padding:20px;transition:opacity 0.3s;background:rgba(250,250,250,0.95)}
        .canvas-hint.hidden{opacity:0}
        .canvas-hint .icon{font-size:56px;margin-bottom:12px;animation:float 3s ease-in-out infinite}
        .canvas-hint .title{font-size:18px;font-weight:700;color:#333;margin-bottom:4px}
        .canvas-hint .sub{font-size:13px;color:#666}
        
        /* Tools */
        .section-label{font-size:11px;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px}
        .tools-row{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px}
        .tool-btn{padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:var(--surface);color:var(--text);font-size:12px;font-weight:500;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:5px}
        .tool-btn:hover{background:var(--elevated);transform:translateY(-1px)}
        .tool-btn.active{background:var(--accent);border-color:var(--accent);color:#000}
        
        .colors-row{display:flex;gap:6px;flex-wrap:wrap;align-items:center;margin-bottom:14px}
        .color-swatch{width:32px;height:32px;border-radius:8px;cursor:pointer;border:2px solid transparent;transition:all 0.15s}
        .color-swatch:hover{transform:scale(1.12)}
        .color-swatch.active{border-color:var(--accent);box-shadow:0 0 12px var(--accent-glow)}
        
        .slider-row{display:flex;align-items:center;gap:12px;margin-bottom:14px}
        .slider-row label{font-size:12px;font-weight:600;color:var(--text-dim);min-width:50px}
        .slider-row input[type="range"]{flex:1;height:6px;border-radius:3px;appearance:none;background:var(--surface)}
        .slider-row input[type="range"]::-webkit-slider-thumb{appearance:none;width:20px;height:20px;border-radius:50%;background:var(--accent);cursor:pointer;box-shadow:0 2px 8px var(--accent-glow)}
        .slider-row span{font-size:11px;color:var(--text-muted);min-width:36px;text-align:right}
        
        /* Style Grid */
        .style-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:16px}
        @media(max-width:500px){.style-grid{grid-template-columns:repeat(2,1fr)}}
        .style-btn{padding:14px 10px;background:var(--surface);border:2px solid var(--border);border-radius:10px;text-align:center;cursor:pointer;transition:all 0.3s}
        .style-btn:hover{border-color:var(--border-hover);transform:translateY(-2px)}
        .style-btn.active{border-color:var(--accent);background:rgba(0,212,170,0.08)}
        .style-btn .icon{font-size:24px;margin-bottom:4px;display:block}
        .style-btn .name{font-size:11px;font-weight:600}
        
        /* Generate Button */
        .gen-btn{width:100%;padding:18px;border:none;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;transition:all 0.3s;color:#000;background:linear-gradient(135deg,var(--accent),#00ffcc);position:relative;overflow:hidden}
        .gen-btn::before{content:'';position:absolute;top:0;left:-100%;width:200%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);animation:shimmer 3s infinite}
        .gen-btn:hover{transform:translateY(-2px);box-shadow:0 12px 40px var(--accent-glow)}
        .gen-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
        .spinner{width:20px;height:20px;border:3px solid rgba(0,0,0,0.2);border-top-color:#000;border-radius:50%;animation:spin 0.8s linear infinite}
        
        /* Preview */
        .preview-container{perspective:1200px;margin-bottom:20px}
        .preview-card{width:100%;max-width:400px;margin:0 auto;position:relative;transform-style:preserve-3d;transition:transform 0.8s cubic-bezier(0.4,0,0.2,1)}
        .preview-card.flipped{transform:rotateY(180deg)}
        .preview-front,.preview-back{position:absolute;inset:0;backface-visibility:hidden;border-radius:var(--radius);overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,0.4)}
        .preview-back{transform:rotateY(180deg);background:#f5f5f5}
        .preview-front{background:#fafafa}
        .preview-front canvas{width:100%;height:100%;display:block}
        
        /* Text Editor */
        .text-editor{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:14px}
        .text-editor-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
        .text-editor-title{font-size:13px;font-weight:600}
        .text-input{width:100%;padding:10px;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:13px;resize:none;margin-bottom:10px}
        .text-input:focus{outline:none;border-color:var(--accent)}
        .text-controls{display:flex;gap:6px;flex-wrap:wrap;align-items:center}
        .text-ctrl{padding:7px 10px;background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:11px;cursor:pointer;transition:all 0.2s}
        .text-ctrl:hover{background:var(--elevated)}
        .text-ctrl.active{background:var(--accent);color:#000;border-color:var(--accent)}
        .font-select{padding:7px 10px;background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:11px}
        
        .text-block{position:absolute;cursor:move;padding:6px 10px;border:2px dashed transparent;border-radius:4px;user-select:none}
        .text-block:hover,.text-block.selected{border-color:var(--accent)}
        
        /* Results Grid */
        .results-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:16px}
        @media(min-width:1400px){.results-grid{grid-template-columns:repeat(3,1fr)}}
        .result-card{background:var(--surface);border:2px solid var(--border);border-radius:12px;overflow:hidden;cursor:pointer;transition:all 0.3s}
        .result-card:hover{border-color:var(--border-hover);transform:translateY(-3px);box-shadow:0 12px 40px rgba(0,0,0,0.3)}
        .result-card.selected{border-color:var(--accent);box-shadow:0 0 24px var(--accent-glow)}
        .result-card-img{aspect-ratio:4/3;background:#1a1a2e;position:relative}
        .result-card-img canvas{width:100%;height:100%;display:block}
        .result-card-placeholder{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:16px;text-align:center}
        .result-card-placeholder .icon{font-size:36px;margin-bottom:8px;opacity:0.5}
        .result-card-placeholder .text{font-size:11px;color:var(--text-muted)}
        .result-card-info{padding:12px}
        .result-card-name{font-size:13px;font-weight:600;margin-bottom:2px;display:flex;align-items:center;gap:6px}
        .result-card-desc{font-size:10px;color:var(--text-muted)}
        .result-loading{position:absolute;inset:0;background:rgba(0,0,0,0.85);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px}
        .result-loading .spinner{width:36px;height:36px;border-width:3px;border-color:rgba(255,255,255,0.2);border-top-color:var(--accent)}
        
        /* Actions */
        .actions-row{display:flex;gap:10px;flex-wrap:wrap}
        .action-btn{flex:1;min-width:110px;padding:12px 16px;border-radius:10px;border:1px solid var(--border);background:var(--surface);color:var(--text);font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;justify-content:center;gap:6px}
        .action-btn:hover{background:var(--elevated);transform:translateY(-2px)}
        .action-btn.primary{background:var(--accent);border-color:var(--accent);color:#000}
        .action-btn:disabled{opacity:0.5;cursor:not-allowed}
        
        /* Gallery */
        .gallery-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:20px}
        .gallery-item{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;cursor:pointer;transition:all 0.3s}
        .gallery-item:hover{transform:translateY(-6px);box-shadow:0 20px 60px rgba(0,0,0,0.4);border-color:var(--accent)}
        .gallery-item-img{aspect-ratio:4/3;background:#1a1a2e}
        .gallery-item-img img,.gallery-item-img canvas{width:100%;height:100%;object-fit:cover}
        .gallery-item-info{padding:14px}
        .gallery-item-title{font-size:14px;font-weight:600;margin-bottom:4px}
        .gallery-item-meta{font-size:11px;color:var(--text-muted)}
        
        /* Empty State */
        .empty-state{grid-column:1/-1;text-align:center;padding:60px 20px;background:var(--card);border-radius:var(--radius-lg);border:1px dashed var(--border)}
        .empty-state .icon{font-size:56px;margin-bottom:16px;opacity:0.4}
        .empty-state h3{margin-bottom:8px}
        .empty-state p{color:var(--text-muted)}
        
        /* Filter Bar */
        .filter-bar{display:flex;gap:8px;justify-content:center;margin-bottom:32px;flex-wrap:wrap}
        .filter-btn{padding:10px 18px;background:var(--surface);border:1px solid var(--border);border-radius:50px;color:var(--text-dim);font-size:12px;font-weight:500;cursor:pointer;transition:all 0.2s}
        .filter-btn:hover{color:var(--text);background:var(--card)}
        .filter-btn.active{background:var(--accent);border-color:var(--accent);color:#000}
        
        /* Toast */
        .toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(100px);padding:14px 24px;background:var(--elevated);border:1px solid var(--border);border-radius:12px;font-size:13px;font-weight:600;z-index:1000;opacity:0;transition:all 0.4s;box-shadow:0 12px 40px rgba(0,0,0,0.4);display:flex;align-items:center;gap:10px}
        .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
        .toast.success{border-color:var(--accent)}
        .toast.error{border-color:var(--error)}
        
        /* Footer */
        footer{text-align:center;padding:24px;border-top:1px solid var(--border);color:var(--text-muted);font-size:12px}
        
        /* Mobile */
        @media(max-width:600px){
            header{padding:10px 12px}
            .logo-icon{width:40px;height:40px;font-size:22px}
            .logo-text h1{font-size:18px}
            main{padding:16px}
            .panel-body{padding:14px}
            .category-btn{padding:10px 14px;min-width:80px}
            .category-btn .icon{font-size:22px}
        }
    </style>
</head>
<body>
    <header>
        <div class="header-inner">
            <div class="logo" onclick="showSection('create')">
                <div class="logo-icon">ü¶é</div>
                <div class="logo-text"><h1>Chameleon Studios</h1><p>Professional Cards‚Ñ¢</p></div>
            </div>
            <nav class="nav">
                <button class="nav-btn active" data-section="create" onclick="showSection('create')">‚ú® Create</button>
                <button class="nav-btn" data-section="templates" onclick="showSection('templates')">üìã Templates</button>
                <button class="nav-btn" data-section="saved" onclick="showSection('saved')">üíæ Saved</button>
            </nav>
        </div>
    </header>
    
    <main>
        <!-- CREATE SECTION -->
        <section id="section-create" class="section active">
            <div class="hero">
                <div class="hero-badge"><span class="dot"></span>6 AI Styles ‚Ä¢ All Card Formats ‚Ä¢ Offline</div>
                <h2>Create <span>Any Card</span> You Can Imagine</h2>
                <p>Business cards, greeting cards, e-cards, foldables, postcards ‚Äî draw once, transform into 6 stunning art styles.</p>
            </div>
            
            <!-- Category Selector -->
            <div class="category-bar" id="categoryBar">
                <button class="category-btn active" data-cat="business" onclick="selectCategory('business')">
                    <span class="icon">üíº</span><span class="label">Business</span>
                </button>
                <button class="category-btn" data-cat="greeting" onclick="selectCategory('greeting')">
                    <span class="icon">üéâ</span><span class="label">Greeting</span>
                </button>
                <button class="category-btn" data-cat="ecard" onclick="selectCategory('ecard')">
                    <span class="icon">üìß</span><span class="label">E-Card</span>
                </button>
                <button class="category-btn" data-cat="foldable" onclick="selectCategory('foldable')">
                    <span class="icon">üìÑ</span><span class="label">Foldable</span>
                </button>
                <button class="category-btn" data-cat="postcard" onclick="selectCategory('postcard')">
                    <span class="icon">üèñÔ∏è</span><span class="label">Postcard</span>
                </button>
                <button class="category-btn" data-cat="invite" onclick="selectCategory('invite')">
                    <span class="icon">üíå</span><span class="label">Invitation</span>
                </button>
            </div>
            
            <!-- Format Selector -->
            <div class="format-grid" id="formatGrid"></div>
            
            <div class="app-grid">
                <!-- Drawing Panel -->
                <div class="panel">
                    <div class="panel-body">
                        <div class="panel-header">
                            <div class="panel-title">üé® Design</div>
                            <span class="badge badge-ai">AI Transform</span>
                        </div>
                        
                        <div class="canvas-wrap" id="canvasWrap">
                            <canvas id="drawCanvas"></canvas>
                            <div class="canvas-hint" id="canvasHint">
                                <div class="icon">‚úèÔ∏è</div>
                                <div class="title">Start Designing!</div>
                                <div class="sub">Draw your card design here</div>
                            </div>
                        </div>
                        
                        <div class="section-label">Tools</div>
                        <div class="tools-row">
                            <button class="tool-btn active" data-tool="pen" onclick="setTool('pen')">‚úèÔ∏è Pen</button>
                            <button class="tool-btn" data-tool="brush" onclick="setTool('brush')">üñåÔ∏è Brush</button>
                            <button class="tool-btn" data-tool="marker" onclick="setTool('marker')">üñçÔ∏è Marker</button>
                            <button class="tool-btn" data-tool="eraser" onclick="setTool('eraser')">üßΩ Eraser</button>
                            <button class="tool-btn" onclick="clearCanvas()">üóëÔ∏è</button>
                            <button class="tool-btn" onclick="undoStroke()">‚Ü©Ô∏è</button>
                        </div>
                        
                        <div class="section-label">Colors</div>
                        <div class="colors-row">
                            <div class="color-swatch active" style="background:#000" data-color="#000000" onclick="setColor('#000000')"></div>
                            <div class="color-swatch" style="background:#555" data-color="#555555" onclick="setColor('#555555')"></div>
                            <div class="color-swatch" style="background:#e74c3c" data-color="#e74c3c" onclick="setColor('#e74c3c')"></div>
                            <div class="color-swatch" style="background:#e67e22" data-color="#e67e22" onclick="setColor('#e67e22')"></div>
                            <div class="color-swatch" style="background:#f1c40f" data-color="#f1c40f" onclick="setColor('#f1c40f')"></div>
                            <div class="color-swatch" style="background:#2ecc71" data-color="#2ecc71" onclick="setColor('#2ecc71')"></div>
                            <div class="color-swatch" style="background:#3498db" data-color="#3498db" onclick="setColor('#3498db')"></div>
                            <div class="color-swatch" style="background:#9b59b6" data-color="#9b59b6" onclick="setColor('#9b59b6')"></div>
                            <div class="color-swatch" style="background:#e91e63" data-color="#e91e63" onclick="setColor('#e91e63')"></div>
                            <input type="color" id="customColor" value="#00d4aa" style="width:32px;height:32px;border:none;border-radius:8px;cursor:pointer" onchange="setColor(this.value)">
                        </div>
                        
                        <div class="slider-row">
                            <label>Size</label>
                            <input type="range" id="strokeSize" min="1" max="30" value="4" oninput="setStrokeSize(this.value)">
                            <span id="strokeDisplay">4px</span>
                        </div>
                        
                        <div class="section-label">AI Styles (transforms your sketch)</div>
                        <div class="style-grid">
                            <div class="style-btn active" data-style="comic" onclick="setStyle('comic')"><span class="icon">üí•</span><span class="name">Comic</span></div>
                            <div class="style-btn" data-style="realistic" onclick="setStyle('realistic')"><span class="icon">üì∑</span><span class="name">Realistic</span></div>
                            <div class="style-btn" data-style="postcard" onclick="setStyle('postcard')"><span class="icon">üèñÔ∏è</span><span class="name">Postcard</span></div>
                            <div class="style-btn" data-style="stencil" onclick="setStyle('stencil')"><span class="icon">üé≠</span><span class="name">Stencil</span></div>
                            <div class="style-btn" data-style="watercolor" onclick="setStyle('watercolor')"><span class="icon">üé®</span><span class="name">Watercolor</span></div>
                            <div class="style-btn" data-style="funky" onclick="setStyle('funky')"><span class="icon">üåà</span><span class="name">Funky</span></div>
                        </div>
                        
                        <button class="gen-btn" id="genBtn" onclick="transformCard()">
                            <span>ü¶é Transform Into 6 Styles</span>
                        </button>
                    </div>
                </div>
                
                <!-- Results Panel -->
                <div class="panel">
                    <div class="panel-body">
                        <div class="panel-header">
                            <div class="panel-title">‚ú® Results</div>
                            <button class="tool-btn" onclick="flipPreview()">üîÑ Flip</button>
                        </div>
                        
                        <div class="results-grid" id="resultsGrid">
                            <div class="result-card" id="card-comic" onclick="selectResult('comic')">
                                <div class="result-card-img" id="img-comic"><div class="result-card-placeholder"><span class="icon">üí•</span><span class="text">Comic</span></div></div>
                                <div class="result-card-info"><div class="result-card-name">üí• Comic</div><div class="result-card-desc">Bold outlines, halftone</div></div>
                            </div>
                            <div class="result-card" id="card-realistic" onclick="selectResult('realistic')">
                                <div class="result-card-img" id="img-realistic"><div class="result-card-placeholder"><span class="icon">üì∑</span><span class="text">Realistic</span></div></div>
                                <div class="result-card-info"><div class="result-card-name">üì∑ Realistic</div><div class="result-card-desc">Shadows, depth</div></div>
                            </div>
                            <div class="result-card" id="card-postcard" onclick="selectResult('postcard')">
                                <div class="result-card-img" id="img-postcard"><div class="result-card-placeholder"><span class="icon">üèñÔ∏è</span><span class="text">Postcard</span></div></div>
                                <div class="result-card-info"><div class="result-card-name">üèñÔ∏è Postcard</div><div class="result-card-desc">Vintage, warm</div></div>
                            </div>
                            <div class="result-card" id="card-stencil" onclick="selectResult('stencil')">
                                <div class="result-card-img" id="img-stencil"><div class="result-card-placeholder"><span class="icon">üé≠</span><span class="text">Stencil</span></div></div>
                                <div class="result-card-info"><div class="result-card-name">üé≠ Stencil</div><div class="result-card-desc">High contrast</div></div>
                            </div>
                            <div class="result-card" id="card-watercolor" onclick="selectResult('watercolor')">
                                <div class="result-card-img" id="img-watercolor"><div class="result-card-placeholder"><span class="icon">üé®</span><span class="text">Watercolor</span></div></div>
                                <div class="result-card-info"><div class="result-card-name">üé® Watercolor</div><div class="result-card-desc">Soft, flowing</div></div>
                            </div>
                            <div class="result-card" id="card-funky" onclick="selectResult('funky')">
                                <div class="result-card-img" id="img-funky"><div class="result-card-placeholder"><span class="icon">üåà</span><span class="text">Funky</span></div></div>
                                <div class="result-card-info"><div class="result-card-name">üåà Funky</div><div class="result-card-desc">Psychedelic</div></div>
                            </div>
                        </div>
                        
                        <div class="text-editor">
                            <div class="text-editor-header"><span class="text-editor-title">‚úçÔ∏è Add Text</span><button class="tool-btn" onclick="addText()">+ Add</button></div>
                            <textarea class="text-input" id="textInput" rows="2" placeholder="Your text here..."></textarea>
                            <div class="text-controls">
                                <select class="font-select" id="fontSelect" onchange="updateText()">
                                    <option value="Arial">Arial</option><option value="Georgia">Georgia</option><option value="Times New Roman">Times</option><option value="Courier New">Courier</option><option value="Impact">Impact</option><option value="Comic Sans MS">Comic Sans</option>
                                </select>
                                <button class="text-ctrl" id="boldBtn" onclick="toggleBold()"><b>B</b></button>
                                <button class="text-ctrl" id="italicBtn" onclick="toggleItalic()"><i>I</i></button>
                                <input type="color" id="textColor" value="#000000" style="width:28px;height:28px;border:none;border-radius:4px;cursor:pointer" onchange="updateText()">
                                <button class="text-ctrl" onclick="changeTextSize(-2)">A-</button>
                                <span id="textSizeDisplay" style="font-size:11px;color:var(--text-dim)">24</span>
                                <button class="text-ctrl" onclick="changeTextSize(2)">A+</button>
                            </div>
                        </div>
                        
                        <div class="actions-row">
                            <button class="action-btn" onclick="downloadSelected()" id="downloadBtn" disabled>‚¨áÔ∏è Download</button>
                            <button class="action-btn" onclick="downloadAll()">üì¶ All 6</button>
                            <button class="action-btn" onclick="printCard()">üñ®Ô∏è Print</button>
                            <button class="action-btn primary" onclick="saveCard()">üíæ Save</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- TEMPLATES SECTION -->
        <section id="section-templates" class="section">
            <div class="hero" style="margin-bottom:24px">
                <h2>üìã Templates</h2>
                <p>Start with a professional template</p>
            </div>
            <div class="filter-bar">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="business">üíº Business</button>
                <button class="filter-btn" data-filter="greeting">üéâ Greeting</button>
                <button class="filter-btn" data-filter="invite">üíå Invitation</button>
            </div>
            <div class="gallery-grid" id="templatesGrid"></div>
        </section>
        
        <!-- SAVED SECTION -->
        <section id="section-saved" class="section">
            <div class="hero" style="margin-bottom:24px">
                <h2>üíæ Saved Cards</h2>
                <p>Your creations, stored locally</p>
            </div>
            <div class="gallery-grid" id="savedGrid"></div>
        </section>
    </main>
    
    <footer><p><strong>Chameleon Studios‚Ñ¢</strong> by Stellar Studios ‚Ä¢ Professional Cards ‚Ä¢ 100% Offline</p></footer>
    <div class="toast" id="toast"></div>
    
    <script>
    (function(){
        'use strict';
        
        // ===== FORMATS =====
        const FORMATS = {
            business: [
                {id:'biz-standard',name:'Standard',size:'3.5√ó2"',w:700,h:400,icon:'üíº'},
                {id:'biz-vertical',name:'Vertical',size:'2√ó3.5"',w:400,h:700,icon:'üìá'},
                {id:'biz-square',name:'Square',size:'2.5√ó2.5"',w:500,h:500,icon:'‚¨ú'},
                {id:'biz-folded',name:'Folded',size:'3.5√ó4"',w:700,h:800,icon:'üìÅ'}
            ],
            greeting: [
                {id:'greet-birthday',name:'Birthday',size:'5√ó7"',w:500,h:700,icon:'üéÇ'},
                {id:'greet-thankyou',name:'Thank You',size:'5√ó7"',w:500,h:700,icon:'üíö'},
                {id:'greet-congrats',name:'Congrats',size:'5√ó7"',w:500,h:700,icon:'üèÜ'},
                {id:'greet-holiday',name:'Holiday',size:'5√ó7"',w:500,h:700,icon:'üéÑ'},
                {id:'greet-wedding',name:'Wedding',size:'5√ó7"',w:500,h:700,icon:'üíí'},
                {id:'greet-baby',name:'Baby',size:'5√ó7"',w:500,h:700,icon:'üë∂'}
            ],
            ecard: [
                {id:'ecard-animated',name:'Animated',size:'800√ó600',w:800,h:600,icon:'‚ú®'},
                {id:'ecard-photo',name:'Photo Card',size:'800√ó600',w:800,h:600,icon:'üì∏'},
                {id:'ecard-simple',name:'Simple',size:'800√ó600',w:800,h:600,icon:'üìß'}
            ],
            foldable: [
                {id:'fold-half',name:'Half Fold',size:'8.5√ó5.5"',w:850,h:550,icon:'üìÑ'},
                {id:'fold-tri',name:'Tri-Fold',size:'8.5√ó3.67"',w:850,h:367,icon:'üìÉ'},
                {id:'fold-z',name:'Z-Fold',size:'8.5√ó3.67"',w:850,h:367,icon:'üìú'},
                {id:'fold-gate',name:'Gate Fold',size:'8.5√ó5.5"',w:850,h:550,icon:'üö™'}
            ],
            postcard: [
                {id:'post-standard',name:'Standard',size:'6√ó4"',w:600,h:400,icon:'üèñÔ∏è'},
                {id:'post-large',name:'Large',size:'8√ó5"',w:800,h:500,icon:'üó∫Ô∏è'},
                {id:'post-square',name:'Square',size:'5√ó5"',w:500,h:500,icon:'üì¨'}
            ],
            invite: [
                {id:'inv-wedding',name:'Wedding',size:'5√ó7"',w:500,h:700,icon:'üíç'},
                {id:'inv-party',name:'Party',size:'5√ó7"',w:500,h:700,icon:'üéâ'},
                {id:'inv-dinner',name:'Dinner',size:'5√ó7"',w:500,h:700,icon:'üçΩÔ∏è'},
                {id:'inv-graduation',name:'Graduation',size:'5√ó7"',w:500,h:700,icon:'üéì'},
                {id:'inv-baby',name:'Baby Shower',size:'5√ó7"',w:500,h:700,icon:'üçº'}
            ]
        };
        
        // ===== STATE =====
        let canvas,ctx,currentCategory='business',currentFormat=FORMATS.business[0];
        let isDrawing=false,hasDrawn=false,strokeHistory=[],currentStroke=[];
        let currentTool='pen',currentColor='#000000',strokeSize=4;
        let selectedStyle='comic',selectedResult=null,generatedCanvases={};
        let textBlocks=[],selectedText=null,textSize=24,isBold=false,isItalic=false;
        let savedCards=[];
        
        // ===== INIT =====
        document.addEventListener('DOMContentLoaded',()=>{
            renderFormats();
            initCanvas();
            loadSaved();
            initTemplates();
            initFilters();
        });
        
        function renderFormats(){
            const grid=document.getElementById('formatGrid');
            const formats=FORMATS[currentCategory];
            grid.innerHTML=formats.map((f,i)=>`
                <div class="format-btn${i===0?' active':''}" data-format="${f.id}" onclick="selectFormat('${f.id}')">
                    <span class="icon">${f.icon}</span>
                    <div class="name">${f.name}</div>
                    <div class="size">${f.size}</div>
                </div>
            `).join('');
            currentFormat=formats[0];
        }
        
        window.selectCategory=function(cat){
            currentCategory=cat;
            document.querySelectorAll('.category-btn').forEach(b=>b.classList.toggle('active',b.dataset.cat===cat));
            renderFormats();
            initCanvas();
        };
        
        window.selectFormat=function(id){
            const formats=FORMATS[currentCategory];
            currentFormat=formats.find(f=>f.id===id)||formats[0];
            document.querySelectorAll('.format-btn').forEach(b=>b.classList.toggle('active',b.dataset.format===id));
            initCanvas();
            toast(`Format: ${currentFormat.name}`);
        };
        
        function initCanvas(){
            canvas=document.getElementById('drawCanvas');
            ctx=canvas.getContext('2d',{willReadFrequently:true});
            
            const wrap=canvas.parentElement;
            const maxW=wrap.offsetWidth-4;
            const scale=Math.min(maxW/currentFormat.w,1);
            
            canvas.width=currentFormat.w*2;
            canvas.height=currentFormat.h*2;
            canvas.style.width=(currentFormat.w*scale)+'px';
            canvas.style.height=(currentFormat.h*scale)+'px';
            
            ctx.fillStyle='#fafafa';
            ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.lineCap='round';ctx.lineJoin='round';
            
            strokeHistory=[];hasDrawn=false;
            document.getElementById('canvasHint').classList.remove('hidden');
            document.getElementById('canvasWrap').classList.remove('active');
            
            canvas.onmousedown=startStroke;
            canvas.onmousemove=drawStroke;
            canvas.onmouseup=canvas.onmouseleave=endStroke;
            canvas.ontouchstart=e=>{e.preventDefault();startStroke(e.touches[0]);};
            canvas.ontouchmove=e=>{e.preventDefault();drawStroke(e.touches[0]);};
            canvas.ontouchend=endStroke;
        }
        
        function getPos(e){
            const r=canvas.getBoundingClientRect();
            return{x:(e.clientX-r.left)*(canvas.width/r.width),y:(e.clientY-r.top)*(canvas.height/r.height)};
        }
        
        function startStroke(e){
            isDrawing=true;
            const p=getPos(e);
            currentStroke=[{x:p.x,y:p.y,color:currentColor,size:strokeSize,tool:currentTool}];
            ctx.beginPath();ctx.moveTo(p.x,p.y);
            if(!hasDrawn){hasDrawn=true;document.getElementById('canvasHint').classList.add('hidden');document.getElementById('canvasWrap').classList.add('active');}
        }
        
        function drawStroke(e){
            if(!isDrawing)return;
            const p=getPos(e);
            currentStroke.push({x:p.x,y:p.y});
            
            const sc=canvas.width/canvas.offsetWidth;
            let sz=strokeSize*sc;
            
            if(currentTool==='eraser'){ctx.globalCompositeOperation='destination-out';ctx.strokeStyle='rgba(0,0,0,1)';sz*=3;}
            else{ctx.globalCompositeOperation='source-over';ctx.strokeStyle=currentColor;
                if(currentTool==='brush'){sz*=2;ctx.globalAlpha=0.7;}
                else if(currentTool==='marker'){sz*=3;ctx.globalAlpha=0.4;}
                else ctx.globalAlpha=1;
            }
            
            ctx.lineWidth=sz;
            ctx.lineTo(p.x,p.y);ctx.stroke();
            ctx.beginPath();ctx.moveTo(p.x,p.y);
        }
        
        function endStroke(){
            if(isDrawing&&currentStroke.length>0)strokeHistory.push([...currentStroke]);
            isDrawing=false;ctx.globalAlpha=1;ctx.globalCompositeOperation='source-over';currentStroke=[];
        }
        
        window.setTool=t=>{currentTool=t;document.querySelectorAll('.tool-btn[data-tool]').forEach(b=>b.classList.toggle('active',b.dataset.tool===t));};
        window.setColor=c=>{currentColor=c;document.querySelectorAll('.color-swatch').forEach(s=>s.classList.toggle('active',s.dataset.color===c));};
        window.setStrokeSize=s=>{strokeSize=parseInt(s);document.getElementById('strokeDisplay').textContent=s+'px';};
        window.clearCanvas=()=>{ctx.fillStyle='#fafafa';ctx.fillRect(0,0,canvas.width,canvas.height);strokeHistory=[];hasDrawn=false;document.getElementById('canvasHint').classList.remove('hidden');document.getElementById('canvasWrap').classList.remove('active');toast('Cleared');};
        window.undoStroke=()=>{if(strokeHistory.length===0)return;strokeHistory.pop();redraw();toast('Undone');};
        
        function redraw(){
            ctx.fillStyle='#fafafa';ctx.fillRect(0,0,canvas.width,canvas.height);
            strokeHistory.forEach(stroke=>{
                if(!stroke.length)return;
                ctx.beginPath();ctx.strokeStyle=stroke[0].color;ctx.lineWidth=stroke[0].size*(canvas.width/canvas.offsetWidth);
                ctx.moveTo(stroke[0].x,stroke[0].y);
                for(let i=1;i<stroke.length;i++)ctx.lineTo(stroke[i].x,stroke[i].y);
                ctx.stroke();
            });
        }
        
        window.setStyle=s=>{selectedStyle=s;document.querySelectorAll('.style-btn').forEach(b=>b.classList.toggle('active',b.dataset.style===s));};
        
        // ===== TRANSFORMATION =====
        window.transformCard=function(){
            if(!hasDrawn){toast('Draw something first!','error');return;}
            
            const btn=document.getElementById('genBtn');
            btn.disabled=true;btn.innerHTML='<div class="spinner"></div> Transforming...';
            document.getElementById('canvasWrap').classList.add('magic');
            
            const styles=['comic','realistic','postcard','stencil','watercolor','funky'];
            let done=0;
            
            styles.forEach((style,i)=>{
                const container=document.getElementById('img-'+style);
                container.innerHTML='<div class="result-loading"><div class="spinner"></div></div>';
                
                setTimeout(()=>{
                    const cvs=document.createElement('canvas');
                    cvs.width=canvas.width;cvs.height=canvas.height;
                    const c=cvs.getContext('2d');
                    c.drawImage(canvas,0,0);
                    applyStyle(c,cvs,style);
                    generatedCanvases[style]=cvs;
                    
                    container.innerHTML='';
                    const display=document.createElement('canvas');
                    display.width=cvs.width;display.height=cvs.height;
                    display.getContext('2d').drawImage(cvs,0,0);
                    display.style.width='100%';display.style.height='100%';
                    container.appendChild(display);
                    
                    done++;
                    if(done===6){
                        btn.disabled=false;btn.innerHTML='<span>ü¶é Transform Into 6 Styles</span>';
                        document.getElementById('canvasWrap').classList.remove('magic');
                        toast('‚ú® 6 styles created!','success');
                    }
                },200+(i*350));
            });
        };
        
        function applyStyle(ctx,cvs,style){
            const img=ctx.getImageData(0,0,cvs.width,cvs.height),d=img.data,w=cvs.width,h=cvs.height;
            
            if(style==='comic'){
                const edges=detectEdges(d,w,h);
                for(let i=0;i<d.length;i+=4){d[i]=Math.floor(d[i]/64)*85;d[i+1]=Math.floor(d[i+1]/64)*85;d[i+2]=Math.floor(d[i+2]/64)*85;const avg=(d[i]+d[i+1]+d[i+2])/3;d[i]=clamp(d[i]+(d[i]-avg)*0.8);d[i+1]=clamp(d[i+1]+(d[i+1]-avg)*0.8);d[i+2]=clamp(d[i+2]+(d[i+2]-avg)*0.8);}
                for(let i=0;i<edges.length;i++)if(edges[i]>100){const idx=i*4;d[idx]=d[idx+1]=d[idx+2]=0;}
                ctx.putImageData(img,0,0);
                ctx.globalAlpha=0.15;ctx.fillStyle='#000';for(let y=0;y<h;y+=10)for(let x=0;x<w;x+=10)if((x+y)%20===0){ctx.beginPath();ctx.arc(x,y,2.5,0,Math.PI*2);ctx.fill();}ctx.globalAlpha=1;
                ctx.strokeStyle='#000';ctx.lineWidth=8;ctx.strokeRect(8,8,w-16,h-16);
            }
            else if(style==='realistic'){
                applyBlur(d,w,h,2);
                for(let y=0;y<h;y++)for(let x=0;x<w;x++){const idx=(y*w+x)*4;if(d[idx]>240&&d[idx+1]>240&&d[idx+2]>240)continue;const dist=Math.sqrt(Math.pow(x-w*0.3,2)+Math.pow(y-h*0.2,2));const shadow=1-(dist/Math.sqrt(w*w+h*h))*0.4;d[idx]=clamp(d[idx]*shadow+20);d[idx+1]=clamp(d[idx+1]*shadow+15);d[idx+2]=clamp(d[idx+2]*shadow+10);}
                for(let i=0;i<d.length;i+=4){const n=(Math.random()-0.5)*15;d[i]=clamp(d[i]+n);d[i+1]=clamp(d[i+1]+n);d[i+2]=clamp(d[i+2]+n);}
                ctx.putImageData(img,0,0);
            }
            else if(style==='postcard'){
                const cx=w/2,cy=h/2;
                for(let y=0;y<h;y++)for(let x=0;x<w;x++){const idx=(y*w+x)*4;d[idx]=clamp(d[idx]*1.1+30);d[idx+1]=clamp(d[idx+1]+15);d[idx+2]=clamp(d[idx+2]*0.8-10);const dist=Math.sqrt(Math.pow(x-cx,2)+Math.pow(y-cy,2));const vig=1-Math.pow(dist/Math.sqrt(cx*cx+cy*cy),2)*0.5;d[idx]=clamp(d[idx]*vig);d[idx+1]=clamp(d[idx+1]*vig);d[idx+2]=clamp(d[idx+2]*vig);const gr=(Math.random()-0.5)*20;d[idx]=clamp(d[idx]+gr);d[idx+1]=clamp(d[idx+1]+gr);d[idx+2]=clamp(d[idx+2]+gr);}
                ctx.putImageData(img,0,0);
                ctx.strokeStyle='#8b7355';ctx.lineWidth=20;ctx.strokeRect(15,15,w-30,h-30);
                ctx.strokeStyle='#f5f0e8';ctx.lineWidth=6;ctx.strokeRect(30,30,w-60,h-60);
            }
            else if(style==='stencil'){
                for(let i=0;i<d.length;i+=4){const gr=d[i]*0.299+d[i+1]*0.587+d[i+2]*0.114;const v=gr>140?255:0;d[i]=d[i+1]=d[i+2]=v;}
                ctx.putImageData(img,0,0);
                ctx.globalAlpha=0.08;for(let i=0;i<3000;i++){ctx.fillStyle=Math.random()>0.5?'#000':'#fff';ctx.beginPath();ctx.arc(Math.random()*w,Math.random()*h,Math.random()*4+1,0,Math.PI*2);ctx.fill();}ctx.globalAlpha=1;
                ctx.globalCompositeOperation='multiply';ctx.fillStyle='#6644ff';ctx.globalAlpha=0.15;ctx.fillRect(0,0,w,h);ctx.globalCompositeOperation='source-over';ctx.globalAlpha=1;
            }
            else if(style==='watercolor'){
                applyBlur(d,w,h,4);
                for(let i=0;i<d.length;i+=4){if(d[i]>230&&d[i+1]>230&&d[i+2]>230)continue;d[i]=clamp(d[i]*1.1+30);d[i+1]=clamp(d[i+1]*1.1+30);d[i+2]=clamp(d[i+2]*1.1+30);const sh=(Math.random()-0.5)*25;d[i]=clamp(d[i]+sh);d[i+1]=clamp(d[i+1]+sh*0.8);d[i+2]=clamp(d[i+2]+sh*0.6);}
                ctx.putImageData(img,0,0);
                ctx.globalAlpha=0.03;for(let i=0;i<500;i++){const grd=ctx.createRadialGradient(Math.random()*w,Math.random()*h,0,Math.random()*w,Math.random()*h,Math.random()*50+20);grd.addColorStop(0,`hsla(${Math.random()*360},70%,60%,0.3)`);grd.addColorStop(1,'transparent');ctx.fillStyle=grd;ctx.beginPath();ctx.arc(Math.random()*w,Math.random()*h,Math.random()*50+20,0,Math.PI*2);ctx.fill();}ctx.globalAlpha=1;
                ctx.fillStyle='rgba(245,242,235,0.3)';ctx.fillRect(0,0,w,h);
            }
            else if(style==='funky'){
                for(let y=0;y<h;y++)for(let x=0;x<w;x++){const idx=(y*w+x)*4;if(d[idx]>240&&d[idx+1]>240&&d[idx+2]>240)continue;const ang=(x+y)*0.02;d[idx]=clamp((Math.sin(ang)+1)*127+d[idx]*0.3);d[idx+1]=clamp((Math.cos(ang*1.5)+1)*127+d[idx+1]*0.3);d[idx+2]=clamp((Math.sin(ang*2)+1)*127+d[idx+2]*0.3);const avg=(d[idx]+d[idx+1]+d[idx+2])/3;d[idx]=clamp(d[idx]+(d[idx]-avg)*1.5);d[idx+1]=clamp(d[idx+1]+(d[idx+1]-avg)*1.5);d[idx+2]=clamp(d[idx+2]+(d[idx+2]-avg)*1.5);}
                ctx.putImageData(img,0,0);
                const grad=ctx.createLinearGradient(0,0,w,h);grad.addColorStop(0,'rgba(255,0,0,0.1)');grad.addColorStop(0.2,'rgba(255,165,0,0.1)');grad.addColorStop(0.4,'rgba(255,255,0,0.1)');grad.addColorStop(0.6,'rgba(0,255,0,0.1)');grad.addColorStop(0.8,'rgba(0,0,255,0.1)');grad.addColorStop(1,'rgba(238,130,238,0.1)');ctx.fillStyle=grad;ctx.fillRect(0,0,w,h);
                ctx.globalAlpha=0.1;for(let i=0;i<20;i++){ctx.fillStyle=`hsl(${Math.random()*360},100%,50%)`;ctx.beginPath();ctx.arc(Math.random()*w,Math.random()*h,Math.random()*80+20,0,Math.PI*2);ctx.fill();}ctx.globalAlpha=1;
            }
        }
        
        function detectEdges(d,w,h){
            const edges=new Float32Array(w*h);
            const sX=[-1,0,1,-2,0,2,-1,0,1],sY=[-1,-2,-1,0,0,0,1,2,1];
            for(let y=1;y<h-1;y++)for(let x=1;x<w-1;x++){let gx=0,gy=0;for(let ky=-1;ky<=1;ky++)for(let kx=-1;kx<=1;kx++){const idx=((y+ky)*w+(x+kx))*4;const gr=(d[idx]+d[idx+1]+d[idx+2])/3;const ki=(ky+1)*3+(kx+1);gx+=gr*sX[ki];gy+=gr*sY[ki];}edges[y*w+x]=Math.sqrt(gx*gx+gy*gy);}
            return edges;
        }
        
        function applyBlur(d,w,h,r){
            const temp=new Uint8ClampedArray(d.length);
            for(let y=0;y<h;y++)for(let x=0;x<w;x++){let rr=0,g=0,b=0,c=0;for(let dx=-r;dx<=r;dx++){const nx=x+dx;if(nx>=0&&nx<w){const idx=(y*w+nx)*4;rr+=d[idx];g+=d[idx+1];b+=d[idx+2];c++;}}const idx=(y*w+x)*4;temp[idx]=rr/c;temp[idx+1]=g/c;temp[idx+2]=b/c;temp[idx+3]=d[idx+3];}
            for(let y=0;y<h;y++)for(let x=0;x<w;x++){let rr=0,g=0,b=0,c=0;for(let dy=-r;dy<=r;dy++){const ny=y+dy;if(ny>=0&&ny<h){const idx=(ny*w+x)*4;rr+=temp[idx];g+=temp[idx+1];b+=temp[idx+2];c++;}}const idx=(y*w+x)*4;d[idx]=rr/c;d[idx+1]=g/c;d[idx+2]=b/c;}
        }
        
        function clamp(v){return Math.max(0,Math.min(255,Math.round(v)));}
        
        window.selectResult=function(style){
            selectedResult=style;
            document.querySelectorAll('.result-card').forEach(c=>c.classList.toggle('selected',c.id==='card-'+style));
            document.getElementById('downloadBtn').disabled=false;
        };
        
        window.flipPreview=()=>toast('Flip: coming soon');
        
        // ===== TEXT =====
        window.addText=()=>{
            const txt=document.getElementById('textInput').value||'Your Text';
            textBlocks.push({id:Date.now(),text:txt,x:50,y:30,font:document.getElementById('fontSelect').value,size:textSize,color:document.getElementById('textColor').value,bold:isBold,italic:isItalic});
            toast('Text added!');
        };
        window.toggleBold=()=>{isBold=!isBold;document.getElementById('boldBtn').classList.toggle('active',isBold);};
        window.toggleItalic=()=>{isItalic=!isItalic;document.getElementById('italicBtn').classList.toggle('active',isItalic);};
        window.changeTextSize=d=>{textSize=Math.max(10,Math.min(72,textSize+d));document.getElementById('textSizeDisplay').textContent=textSize;};
        window.updateText=()=>{};
        
        // ===== ACTIONS =====
        window.downloadSelected=function(){
            if(!selectedResult||!generatedCanvases[selectedResult]){toast('Select a style first','error');return;}
            const link=document.createElement('a');
            link.download=`chameleon-${currentFormat.id}-${selectedResult}-${Date.now()}.png`;
            link.href=generatedCanvases[selectedResult].toDataURL('image/png');
            link.click();toast('Downloaded!');
        };
        
        window.downloadAll=function(){
            Object.keys(generatedCanvases).forEach((s,i)=>{
                setTimeout(()=>{const link=document.createElement('a');link.download=`chameleon-${currentFormat.id}-${s}-${Date.now()}.png`;link.href=generatedCanvases[s].toDataURL('image/png');link.click();},i*400);
            });toast('Downloading all 6...');
        };
        
        window.printCard=()=>window.print();
        
        window.saveCard=function(){
            if(Object.keys(generatedCanvases).length===0){toast('Generate first','error');return;}
            const item={id:Date.now(),category:currentCategory,format:currentFormat.id,date:new Date().toLocaleDateString(),styles:{}};
            Object.keys(generatedCanvases).forEach(s=>item.styles[s]=generatedCanvases[s].toDataURL('image/png'));
            savedCards.push(item);
            try{localStorage.setItem('chameleon_ultimate',JSON.stringify(savedCards));}catch(e){}
            renderSaved();toast('üíæ Saved!','success');
        };
        
        function loadSaved(){
            try{const d=localStorage.getItem('chameleon_ultimate');if(d){savedCards=JSON.parse(d);renderSaved();}}catch(e){savedCards=[];}
        }
        
        function renderSaved(){
            const grid=document.getElementById('savedGrid');
            if(!savedCards.length){grid.innerHTML='<div class="empty-state"><div class="icon">ü¶é</div><h3>No Saved Cards</h3><p>Create and save your first card!</p></div>';return;}
            grid.innerHTML=savedCards.map(c=>{
                const img=c.styles[Object.keys(c.styles)[0]];
                return`<div class="gallery-item" onclick="loadSaved(${c.id})"><div class="gallery-item-img"><img src="${img}"></div><div class="gallery-item-info"><div class="gallery-item-title">${c.format}</div><div class="gallery-item-meta">${c.date}</div></div></div>`;
            }).join('');
        }
        
        window.loadSaved=function(id){
            const item=savedCards.find(c=>c.id===id);if(!item)return;
            Object.keys(item.styles).forEach(s=>{
                const img=new Image();
                img.onload=function(){const cvs=document.createElement('canvas');cvs.width=img.width;cvs.height=img.height;cvs.getContext('2d').drawImage(img,0,0);generatedCanvases[s]=cvs;const container=document.getElementById('img-'+s);container.innerHTML='';const display=cvs.cloneNode();display.getContext('2d').drawImage(cvs,0,0);display.style.width='100%';display.style.height='100%';container.appendChild(display);};
                img.src=item.styles[s];
            });
            showSection('create');toast('Loaded!');
        };
        
        function initTemplates(){
            const temps=[
                {cat:'business',name:'Corporate',style:'realistic'},
                {cat:'business',name:'Creative',style:'funky'},
                {cat:'greeting',name:'Birthday Fun',style:'comic'},
                {cat:'greeting',name:'Elegant Thanks',style:'watercolor'},
                {cat:'invite',name:'Wedding Classic',style:'postcard'},
                {cat:'invite',name:'Party Pop',style:'funky'}
            ];
            document.getElementById('templatesGrid').innerHTML=temps.map(t=>`
                <div class="gallery-item" data-cat="${t.cat}" onclick="useTemplate('${t.cat}','${t.style}')">
                    <div class="gallery-item-img" style="background:linear-gradient(135deg,var(--accent),var(--purple));display:flex;align-items:center;justify-content:center;"><span style="font-size:48px;opacity:0.5">ü¶é</span></div>
                    <div class="gallery-item-info"><div class="gallery-item-title">${t.name}</div><div class="gallery-item-meta">${t.style} style</div></div>
                </div>
            `).join('');
        }
        
        window.useTemplate=(cat,style)=>{selectCategory(cat);setStyle(style);showSection('create');toast('Template selected!');};
        
        function initFilters(){
            document.querySelectorAll('.filter-btn').forEach(btn=>{
                btn.onclick=function(){
                    document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
                    this.classList.add('active');
                    const f=this.dataset.filter;
                    document.querySelectorAll('#templatesGrid .gallery-item').forEach(item=>{
                        item.style.display=(f==='all'||item.dataset.cat===f)?'block':'none';
                    });
                };
            });
        }
        
        window.showSection=function(id){
            document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
            document.getElementById('section-'+id).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b=>b.classList.toggle('active',b.dataset.section===id));
        };
        
        window.toast=function(msg,type='success'){
            const t=document.getElementById('toast');t.textContent=msg;t.className='toast '+type;t.classList.add('show');
            setTimeout(()=>t.classList.remove('show'),3000);
        };
        
        window.addEventListener('resize',()=>{if(!hasDrawn)initCanvas();});
    })();
    </script>
</body>
</html>
