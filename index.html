<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chameleon Studios | Creative Chameleon Artflow‚Ñ¢ Card Creator</title>
    <meta name="description" content="Create stunning greeting cards, invitations & more. Draw your idea, AI transforms it into beautiful art.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü¶é</text></svg>">
    <style>
:root{--bg:#09090b;--surface:#18181b;--card:rgba(255,255,255,0.03);--border:rgba(255,255,255,0.08);--text:#fafafa;--dim:#a1a1aa;--muted:#52525b;--stellar:#FF6B35;--success:#22c55e;--error:#ef4444;--purple:#7C3AED;--teal:#0D9488}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;line-height:1.5}
@keyframes shimmer{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
@keyframes glow{0%,100%{box-shadow:0 0 20px rgba(255,107,53,0.3)}50%{box-shadow:0 0 40px rgba(255,107,53,0.6)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.6}}
.gradient-text{background:linear-gradient(-45deg,var(--teal),var(--purple),#DB2777,var(--stellar));background-size:400% 400%;animation:shimmer 8s ease infinite;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.stellar-gradient{background:linear-gradient(-45deg,var(--stellar),#D97706,#DB2777,var(--purple));background-size:400% 400%;animation:shimmer 8s ease infinite}
header{position:sticky;top:0;z-index:100;background:rgba(9,9,11,0.95);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);padding:10px 16px}
.header-inner{max-width:1600px;margin:0 auto;display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.logo{display:flex;align-items:center;gap:10px;cursor:pointer}
.logo-icon{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px}
.logo-text{font-size:20px;font-weight:800}
.logo-text span{color:var(--stellar)}
.tagline{font-size:10px;color:var(--dim)}
.nav-tabs{display:flex;gap:4px;margin-left:auto;background:var(--surface);padding:4px;border-radius:10px}
.nav-tab{padding:8px 14px;border:none;background:transparent;color:var(--dim);font-size:12px;font-weight:600;cursor:pointer;border-radius:8px;transition:all .2s}
.nav-tab:hover{color:var(--text)}
.nav-tab.active{background:var(--stellar);color:#fff}
main{display:flex;height:calc(100vh - 61px)}
.sidebar{width:260px;min-width:260px;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden}
.sidebar-header{padding:14px;border-bottom:1px solid var(--border);font-weight:700;font-size:13px}
.sidebar-content{flex:1;overflow-y:auto;padding:12px}
.workspace{flex:1;display:flex;flex-direction:column;overflow:hidden}
.workspace-toolbar{padding:10px 16px;background:var(--surface);border-bottom:1px solid var(--border);display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.workspace-canvas{flex:1;display:flex;align-items:center;justify-content:center;padding:20px;background:#0a0a0f;overflow:auto}
.right-panel{width:300px;min-width:300px;background:var(--surface);border-left:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden}
.section-title{font-size:11px;font-weight:700;color:var(--dim);text-transform:uppercase;margin-bottom:8px;padding:0 4px}
.style-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-bottom:16px}
.style-tile{aspect-ratio:1;border-radius:8px;border:2px solid var(--border);cursor:pointer;position:relative;transition:all 0.2s;overflow:hidden}
.style-tile:hover{border-color:var(--stellar);transform:scale(1.03)}
.style-tile.active{border-color:var(--stellar);box-shadow:0 0 12px rgba(255,107,53,0.4)}
.style-tile-icon{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:18px}
.style-tile-label{position:absolute;bottom:0;left:0;right:0;padding:2px;background:linear-gradient(transparent,rgba(0,0,0,0.85));font-size:8px;text-align:center;font-weight:600}
.element-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:4px;margin-bottom:16px}
.element-item{aspect-ratio:1;border-radius:6px;border:1px solid var(--border);background:var(--bg);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;transition:all 0.2s}
.element-item:hover{background:var(--card);border-color:var(--stellar);transform:scale(1.15)}
.card-container{position:relative;width:380px;aspect-ratio:5/7;border-radius:16px;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,0.5);background:#1a1a2e;flex-shrink:0}
#cardCanvas{position:absolute;inset:0;width:100%;height:100%}
.elements-layer{position:absolute;inset:0;pointer-events:none}
.elements-layer>*{pointer-events:auto}
.placed-element{position:absolute;cursor:move;user-select:none;filter:drop-shadow(2px 2px 4px rgba(0,0,0,0.5))}
.placed-element:hover{filter:drop-shadow(0 0 8px rgba(255,107,53,0.5))}
.placed-element.selected{outline:2px dashed var(--stellar);outline-offset:4px}
.text-block{position:absolute;cursor:move;padding:4px 8px;border:2px solid transparent;border-radius:4px;user-select:none;max-width:90%}
.text-block:hover{border-color:rgba(255,255,255,0.3)}
.text-block.selected{border-color:var(--stellar);background:rgba(255,107,53,0.1)}
.text-block.editing{cursor:text;border-color:var(--success)}
.tool-btn{padding:8px 12px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text);font-size:12px;cursor:pointer;display:flex;align-items:center;gap:4px;transition:all .2s}
.tool-btn:hover{background:var(--card);border-color:var(--stellar)}
.tool-btn.active{border-color:var(--stellar);background:rgba(255,107,53,0.15);color:var(--stellar)}
.tool-btn.processing{animation:glow 1.5s ease-in-out infinite}
.tool-btn.highlight{border-color:var(--purple);background:rgba(124,58,237,0.2);color:var(--purple);animation:pulse 2s ease-in-out infinite}
.panel-tabs{display:flex;border-bottom:1px solid var(--border)}
.panel-tab{flex:1;padding:10px;border:none;background:transparent;color:var(--dim);font-size:11px;font-weight:600;cursor:pointer;transition:all .2s}
.panel-tab.active{color:var(--stellar);border-bottom:2px solid var(--stellar);background:var(--card)}
.panel-content{flex:1;overflow-y:auto;padding:14px}
.form-group{margin-bottom:12px}
.form-label{display:block;font-size:10px;font-weight:600;color:var(--dim);margin-bottom:4px;text-transform:uppercase}
.form-input,.form-textarea,.form-select{width:100%;padding:10px;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:13px;font-family:inherit}
.form-input:focus,.form-textarea:focus,.form-select:focus{outline:none;border-color:var(--stellar)}
.form-textarea{min-height:60px;resize:vertical}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.btn{padding:10px 16px;border-radius:8px;border:none;font-size:13px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;gap:6px;transition:all .2s}
.btn:hover{transform:translateY(-1px)}
.btn-primary{background:linear-gradient(135deg,var(--stellar),#e55a2b);color:#fff}
.btn-secondary{background:var(--bg);border:1px solid var(--border);color:var(--text)}
.btn-success{background:var(--success);color:#fff}
.btn-purple{background:var(--purple);color:#fff}
.btn-full{width:100%}
.btn-sm{padding:6px 10px;font-size:11px}
.card-type-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:16px}
.card-type-btn{padding:6px 4px;border-radius:6px;border:1px solid var(--border);background:var(--bg);cursor:pointer;text-align:center;transition:all .2s}
.card-type-btn:hover{border-color:var(--stellar)}
.card-type-btn.active{border-color:var(--stellar);background:rgba(255,107,53,0.15)}
.card-type-btn .icon{font-size:14px;display:block;margin-bottom:2px}
.card-type-btn .label{font-size:8px;font-weight:600}
.template-chips{display:flex;flex-wrap:wrap;gap:4px;margin-top:6px}
.template-chip{padding:4px 8px;background:var(--bg);border:1px solid var(--border);border-radius:12px;font-size:10px;cursor:pointer;transition:all .2s}
.template-chip:hover{border-color:var(--stellar);background:var(--card)}
.text-controls{display:flex;gap:4px;flex-wrap:wrap;padding:8px;background:var(--bg);border-radius:8px;margin-bottom:10px}
.btn-icon{width:26px;height:26px;border:1px solid var(--border);background:var(--surface);color:var(--text);border-radius:4px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:11px;transition:all .2s}
.btn-icon:hover{background:var(--card)}
.btn-icon.active{background:var(--stellar);border-color:var(--stellar)}
input[type="color"]{width:26px;height:26px;border:1px solid var(--border);border-radius:4px;cursor:pointer;padding:2px}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.92);z-index:200;display:flex;align-items:center;justify-content:center;padding:20px;opacity:0;visibility:hidden;transition:all 0.3s}
.modal-overlay.open{opacity:1;visibility:visible}
.modal{background:var(--surface);border:1px solid var(--border);border-radius:16px;width:100%;max-width:1000px;max-height:90vh;display:flex;flex-direction:column;overflow:hidden}
.modal-header{padding:14px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px}
.modal-title{font-size:16px;font-weight:700}
.modal-close{margin-left:auto;background:none;border:none;color:var(--dim);font-size:24px;cursor:pointer}
.modal-body{flex:1;overflow-y:auto;padding:20px}
.gallery-filters{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:16px}
.filter-btn{padding:6px 12px;border-radius:15px;border:1px solid var(--border);background:var(--bg);color:var(--dim);font-size:11px;cursor:pointer;transition:all .2s}
.filter-btn:hover{border-color:var(--stellar);color:var(--text)}
.filter-btn.active{background:var(--stellar);border-color:var(--stellar);color:#fff}
.gallery-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:12px}
.gallery-item{aspect-ratio:5/7;border-radius:10px;overflow:hidden;cursor:pointer;position:relative;border:2px solid var(--border);transition:all 0.2s}
.gallery-item:hover{border-color:var(--stellar);transform:translateY(-4px)}
.gallery-item-bg{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.gallery-item-icon{font-size:32px;margin-bottom:6px}
.gallery-item-overlay{position:absolute;bottom:0;left:0;right:0;padding:8px;background:linear-gradient(transparent,rgba(0,0,0,0.9))}
.gallery-item-title{font-size:10px;font-weight:600}
.gallery-item-style{font-size:8px;color:var(--dim)}
.gallery-item-badge{position:absolute;top:6px;right:6px;padding:3px 6px;border-radius:8px;font-size:8px;font-weight:700;background:var(--stellar)}
.drawing-overlay{position:absolute;inset:0;z-index:10}
#drawCanvas{width:100%;height:100%;cursor:crosshair;touch-action:none}
.draw-tools{position:absolute;bottom:12px;left:50%;transform:translateX(-50%);display:flex;gap:4px;padding:8px 12px;background:rgba(0,0,0,0.95);border-radius:25px;z-index:20;border:1px solid var(--border)}
.draw-tool{width:32px;height:32px;border-radius:50%;border:2px solid var(--border);background:var(--surface);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;transition:all .2s}
.draw-tool:hover{border-color:var(--stellar)}
.draw-tool.active{border-color:var(--stellar);background:var(--stellar)}
.color-dot{width:20px;height:20px;border-radius:50%;cursor:pointer;border:2px solid transparent;transition:all .2s}
.color-dot:hover{transform:scale(1.2)}
.color-dot.active{border-color:#fff}
.ai-panel{background:linear-gradient(135deg,rgba(124,58,237,0.15),rgba(255,107,53,0.15));border:1px solid rgba(124,58,237,0.4);border-radius:12px;padding:14px;margin-bottom:14px}
.ai-panel-header{display:flex;align-items:center;gap:8px;margin-bottom:10px;font-weight:700;font-size:14px}
.ai-panel p{font-size:12px;color:var(--dim);line-height:1.5}
.ai-status{font-size:12px;color:var(--dim);margin-top:12px;padding:12px;background:var(--bg);border-radius:8px;line-height:1.6}
.ai-status strong{color:var(--text)}
.ai-status.success{border:1px solid var(--success);background:rgba(34,197,94,0.1)}
.ai-status.error{border:1px solid var(--error);background:rgba(239,68,68,0.1)}
.ai-styles-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:12px}
.ai-style-btn{padding:10px 8px;border-radius:8px;border:2px solid var(--border);background:var(--bg);cursor:pointer;text-align:center;transition:all .2s}
.ai-style-btn:hover{border-color:var(--purple);background:rgba(124,58,237,0.1)}
.ai-style-btn.active{border-color:var(--purple);background:rgba(124,58,237,0.2)}
.ai-style-btn .icon{font-size:20px;display:block;margin-bottom:4px}
.ai-style-btn .label{font-size:10px;font-weight:600}
.ai-style-btn .desc{font-size:8px;color:var(--dim);margin-top:2px}
.spinner{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin 1s linear infinite;display:inline-block}
.step-indicator{display:flex;align-items:center;gap:8px;padding:10px;background:rgba(124,58,237,0.1);border-radius:8px;margin-bottom:12px;font-size:12px}
.step-indicator .step-num{width:24px;height:24px;border-radius:50%;background:var(--purple);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:11px}
.step-indicator.complete .step-num{background:var(--success)}
.step-indicator.active{border:1px solid var(--purple)}
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--success);color:#fff;padding:12px 24px;border-radius:10px;font-size:13px;font-weight:500;z-index:1000;transition:transform 0.3s;box-shadow:0 8px 24px rgba(0,0,0,0.3)}
.toast.show{transform:translateX(-50%) translateY(0)}
.toast.error{background:var(--error)}
@media(max-width:1200px){.right-panel{display:none}}
@media(max-width:900px){.sidebar{width:200px;min-width:200px}.card-container{width:300px}}
@media(max-width:768px){main{flex-direction:column;height:auto}.sidebar{width:100%;min-width:100%;max-height:35vh}.workspace-canvas{min-height:55vh}.card-container{width:85%;max-width:320px}.nav-tabs{display:none}}
    </style>
</head>
<body>
    <header>
        <div class="header-inner">
            <div class="logo" onclick="location.reload()">
                <div class="logo-icon stellar-gradient">ü¶é</div>
                <div>
                    <div class="logo-text">Chameleon <span>Studios</span></div>
                    <div class="tagline">Creative Chameleon Artflow‚Ñ¢</div>
                </div>
            </div>
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="setMode('design')">üé® Design</button>
                <button class="nav-tab" onclick="setMode('artflow')">‚ú® AI Artflow</button>
                <button class="nav-tab" onclick="openGallery()">üñºÔ∏è Gallery</button>
                <button class="nav-tab" onclick="openHelp()">‚ùì Help</button>
            </div>
        </div>
    </header>
    <main>
        <div class="sidebar">
            <div class="sidebar-header">üé® Styles & Elements</div>
            <div class="sidebar-content">
                <div class="section-title">Art Style</div>
                <div class="style-grid" id="styleGrid"></div>
                <div class="section-title">Elements</div>
                <div class="element-grid" id="elementGrid"></div>
                <div class="section-title">Characters</div>
                <div class="element-grid" id="characterGrid"></div>
                <div class="section-title">Decorations</div>
                <div class="element-grid" id="frameGrid"></div>
            </div>
        </div>
        <div class="workspace">
            <div class="workspace-toolbar">
                <button class="tool-btn" onclick="openGallery()">üñºÔ∏è Templates</button>
                <button class="tool-btn highlight" onclick="toggleDrawMode()" id="drawModeBtn">‚úèÔ∏è Draw</button>
                <button class="tool-btn" onclick="addTextBlock()">T+ Text</button>
                <button class="tool-btn" onclick="generateScene()">‚ú® New Background</button>
                <button class="tool-btn" onclick="clearCard()">üóëÔ∏è Clear</button>
                <div style="margin-left:auto;display:flex;gap:6px">
                    <button class="btn btn-success btn-sm" onclick="downloadCard()">‚¨áÔ∏è Download</button>
                    <button class="btn btn-secondary btn-sm" onclick="emailCard()">üìß Email</button>
                </div>
            </div>
            <div class="workspace-canvas">
                <div class="card-container" id="cardContainer">
                    <canvas id="cardCanvas"></canvas>
                    <div class="elements-layer" id="elementsLayer"></div>
                    <div class="drawing-overlay" id="drawingOverlay" style="display:none">
                        <canvas id="drawCanvas"></canvas>
                    </div>
                </div>
                <div class="draw-tools" id="drawTools" style="display:none">
                    <button class="draw-tool active" data-tool="pen" onclick="setDrawTool('pen')">‚úèÔ∏è</button>
                    <button class="draw-tool" data-tool="brush" onclick="setDrawTool('brush')">üñåÔ∏è</button>
                    <button class="draw-tool" data-tool="eraser" onclick="setDrawTool('eraser')">üßΩ</button>
                    <div style="width:1px;background:var(--border);margin:0 6px"></div>
                    <div class="color-dot active" style="background:#fff" onclick="setDrawColor('#ffffff')"></div>
                    <div class="color-dot" style="background:#ff6b6b" onclick="setDrawColor('#ff6b6b')"></div>
                    <div class="color-dot" style="background:#feca57" onclick="setDrawColor('#feca57')"></div>
                    <div class="color-dot" style="background:#48dbfb" onclick="setDrawColor('#48dbfb')"></div>
                    <div class="color-dot" style="background:#1dd1a1" onclick="setDrawColor('#1dd1a1')"></div>
                    <div class="color-dot" style="background:#ff9ff3" onclick="setDrawColor('#ff9ff3')"></div>
                    <div class="color-dot" style="background:#000" onclick="setDrawColor('#000000')"></div>
                    <div style="width:1px;background:var(--border);margin:0 6px"></div>
                    <button class="draw-tool" onclick="clearDrawing()">üóëÔ∏è</button>
                    <button class="draw-tool" onclick="undoDrawing()">‚Ü©Ô∏è</button>
                    <button class="draw-tool" style="background:var(--success);border-color:var(--success)" onclick="finishDrawing()">‚úÖ</button>
                </div>
            </div>
        </div>
        <div class="right-panel">
            <div class="panel-tabs">
                <button class="panel-tab active" data-panel="card" onclick="showPanel('card')">üìã Card</button>
                <button class="panel-tab" data-panel="ai" onclick="showPanel('ai')">ü§ñ AI Art</button>
                <button class="panel-tab" data-panel="text" onclick="showPanel('text')">‚úçÔ∏è Text</button>
            </div>
            <div class="panel-content" id="panel-card">
                <div class="section-title">Card Type</div>
                <div class="card-type-grid" id="cardTypeGrid"></div>
                <div class="form-group">
                    <label class="form-label">Message</label>
                    <textarea class="form-textarea" id="cardMessage" placeholder="Your message..."></textarea>
                    <div class="template-chips" id="messageChips"></div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">To</label>
                        <input type="text" class="form-input" id="cardTo" placeholder="Recipient">
                    </div>
                    <div class="form-group">
                        <label class="form-label">From</label>
                        <input type="text" class="form-input" id="cardFrom" placeholder="Your name">
                    </div>
                </div>
                <div id="eventFields" style="display:none">
                    <div class="section-title">Event Details</div>
                    <div class="form-row">
                        <div class="form-group"><label class="form-label">Date</label><input type="date" class="form-input" id="eventDate"></div>
                        <div class="form-group"><label class="form-label">Time</label><input type="time" class="form-input" id="eventTime"></div>
                    </div>
                    <div class="form-group"><label class="form-label">Location</label><input type="text" class="form-input" id="eventLocation" placeholder="Address"></div>
                </div>
                <button class="btn btn-primary btn-full" onclick="applyCardSettings()" style="margin-top:12px">‚ú® Apply to Card</button>
            </div>
            <div class="panel-content" id="panel-ai" style="display:none">
                <div class="ai-panel">
                    <div class="ai-panel-header">ü§ñ AI Artflow‚Ñ¢</div>
                    <p>Transform your drawing into stunning art! Follow these steps:</p>
                </div>
                <div class="step-indicator" id="step1">
                    <span class="step-num">1</span>
                    <span>Click <strong>‚úèÔ∏è Draw</strong> and sketch something (house, tree, flower...)</span>
                </div>
                <div class="step-indicator" id="step2">
                    <span class="step-num">2</span>
                    <span>Click <strong>‚úÖ</strong> when done drawing</span>
                </div>
                <div class="step-indicator" id="step3">
                    <span class="step-num">3</span>
                    <span>Choose an art style below</span>
                </div>
                <div class="section-title" style="margin-top:16px">üé® Choose Art Style</div>
                <div class="ai-styles-grid" id="aiStylesGrid"></div>
                <button class="btn btn-purple btn-full" onclick="generateAIArt()" id="aiGenerateBtn" style="margin-top:14px">
                    ‚ú® Transform My Drawing
                </button>
                <button class="btn btn-secondary btn-full btn-sm" onclick="generateDemoArt()" style="margin-top:8px">
                    üé≤ Try Demo (No Drawing Needed)
                </button>
                <div id="aiStatus" class="ai-status" style="display:none"></div>
            </div>
            <div class="panel-content" id="panel-text" style="display:none">
                <div class="section-title">Text Controls</div>
                <div class="text-controls">
                    <select class="form-select" id="fontFamily" onchange="updateSelectedText()" style="flex:1;padding:5px;font-size:10px">
                        <option value="Arial, sans-serif">Arial</option>
                        <option value="Georgia, serif">Georgia</option>
                        <option value="Times New Roman, serif">Times</option>
                        <option value="Impact, sans-serif">Impact</option>
                        <option value="Brush Script MT, cursive">Brush</option>
                    </select>
                </div>
                <div class="text-controls">
                    <button class="btn-icon" onclick="changeTextSize(-2)">‚àí</button>
                    <span id="fontSize" style="font-size:10px;min-width:24px;text-align:center">24</span>
                    <button class="btn-icon" onclick="changeTextSize(2)">+</button>
                    <input type="color" id="textColor" value="#ffffff" onchange="updateSelectedText()">
                    <button class="btn-icon" id="boldBtn" onclick="toggleBold()"><b>B</b></button>
                    <button class="btn-icon" id="italicBtn" onclick="toggleItalic()"><i>I</i></button>
                    <button class="btn-icon" onclick="deleteSelected()">üóëÔ∏è</button>
                </div>
                <p style="font-size:9px;color:var(--muted);margin-bottom:10px">Click text ‚Üí Drag to move ‚Üí Double-click to edit</p>
                <div class="section-title">Quick Add</div>
                <button class="btn btn-secondary btn-sm btn-full" onclick="addPresetText('title')" style="margin-bottom:4px">+ Title</button>
                <button class="btn btn-secondary btn-sm btn-full" onclick="addPresetText('message')" style="margin-bottom:4px">+ Message</button>
                <button class="btn btn-secondary btn-sm btn-full" onclick="addPresetText('signature')">+ Signature</button>
            </div>
        </div>
    </main>
    <div class="modal-overlay" id="galleryModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">üñºÔ∏è Template Gallery</span>
                <button class="modal-close" onclick="closeGallery()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="gallery-filters" id="galleryFilters"></div>
                <div class="gallery-grid" id="galleryGrid"></div>
            </div>
        </div>
    </div>
    <div class="modal-overlay" id="helpModal">
        <div class="modal" style="max-width:600px">
            <div class="modal-header">
                <span class="modal-title">‚ùì How to Use</span>
                <button class="modal-close" onclick="closeHelp()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display:grid;gap:16px">
                    <div><h4 style="color:var(--stellar)">üé® 1. Choose Style</h4><p style="color:var(--dim);font-size:13px">15 styles: Steampunk, Victorian, Celestial, Kawaii, Gothic & more</p></div>
                    <div><h4 style="color:var(--stellar)">üìå 2. Select Card Type</h4><p style="color:var(--dim);font-size:13px">Thank You, Birthday, Wedding, Invite, Baby, Holiday, Graduation...</p></div>
                    <div><h4 style="color:var(--stellar)">‚úèÔ∏è 3. Draw Something</h4><p style="color:var(--dim);font-size:13px">Click Draw, sketch a house/tree/flower, then click ‚úÖ</p></div>
                    <div><h4 style="color:var(--purple)">ü§ñ 4. AI Artflow‚Ñ¢</h4><p style="color:var(--dim);font-size:13px">Go to AI Art tab ‚Üí Choose style ‚Üí Click Transform!</p></div>
                    <div><h4 style="color:var(--stellar)">üé≠ 5. Add Elements & Text</h4><p style="color:var(--dim);font-size:13px">Drag emojis, add text with fonts & colors</p></div>
                    <div><h4 style="color:var(--stellar)">üì• 6. Download</h4><p style="color:var(--dim);font-size:13px">Download PNG or email your creation!</p></div>
                </div>
            </div>
        </div>
    </div>
    <div class="toast" id="toast"></div>
<script>
(function(){
"use strict";
const CONFIG={email:"rayzenart@yahoo.com"};
const STYLES=[
{id:"steampunk",name:"Steampunk",icon:"‚öôÔ∏è",colors:["#8B4513","#D4A574","#C9A227"],bg:["#1a1510","#2c2218"]},
{id:"farmhouse",name:"Farmhouse",icon:"üè°",colors:["#8FBC8F","#DEB887","#CD853F"],bg:["#f5f0e8","#e8e0d5"]},
{id:"victorian",name:"Victorian",icon:"üëë",colors:["#800020","#DAA520","#DDA0DD"],bg:["#1a1520","#2c2028"]},
{id:"whimsical",name:"Whimsical",icon:"üßö",colors:["#FFB6C1","#DDA0DD","#98FB98"],bg:["#faf0f5","#f0e8f5"]},
{id:"botanical",name:"Botanical",icon:"üåø",colors:["#228B22","#90EE90","#6B8E23"],bg:["#f0f8f0","#e0f0e0"]},
{id:"celestial",name:"Celestial",icon:"üåô",colors:["#191970","#FFD700","#9370DB"],bg:["#0a0a20","#151530"]},
{id:"nautical",name:"Nautical",icon:"‚öì",colors:["#000080","#F5F5F5","#DC143C"],bg:["#e8f0f8","#d8e8f5"]},
{id:"woodland",name:"Woodland",icon:"ü¶ä",colors:["#8B4513","#228B22","#2F4F4F"],bg:["#1a1f15","#252a20"]},
{id:"artdeco",name:"Art Deco",icon:"üíé",colors:["#FFD700","#000000","#C0C0C0"],bg:["#0a0a0a","#1a1a1a"]},
{id:"boho",name:"Bohemian",icon:"ü™∂",colors:["#CD853F","#DEB887","#8FBC8F"],bg:["#f5ebe0","#e8ddd0"]},
{id:"kawaii",name:"Kawaii",icon:"üå∏",colors:["#FFB7C5","#FFDAB9","#E6E6FA"],bg:["#fff5f8","#fff0f5"]},
{id:"gothic",name:"Gothic",icon:"ü¶á",colors:["#1a1a2e","#4a0e0e","#800080"],bg:["#0a0a10","#15151f"]},
{id:"watercolor",name:"Watercolor",icon:"üé®",colors:["#87CEEB","#DDA0DD","#98FB98"],bg:["#fafafa","#f5f5f5"]},
{id:"storybook",name:"Storybook",icon:"üìö",colors:["#8B4513","#F5DEB3","#4169E1"],bg:["#f8f0e0","#f0e8d8"]},
{id:"modern",name:"Modern",icon:"üî∑",colors:["#2C3E50","#E74C3C","#3498DB"],bg:["#ffffff","#f8f9fa"]}
];
const ELEMENTS={
steampunk:["‚öôÔ∏è","üîß","‚è±Ô∏è","üé©","ü•Ω","üîë","‚öóÔ∏è","üß≠","üí°","üî©"],
farmhouse:["üåª","üêì","üåæ","üè°","üöú","üåΩ","üêÑ","ü•õ","üß∫","üçé"],
victorian:["üëë","üé≠","üïØÔ∏è","üìú","üéª","üíç","üåπ","‚òÇÔ∏è","üé©","üíé"],
whimsical:["üßö","ü¶ã","üåà","‚≠ê","üçÑ","üå∏","ü¶Ñ","üéÄ","üí´","üå∫"],
botanical:["üåø","üå∫","üåª","üå∑","üåπ","üçÉ","ü¶ã","üêù","üåº","üå±"],
celestial:["üåô","‚≠ê","‚ú®","üåü","‚òÄÔ∏è","ü™ê","üí´","üå†","‚òÑÔ∏è","üîÆ"],
nautical:["‚öì","üö¢","üêö","ü¶Ä","üê†","üåä","üß≠","‚õµ","üêã","üèùÔ∏è"],
woodland:["ü¶ä","ü¶å","ü¶â","üêøÔ∏è","üçÇ","üå≤","üçÑ","üê∞","ü¶î","üêª"],
artdeco:["üíé","üî∑","üî∂","‚¨õ","üìê","üèõÔ∏è","üé≠","ü•Ç","‚ú®","üî≤"],
boho:["ü™∂","üåô","‚òÄÔ∏è","üåµ","ü™¨","üßø","üé™","üåª","ü¶ã","üåà"],
kawaii:["üå∏","üíñ","‚≠ê","üç∞","üéÄ","üç≠","üåà","üíï","ü¶Ñ","üßÅ"],
gothic:["ü¶á","üï∑Ô∏è","üñ§","‚ö∞Ô∏è","üåπ","üïØÔ∏è","üíÄ","üóùÔ∏è","üåô","üèöÔ∏è"],
watercolor:["üé®","üñåÔ∏è","üíß","üå∏","ü¶ã","üå∫","üåø","üê¶","‚òÅÔ∏è","üåà"],
storybook:["üìö","üè∞","üêâ","üë∏","ü¶Å","üêª","üå≤","üçÑ","‚≠ê","ü¶ã"],
modern:["üî∑","‚¨õ","‚¨ú","üî∂","üìê","üíé","üî≤","‚≠ï","üí°","‚ú®"]
};
const CHARACTERS={
steampunk:["ü§ñ","üë®‚Äçüî¨","üé©","ü¶æ"],farmhouse:["üë®‚Äçüåæ","üë©‚Äçüåæ","üêï","üê¥"],victorian:["üë∏","ü§¥","üë∞","üé≠"],
whimsical:["üßö","üßú‚Äç‚ôÄÔ∏è","üëº","ü¶Ñ"],botanical:["ü¶ã","üêù","üê¶","ü¶¢"],celestial:["üëº","üßô","üåü","üëΩ"],
nautical:["üßú‚Äç‚ôÄÔ∏è","üë®‚Äç‚úàÔ∏è","üè¥‚Äç‚ò†Ô∏è","üê¨"],woodland:["üßù","ü¶ä","ü¶å","ü¶â"],artdeco:["üíÉ","üï∫","üé≠","üë∏"],
boho:["üßò","ü¶ã","üåª","ü™∂"],kawaii:["üëß","üê±","üê∞","üêº"],gothic:["üßõ","üëª","ü¶á","üíÄ"],
watercolor:["üßë‚Äçüé®","ü¶ã","üê¶","üå∏"],storybook:["üë∏","ü§¥","üêâ","üßô"],modern:["üßë‚Äçüíº","üë®‚Äçüíª","ü§ñ","üíº"]
};
const FRAMES=["üî≤","‚¨ú","üí†","‚ùáÔ∏è","‚ú¥Ô∏è","üí´","‚≠ê","‚ú®","‚ùÑÔ∏è","üíé","üéÄ","üå∏"];
const CARD_TYPES=[
{id:"thankyou",name:"Thank You",icon:"üôè",templates:["Thank you!","Grateful!","You're the best!"]},
{id:"birthday",name:"Birthday",icon:"üéÇ",templates:["Happy Birthday!","Make a wish!","Celebrate!"]},
{id:"invite",name:"Invitation",icon:"üì®",templates:["You're invited!","Join us!","Please come!"],hasEvent:true},
{id:"wedding",name:"Wedding",icon:"üíí",templates:["Save the Date","Together Forever","I Do"],hasEvent:true},
{id:"baby",name:"Baby",icon:"üë∂",templates:["Welcome baby!","Bundle of joy!","Hello little one!"]},
{id:"holiday",name:"Holiday",icon:"üéÑ",templates:["Happy Holidays!","Season's Greetings","Joy & Peace"]},
{id:"congrats",name:"Congrats",icon:"üéâ",templates:["Congratulations!","You did it!","So proud!"]},
{id:"love",name:"Love",icon:"üíï",templates:["I love you","Be mine","Forever yours"]},
{id:"getwell",name:"Get Well",icon:"üå∏",templates:["Feel better!","Healing vibes","Get well!"]},
{id:"grad",name:"Graduation",icon:"üéì",templates:["Congrats grad!","Dream big!","Future is yours!"]},
{id:"business",name:"Business",icon:"üíº",templates:["Thank you","Let's connect","Best regards"]},
{id:"announce",name:"Announce",icon:"üì¢",templates:["Big news!","Announcing...","Exciting update!"]}
];
const GALLERY=[
{id:"g1",style:"steampunk",type:"thankyou",title:"Clockwork Thanks",featured:true},
{id:"g2",style:"farmhouse",type:"thankyou",title:"Sunflower Thanks",featured:true},
{id:"g3",style:"victorian",type:"wedding",title:"Elegant Wedding",featured:true},
{id:"g4",style:"whimsical",type:"birthday",title:"Fairy Birthday",featured:true},
{id:"g5",style:"botanical",type:"thankyou",title:"Garden Thanks",featured:true},
{id:"g6",style:"celestial",type:"birthday",title:"Starry Birthday",featured:true},
{id:"g7",style:"woodland",type:"baby",title:"Forest Friends",featured:true},
{id:"g8",style:"artdeco",type:"wedding",title:"Gatsby Wedding",featured:true},
{id:"g9",style:"kawaii",type:"birthday",title:"Cute Birthday",featured:true},
{id:"g10",style:"watercolor",type:"wedding",title:"Painted Love",featured:true},
{id:"g11",style:"storybook",type:"baby",title:"Once Upon Baby",featured:true},
{id:"g12",style:"modern",type:"business",title:"Clean Professional"}
];
const AI_STYLES=[
{id:"digital",name:"Digital Painting",icon:"üåü",desc:"Rich painterly strokes"},
{id:"fantasy",name:"Fantasy",icon:"‚ú®",desc:"Magical glow & stars"},
{id:"impressionist",name:"Impressionist",icon:"üé®",desc:"Classic brush dabs"},
{id:"cyberpunk",name:"Cyberpunk",icon:"‚ö°",desc:"Neon glow lines"}
];

let currentStyle=STYLES[0],currentCardType=CARD_TYPES[0],currentAIStyle=AI_STYLES[0];
let placedElements=[],textBlocks=[],selectedItem=null,idCounter=0;
let drawMode=false,drawCanvas,drawCtx,cardCanvas,cardCtx;
let isDrawing=false,lastX=0,lastY=0,drawTool="pen",drawColor="#ffffff";
let drawPaths=[],currentDrawPath=[],hasDrawing=false,isAIProcessing=false;

function init(){
    renderStyles();renderCardTypes();renderElements();renderAIStyles();
    setupCanvas();generateScene();renderGallery("featured");
}

function renderStyles(){
    document.getElementById("styleGrid").innerHTML=STYLES.map(s=>
        `<div class="style-tile ${s.id===currentStyle.id?'active':''}" onclick="selectStyle('${s.id}')" style="background:linear-gradient(135deg,${s.bg[0]},${s.bg[1]})">
            <span class="style-tile-icon">${s.icon}</span><span class="style-tile-label">${s.name}</span>
        </div>`
    ).join('');
}

function renderCardTypes(){
    document.getElementById("cardTypeGrid").innerHTML=CARD_TYPES.map(t=>
        `<div class="card-type-btn ${t.id===currentCardType.id?'active':''}" onclick="selectCardType('${t.id}')">
            <span class="icon">${t.icon}</span><span class="label">${t.name}</span>
        </div>`
    ).join('');
    renderMessageChips();
}

function renderMessageChips(){
    document.getElementById("messageChips").innerHTML=currentCardType.templates.map(t=>
        `<span class="template-chip" onclick="insertTemplate('${t}')">${t}</span>`
    ).join('');
}

function renderElements(){
    const e=ELEMENTS[currentStyle.id]||ELEMENTS.modern;
    const c=CHARACTERS[currentStyle.id]||CHARACTERS.modern;
    document.getElementById("elementGrid").innerHTML=e.map(x=>`<div class="element-item" onclick="placeElement('${x}')">${x}</div>`).join('');
    document.getElementById("characterGrid").innerHTML=c.map(x=>`<div class="element-item" onclick="placeElement('${x}')">${x}</div>`).join('');
    document.getElementById("frameGrid").innerHTML=FRAMES.map(f=>`<div class="element-item" onclick="placeElement('${f}')">${f}</div>`).join('');
}

function renderAIStyles(){
    document.getElementById("aiStylesGrid").innerHTML=AI_STYLES.map(s=>
        `<div class="ai-style-btn ${s.id===currentAIStyle.id?'active':''}" onclick="selectAIStyle('${s.id}')">
            <span class="icon">${s.icon}</span><span class="label">${s.name}</span><span class="desc">${s.desc}</span>
        </div>`
    ).join('');
}

function setupCanvas(){
    cardCanvas=document.getElementById("cardCanvas");
    cardCanvas.width=800;cardCanvas.height=1120;
    cardCtx=cardCanvas.getContext("2d",{willReadFrequently:true});
    
    drawCanvas=document.getElementById("drawCanvas");
    drawCanvas.width=800;drawCanvas.height=1120;
    drawCtx=drawCanvas.getContext("2d");
    drawCtx.lineCap="round";drawCtx.lineJoin="round";
    
    drawCanvas.addEventListener("mousedown",startDraw);
    drawCanvas.addEventListener("mousemove",draw);
    drawCanvas.addEventListener("mouseup",endDraw);
    drawCanvas.addEventListener("mouseleave",endDraw);
    drawCanvas.addEventListener("touchstart",e=>{e.preventDefault();startDraw(e.touches[0]);},{passive:false});
    drawCanvas.addEventListener("touchmove",e=>{e.preventDefault();draw(e.touches[0]);},{passive:false});
    drawCanvas.addEventListener("touchend",endDraw);
}

function getDrawPos(e){
    const r=drawCanvas.getBoundingClientRect();
    return{x:(e.clientX-r.left)*(drawCanvas.width/r.width),y:(e.clientY-r.top)*(drawCanvas.height/r.height)};
}

function startDraw(e){
    if(!drawMode)return;
    isDrawing=true;hasDrawing=true;
    const p=getDrawPos(e);lastX=p.x;lastY=p.y;
    currentDrawPath=[{x:p.x,y:p.y,color:drawTool==='eraser'?null:drawColor,size:drawTool==='brush'?16:5,tool:drawTool}];
    drawCtx.beginPath();drawCtx.moveTo(p.x,p.y);
    updateStepIndicators();
}

function draw(e){
    if(!isDrawing||!drawMode)return;
    const p=getDrawPos(e);
    if(drawTool==='eraser'){
        drawCtx.globalCompositeOperation='destination-out';drawCtx.lineWidth=30;
    }else{
        drawCtx.globalCompositeOperation='source-over';
        drawCtx.strokeStyle=drawColor;drawCtx.lineWidth=drawTool==='brush'?16:5;
    }
    drawCtx.lineTo(p.x,p.y);drawCtx.stroke();
    drawCtx.beginPath();drawCtx.moveTo(p.x,p.y);
    currentDrawPath.push({x:p.x,y:p.y});lastX=p.x;lastY=p.y;
}

function endDraw(){
    if(isDrawing&&currentDrawPath.length>0)drawPaths.push([...currentDrawPath]);
    isDrawing=false;currentDrawPath=[];drawCtx.globalCompositeOperation='source-over';
}

window.setDrawTool=function(t){
    drawTool=t;
    document.querySelectorAll('.draw-tool[data-tool]').forEach(b=>b.classList.toggle('active',b.dataset.tool===t));
};

window.setDrawColor=function(c){
    drawColor=c;
    document.querySelectorAll('.color-dot').forEach(d=>d.classList.toggle('active',d.style.background===c));
};

window.clearDrawing=function(){drawCtx.clearRect(0,0,drawCanvas.width,drawCanvas.height);drawPaths=[];hasDrawing=false;updateStepIndicators();};

window.undoDrawing=function(){
    if(drawPaths.length===0)return;
    drawPaths.pop();drawCtx.clearRect(0,0,drawCanvas.width,drawCanvas.height);
    drawPaths.forEach(path=>{
        if(path.length<2)return;
        drawCtx.beginPath();drawCtx.strokeStyle=path[0].color||'#ffffff';
        drawCtx.lineWidth=path[0].size||5;drawCtx.moveTo(path[0].x,path[0].y);
        path.forEach(p=>drawCtx.lineTo(p.x,p.y));drawCtx.stroke();
    });
    hasDrawing=drawPaths.length>0;updateStepIndicators();
};

window.toggleDrawMode=function(){
    drawMode=!drawMode;
    document.getElementById("drawModeBtn").classList.toggle("active",drawMode);
    document.getElementById("drawModeBtn").classList.toggle("highlight",!drawMode);
    document.getElementById("drawingOverlay").style.display=drawMode?"block":"none";
    document.getElementById("drawTools").style.display=drawMode?"flex":"none";
    if(drawMode){toast("‚úèÔ∏è Draw mode ON! Sketch something then click ‚úÖ");updateStepIndicators();}
};

window.finishDrawing=function(){
    if(!hasDrawing){toast("Draw something first!","error");return;}
    drawMode=false;
    document.getElementById("drawModeBtn").classList.remove("active");
    document.getElementById("drawModeBtn").classList.add("highlight");
    document.getElementById("drawingOverlay").style.display="none";
    document.getElementById("drawTools").style.display="none";
    cardCtx.drawImage(drawCanvas,0,0);
    drawCtx.clearRect(0,0,drawCanvas.width,drawCanvas.height);
    drawPaths=[];
    updateStepIndicators();
    toast("‚úÖ Drawing saved! Now go to AI Art tab to transform it!");
    showPanel('ai');
};

function updateStepIndicators(){
    const s1=document.getElementById("step1"),s2=document.getElementById("step2"),s3=document.getElementById("step3");
    s1.classList.toggle("complete",hasDrawing||drawMode);
    s1.classList.toggle("active",drawMode&&!hasDrawing);
    s2.classList.toggle("complete",hasDrawing&&!drawMode);
    s2.classList.toggle("active",hasDrawing&&drawMode);
    s3.classList.toggle("active",hasDrawing&&!drawMode);
}

window.generateScene=function(){
    const g=cardCtx.createLinearGradient(0,0,0,cardCanvas.height);
    g.addColorStop(0,currentStyle.bg[0]);g.addColorStop(1,currentStyle.bg[1]);
    cardCtx.fillStyle=g;cardCtx.fillRect(0,0,cardCanvas.width,cardCanvas.height);
    const colors=currentStyle.colors;cardCtx.globalAlpha=0.15;
    for(let i=0;i<25;i++){
        const x=Math.random()*cardCanvas.width,y=Math.random()*cardCanvas.height,s=20+Math.random()*80;
        cardCtx.fillStyle=colors[Math.floor(Math.random()*colors.length)];
        cardCtx.beginPath();cardCtx.arc(x,y,s,0,Math.PI*2);cardCtx.fill();
    }
    cardCtx.globalAlpha=0.25;cardCtx.strokeStyle=colors[0];cardCtx.lineWidth=6;
    cardCtx.strokeRect(25,25,cardCanvas.width-50,cardCanvas.height-50);
    cardCtx.globalAlpha=1;hasDrawing=false;updateStepIndicators();
    toast("üé® New background generated!");
};

window.selectStyle=function(id){currentStyle=STYLES.find(s=>s.id===id);renderStyles();renderElements();generateScene();};
window.selectCardType=function(id){currentCardType=CARD_TYPES.find(t=>t.id===id);renderCardTypes();document.getElementById("eventFields").style.display=currentCardType.hasEvent?"block":"none";};
window.selectAIStyle=function(id){currentAIStyle=AI_STYLES.find(s=>s.id===id);renderAIStyles();};
window.insertTemplate=function(t){document.getElementById("cardMessage").value=t;};

window.placeElement=function(emoji){
    const id="elem-"+(++idCounter);
    placedElements.push({id,emoji,x:35+Math.random()*30,y:35+Math.random()*30,size:40});
    renderPlacedElements();
};

function renderPlacedElements(){
    const l=document.getElementById("elementsLayer");
    l.innerHTML=placedElements.map(e=>
        `<div class="placed-element ${selectedItem?.id===e.id?'selected':''}" id="${e.id}" style="left:${e.x}%;top:${e.y}%;font-size:${e.size}px" onmousedown="startDragElement(event,'${e.id}')" onclick="selectItem('${e.id}')">${e.emoji}</div>`
    ).join('');
    l.innerHTML+=textBlocks.map(t=>
        `<div class="text-block ${selectedItem?.id===t.id?'selected':''} ${t.editing?'editing':''}" id="${t.id}" style="left:${t.x}%;top:${t.y}%;font-size:${t.fontSize}px;color:${t.color};font-family:${t.fontFamily};${t.bold?'font-weight:bold;':''}${t.italic?'font-style:italic;':''}text-shadow:2px 2px 4px rgba(0,0,0,0.8);" onmousedown="startDragText(event,'${t.id}')" onclick="selectItem('${t.id}')" ondblclick="editText('${t.id}')" ${t.editing?'contenteditable="true"':''}>${t.text}</div>`
    ).join('');
}

let dragItem=null,dragOffset={x:0,y:0};
window.startDragElement=function(e,id){e.preventDefault();dragItem=placedElements.find(el=>el.id===id);const r=document.getElementById("cardContainer").getBoundingClientRect();dragOffset.x=e.clientX-(dragItem.x/100*r.width);dragOffset.y=e.clientY-(dragItem.y/100*r.height);document.addEventListener("mousemove",dragElement);document.addEventListener("mouseup",stopDrag);};
window.startDragText=function(e,id){const b=textBlocks.find(t=>t.id===id);if(b?.editing)return;e.preventDefault();dragItem=b;const r=document.getElementById("cardContainer").getBoundingClientRect();dragOffset.x=e.clientX-(dragItem.x/100*r.width);dragOffset.y=e.clientY-(dragItem.y/100*r.height);document.addEventListener("mousemove",dragElement);document.addEventListener("mouseup",stopDrag);};
function dragElement(e){if(!dragItem)return;const r=document.getElementById("cardContainer").getBoundingClientRect();dragItem.x=Math.max(0,Math.min(90,((e.clientX-dragOffset.x)/r.width)*100));dragItem.y=Math.max(0,Math.min(90,((e.clientY-dragOffset.y)/r.height)*100));renderPlacedElements();}
function stopDrag(){dragItem=null;document.removeEventListener("mousemove",dragElement);document.removeEventListener("mouseup",stopDrag);}

window.selectItem=function(id){
    if(id){selectedItem=placedElements.find(e=>e.id===id)||textBlocks.find(t=>t.id===id);
        if(selectedItem?.fontSize){document.getElementById("fontSize").textContent=selectedItem.fontSize;document.getElementById("textColor").value=selectedItem.color||"#ffffff";}
    }else{selectedItem=null;}
    renderPlacedElements();
};
window.deleteSelected=function(){if(!selectedItem)return;placedElements=placedElements.filter(e=>e.id!==selectedItem.id);textBlocks=textBlocks.filter(t=>t.id!==selectedItem.id);selectedItem=null;renderPlacedElements();toast("Deleted");};

window.addTextBlock=function(){
    const id="text-"+(++idCounter);
    textBlocks.push({id,text:"Double-click to edit",x:25+Math.random()*50,y:40+Math.random()*20,fontSize:24,fontFamily:"Arial, sans-serif",color:"#ffffff",bold:false,italic:false,editing:false});
    renderPlacedElements();showPanel('text');
};
window.addPresetText=function(type){
    const id="text-"+(++idCounter);
    const p={title:{text:currentCardType.name,fontSize:32,y:12,bold:true},message:{text:currentCardType.templates[0],fontSize:24,y:45},signature:{text:"With love",fontSize:18,y:80,italic:true}}[type];
    textBlocks.push({id,text:p.text,x:50-(p.text.length*1),y:p.y,fontSize:p.fontSize,fontFamily:"Georgia, serif",color:"#ffffff",bold:p.bold||false,italic:p.italic||false,editing:false});
    renderPlacedElements();
};
window.editText=function(id){textBlocks.forEach(t=>t.editing=(t.id===id));renderPlacedElements();setTimeout(()=>{const el=document.getElementById(id);if(el){el.focus();const r=document.createRange();r.selectNodeContents(el);const s=window.getSelection();s.removeAllRanges();s.addRange(r);}},50);};
document.addEventListener("click",function(e){if(!e.target.classList.contains("text-block")){textBlocks.forEach(t=>{if(t.editing){const el=document.getElementById(t.id);if(el)t.text=el.textContent;t.editing=false;}});renderPlacedElements();}});
window.updateSelectedText=function(){if(!selectedItem?.fontSize)return;selectedItem.fontFamily=document.getElementById("fontFamily").value;selectedItem.color=document.getElementById("textColor").value;renderPlacedElements();};
window.changeTextSize=function(d){if(!selectedItem?.fontSize)return;selectedItem.fontSize=Math.max(10,Math.min(72,selectedItem.fontSize+d));document.getElementById("fontSize").textContent=selectedItem.fontSize;renderPlacedElements();};
window.toggleBold=function(){if(!selectedItem?.fontSize)return;selectedItem.bold=!selectedItem.bold;document.getElementById("boldBtn").classList.toggle("active",selectedItem.bold);renderPlacedElements();};
window.toggleItalic=function(){if(!selectedItem?.fontSize)return;selectedItem.italic=!selectedItem.italic;document.getElementById("italicBtn").classList.toggle("active",selectedItem.italic);renderPlacedElements();};

window.applyCardSettings=function(){
    const m=document.getElementById("cardMessage").value,to=document.getElementById("cardTo").value,from=document.getElementById("cardFrom").value;
    textBlocks=textBlocks.filter(t=>!t.auto);
    if(to)textBlocks.push({id:"text-"+(++idCounter),text:"To: "+to,x:8,y:6,fontSize:18,fontFamily:"Georgia, serif",color:"#ffffff",auto:true});
    if(m)textBlocks.push({id:"text-"+(++idCounter),text:m,x:12,y:42,fontSize:26,fontFamily:"Georgia, serif",color:"#ffffff",auto:true});
    if(from)textBlocks.push({id:"text-"+(++idCounter),text:"From: "+from,x:55,y:88,fontSize:16,fontFamily:"Georgia, serif",color:"#ffffff",italic:true,auto:true});
    if(currentCardType.hasEvent){
        const d=document.getElementById("eventDate").value,t=document.getElementById("eventTime").value,loc=document.getElementById("eventLocation").value;
        if(d||t||loc){let txt="";if(d)txt+=new Date(d).toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric'});if(t)txt+=(txt?" at ":"")+t;if(loc)txt+=(txt?"\n":"")+loc;
        textBlocks.push({id:"text-"+(++idCounter),text:txt,x:12,y:62,fontSize:18,fontFamily:"Arial, sans-serif",color:"#ffffff",auto:true});}
    }
    renderPlacedElements();toast("Card updated!");
};

// ===== AI ART GENERATION (FULLY OFFLINE - NO API NEEDED) =====
window.generateAIArt=function(){
    const imgData=cardCtx.getImageData(0,0,cardCanvas.width,cardCanvas.height);
    const edges=detectEdges(imgData.data,cardCanvas.width,cardCanvas.height);
    
    if(edges.length<20){
        toast("Draw something first! Use the ‚úèÔ∏è Draw button.","error");
        return;
    }
    
    if(isAIProcessing)return;
    isAIProcessing=true;
    
    const btn=document.getElementById("aiGenerateBtn");
    btn.innerHTML='<span class="spinner"></span> Generating...';
    
    const st=document.getElementById("aiStatus");
    st.style.display="block";st.className="ai-status";
    st.innerHTML="‚ú® <strong>Transforming your drawing into "+currentAIStyle.name+"...</strong>";
    
    setTimeout(()=>{
        try{
            switch(currentAIStyle.id){
                case'digital':genDigitalPainting(edges);break;
                case'fantasy':genFantasyRender(edges);break;
                case'impressionist':genImpressionist(edges);break;
                case'cyberpunk':genCyberpunk(edges);break;
            }
            st.className="ai-status success";
            st.innerHTML="‚úÖ <strong>"+currentAIStyle.name+"</strong> art generated!<br>Found "+edges.length+" drawing points to transform.";
            toast("üé® AI art generated!");
        }catch(e){
            console.error(e);st.className="ai-status error";st.innerHTML="‚ùå Generation failed";
            toast("Failed","error");
        }
        isAIProcessing=false;
        btn.innerHTML="‚ú® Transform My Drawing";
    },500);
};

window.generateDemoArt=function(){
    // Create demo drawing first
    generateScene();
    const w=cardCanvas.width,h=cardCanvas.height;
    cardCtx.strokeStyle="#ffffff";cardCtx.lineWidth=4;cardCtx.lineCap="round";
    
    // Draw a simple house
    cardCtx.beginPath();
    cardCtx.moveTo(w*0.3,h*0.5);cardCtx.lineTo(w*0.5,h*0.3);cardCtx.lineTo(w*0.7,h*0.5);cardCtx.closePath();cardCtx.stroke();
    cardCtx.strokeRect(w*0.35,h*0.5,w*0.3,h*0.25);
    cardCtx.strokeRect(w*0.45,h*0.55,w*0.1,h*0.15);
    
    // Draw a tree
    cardCtx.beginPath();cardCtx.moveTo(w*0.15,h*0.75);cardCtx.lineTo(w*0.15,h*0.55);cardCtx.stroke();
    cardCtx.beginPath();cardCtx.arc(w*0.15,h*0.5,w*0.08,0,Math.PI*2);cardCtx.stroke();
    
    // Draw sun
    cardCtx.beginPath();cardCtx.arc(w*0.8,h*0.2,w*0.06,0,Math.PI*2);cardCtx.stroke();
    
    hasDrawing=true;
    toast("Demo sketch created! Now click Transform!");
    updateStepIndicators();
};

function detectEdges(data,w,h){
    const edges=[];
    for(let y=3;y<h-3;y+=4){
        for(let x=3;x<w-3;x+=4){
            const i=(y*w+x)*4;
            const brightness=(data[i]+data[i+1]+data[i+2])/3;
            const ir=(y*w+x+3)*4,id=((y+3)*w+x)*4;
            const bR=(data[ir]+data[ir+1]+data[ir+2])/3;
            const bD=(data[id]+data[id+1]+data[id+2])/3;
            if(Math.abs(brightness-bR)>35||Math.abs(brightness-bD)>35){
                edges.push({x,y,r:data[i],g:data[i+1],b:data[i+2],brightness});
            }
        }
    }
    return edges;
}

function rnd(a,b){return Math.floor(Math.random()*(b-a+1))+a;}
function clamp(v,a,b){return Math.max(a,Math.min(b,v));}

function genDigitalPainting(edges){
    const w=cardCanvas.width,h=cardCanvas.height;
    const colors=currentStyle.colors;
    const bg=currentStyle.bg;
    
    // Rich gradient background
    const grad=cardCtx.createRadialGradient(w/2,h/3,0,w/2,h/2,w);
    grad.addColorStop(0,lighten(bg[0],40));grad.addColorStop(0.5,bg[0]);grad.addColorStop(1,darken(bg[1],30));
    cardCtx.fillStyle=grad;cardCtx.fillRect(0,0,w,h);
    
    // Atmospheric glow
    cardCtx.globalAlpha=0.3;cardCtx.fillStyle=colors[0];
    cardCtx.beginPath();cardCtx.arc(w*0.35,h*0.25,w*0.4,0,Math.PI*2);cardCtx.fill();
    cardCtx.globalAlpha=1;
    
    // Painterly strokes following edges
    cardCtx.lineCap='round';
    for(let i=0;i<Math.min(edges.length*3,500);i++){
        const e=edges[rnd(0,edges.length-1)];
        const col=i%4===0?colors[0]:i%4===1?colors[1]:i%4===2?colors[2]:`rgb(${e.r},${e.g},${e.b})`;
        cardCtx.strokeStyle=col;cardCtx.globalAlpha=0.5+Math.random()*0.3;
        cardCtx.lineWidth=rnd(6,20);
        cardCtx.beginPath();
        cardCtx.moveTo(e.x+rnd(-25,25),e.y+rnd(-25,25));
        cardCtx.quadraticCurveTo(e.x+rnd(-50,50),e.y+rnd(-50,50),e.x+rnd(-60,60),e.y+rnd(-60,60));
        cardCtx.stroke();
    }
    
    // Highlights
    cardCtx.globalAlpha=0.25;
    for(let i=0;i<40;i++){cardCtx.fillStyle='#fff';cardCtx.beginPath();cardCtx.arc(rnd(0,w),rnd(0,h*0.5),rnd(5,25),0,Math.PI*2);cardCtx.fill();}
    cardCtx.globalAlpha=1;
    addVignette(0.3);
}

function genFantasyRender(edges){
    const w=cardCanvas.width,h=cardCanvas.height;
    
    // Dark mystical background
    const grad=cardCtx.createLinearGradient(0,0,0,h);
    grad.addColorStop(0,'#1a0a2e');grad.addColorStop(0.5,'#0f0a1e');grad.addColorStop(1,'#050510');
    cardCtx.fillStyle=grad;cardCtx.fillRect(0,0,w,h);
    
    // Starfield
    for(let i=0;i<150;i++){cardCtx.fillStyle=`rgba(255,255,255,${Math.random()*0.8})`;cardCtx.beginPath();cardCtx.arc(rnd(0,w),rnd(0,h),Math.random()*2.5,0,Math.PI*2);cardCtx.fill();}
    
    const glowC='#00ffff',magicC='#ff00ff';
    cardCtx.shadowBlur=35;
    
    // Ethereal glow particles on edges
    cardCtx.globalAlpha=0.5;
    for(let i=0;i<Math.min(edges.length,200);i++){
        const e=edges[rnd(0,edges.length-1)];
        const c=i%2===0?glowC:magicC;
        cardCtx.shadowColor=c;cardCtx.fillStyle=c;
        cardCtx.beginPath();cardCtx.arc(e.x+rnd(-15,15),e.y+rnd(-15,15),rnd(6,20),0,Math.PI*2);cardCtx.fill();
    }
    
    // Magic swirls
    for(let s=0;s<5;s++){
        const cx=rnd(w*0.15,w*0.85),cy=rnd(h*0.15,h*0.85);
        cardCtx.strokeStyle=s%2===0?glowC:magicC;cardCtx.lineWidth=2;cardCtx.globalAlpha=0.6;
        cardCtx.beginPath();
        for(let a=0;a<Math.PI*5;a+=0.12){const r=a*10;const x=cx+Math.cos(a)*r,y=cy+Math.sin(a)*r;if(a===0)cardCtx.moveTo(x,y);else cardCtx.lineTo(x,y);}
        cardCtx.stroke();
    }
    cardCtx.shadowBlur=0;cardCtx.globalAlpha=1;
}

function genImpressionist(edges){
    const w=cardCanvas.width,h=cardCanvas.height;
    
    // Soft sky gradient
    const grad=cardCtx.createLinearGradient(0,0,0,h);
    grad.addColorStop(0,'#87ceeb');grad.addColorStop(0.35,'#b8d4e8');grad.addColorStop(0.65,'#f5e6d3');grad.addColorStop(1,'#d4a574');
    cardCtx.fillStyle=grad;cardCtx.fillRect(0,0,w,h);
    
    // Impressionist dabs
    for(let i=0;i<Math.min(edges.length*4,700);i++){
        const e=edges[rnd(0,edges.length-1)];
        cardCtx.fillStyle=`rgb(${clamp(e.r+rnd(-50,50),0,255)},${clamp(e.g+rnd(-50,50),0,255)},${clamp(e.b+rnd(-50,50),0,255)})`;
        cardCtx.globalAlpha=0.65;
        cardCtx.save();
        cardCtx.translate(e.x+rnd(-20,20),e.y+rnd(-20,20));
        cardCtx.rotate(Math.random()*Math.PI);
        cardCtx.beginPath();cardCtx.ellipse(0,0,rnd(8,22),rnd(3,10),0,0,Math.PI*2);cardCtx.fill();
        cardCtx.restore();
    }
    
    // Sunlight dapples
    cardCtx.globalAlpha=0.2;
    for(let i=0;i<35;i++){cardCtx.fillStyle='#fffacd';cardCtx.beginPath();cardCtx.arc(rnd(0,w),rnd(0,h*0.55),rnd(15,50),0,Math.PI*2);cardCtx.fill();}
    cardCtx.globalAlpha=1;
}

function genCyberpunk(edges){
    const w=cardCanvas.width,h=cardCanvas.height;
    
    cardCtx.fillStyle='#0a0a0f';cardCtx.fillRect(0,0,w,h);
    
    // Grid
    cardCtx.strokeStyle='rgba(0,255,255,0.08)';cardCtx.lineWidth=1;
    for(let x=0;x<w;x+=45){cardCtx.beginPath();cardCtx.moveTo(x,0);cardCtx.lineTo(x,h);cardCtx.stroke();}
    for(let y=0;y<h;y+=45){cardCtx.beginPath();cardCtx.moveTo(0,y);cardCtx.lineTo(w,y);cardCtx.stroke();}
    
    const nc=['#00ffff','#ff00ff','#ffff00','#00ff00','#ff0066'];
    
    // Neon outlines
    cardCtx.shadowBlur=25;cardCtx.lineCap='round';
    for(let pass=0;pass<3;pass++){
        const c=nc[pass%nc.length];
        cardCtx.shadowColor=c;cardCtx.strokeStyle=c;cardCtx.lineWidth=6-pass*2;cardCtx.globalAlpha=0.8-pass*0.2;
        cardCtx.beginPath();
        edges.forEach((e,i)=>{if(i===0)cardCtx.moveTo(e.x,e.y);else if(i%2===0)cardCtx.lineTo(e.x,e.y);});
        cardCtx.stroke();
    }
    
    // Glitch lines
    cardCtx.shadowBlur=0;cardCtx.globalAlpha=0.5;
    for(let i=0;i<25;i++){cardCtx.fillStyle=nc[rnd(0,nc.length-1)];cardCtx.fillRect(rnd(0,w-180),rnd(0,h),rnd(40,180),rnd(2,8));}
    
    // Neon particles
    cardCtx.shadowBlur=15;
    for(let i=0;i<Math.min(edges.length,120);i++){
        const e=edges[rnd(0,edges.length-1)];const c=nc[rnd(0,nc.length-1)];
        cardCtx.shadowColor=c;cardCtx.fillStyle=c;cardCtx.globalAlpha=0.8;
        cardCtx.beginPath();cardCtx.arc(e.x+rnd(-12,12),e.y+rnd(-12,12),rnd(2,8),0,Math.PI*2);cardCtx.fill();
    }
    
    // Scanlines
    cardCtx.shadowBlur=0;cardCtx.globalAlpha=0.04;cardCtx.fillStyle='#000';
    for(let y=0;y<h;y+=4)cardCtx.fillRect(0,y,w,2);
    cardCtx.globalAlpha=1;
    addVignette(0.45);
}

function lighten(hex,amt){try{const n=parseInt(hex.replace('#',''),16);return`rgb(${clamp(((n>>16)&255)+amt,0,255)},${clamp(((n>>8)&255)+amt,0,255)},${clamp((n&255)+amt,0,255)})`;}catch{return hex;}}
function darken(hex,amt){return lighten(hex,-amt);}
function addVignette(intensity){const w=cardCanvas.width,h=cardCanvas.height;const v=cardCtx.createRadialGradient(w/2,h/2,w*0.25,w/2,h/2,w*0.85);v.addColorStop(0,'rgba(0,0,0,0)');v.addColorStop(1,`rgba(0,0,0,${intensity})`);cardCtx.fillStyle=v;cardCtx.fillRect(0,0,w,h);}

// ===== UI =====
window.showPanel=function(p){document.querySelectorAll('.panel-tab').forEach(t=>t.classList.remove('active'));document.querySelector(`.panel-tab[data-panel="${p}"]`)?.classList.add('active');document.querySelectorAll('.panel-content').forEach(c=>c.style.display='none');document.getElementById('panel-'+p).style.display='block';};
window.setMode=function(m){document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));document.querySelectorAll('.nav-tab')[m==='artflow'?1:0].classList.add('active');if(m==='artflow'){showPanel('ai');toast("ü§ñ AI Artflow - Draw something then transform!");}};

function renderGallery(f){
    let fh=`<button class="filter-btn ${f==='all'?'active':''}" onclick="filterGallery('all')">All</button><button class="filter-btn ${f==='featured'?'active':''}" onclick="filterGallery('featured')">‚≠ê Featured</button>`;
    STYLES.forEach(s=>{fh+=`<button class="filter-btn ${f===s.id?'active':''}" onclick="filterGallery('${s.id}')">${s.icon}</button>`;});
    document.getElementById("galleryFilters").innerHTML=fh;
    let items=f==='featured'?GALLERY.filter(g=>g.featured):f==='all'?GALLERY:GALLERY.filter(g=>g.style===f);
    document.getElementById("galleryGrid").innerHTML=items.map(g=>{
        const s=STYLES.find(x=>x.id===g.style),ct=CARD_TYPES.find(x=>x.id===g.type);
        return`<div class="gallery-item" onclick="useGalleryTemplate('${g.id}')" style="background:linear-gradient(135deg,${s.bg[0]},${s.bg[1]})"><div class="gallery-item-bg"><div class="gallery-item-icon">${s.icon}</div></div>${g.featured?'<div class="gallery-item-badge">‚≠ê</div>':''}<div class="gallery-item-overlay"><div class="gallery-item-title">${g.title}</div><div class="gallery-item-style">${s.name} ‚Ä¢ ${ct?.name||''}</div></div></div>`;
    }).join('');
}
window.filterGallery=function(f){renderGallery(f);};
window.useGalleryTemplate=function(id){const t=GALLERY.find(g=>g.id===id);if(!t)return;selectStyle(t.style);if(t.type)selectCardType(t.type);closeGallery();toast("Template: "+t.title);};
window.openGallery=function(){document.getElementById("galleryModal").classList.add("open");renderGallery("featured");};
window.closeGallery=function(){document.getElementById("galleryModal").classList.remove("open");};
window.openHelp=function(){document.getElementById("helpModal").classList.add("open");};
window.closeHelp=function(){document.getElementById("helpModal").classList.remove("open");};

window.downloadCard=function(){
    const exp=document.createElement("canvas");exp.width=800;exp.height=1120;const ex=exp.getContext("2d");
    ex.drawImage(cardCanvas,0,0,800,1120);
    placedElements.forEach(e=>{ex.font=(e.size*2)+"px Arial";ex.fillText(e.emoji,(e.x/100)*800,(e.y/100)*1120+e.size*2);});
    textBlocks.forEach(b=>{
        let f="";if(b.italic)f+="italic ";if(b.bold)f+="bold ";f+=(b.fontSize*2)+"px "+b.fontFamily;
        ex.font=f;ex.fillStyle=b.color||"#fff";ex.shadowColor="rgba(0,0,0,.8)";ex.shadowBlur=8;ex.shadowOffsetX=3;ex.shadowOffsetY=3;
        (b.text||'').split('\n').forEach((l,i)=>ex.fillText(l,(b.x/100)*800,(b.y/100)*1120+(b.fontSize*2)+(i*b.fontSize*2.4)));
    });
    ex.shadowColor="transparent";ex.font="12px Arial";ex.fillStyle="rgba(255,255,255,.3)";ex.fillText("Made with Chameleon Studios",20,1100);
    const link=document.createElement("a");link.download=`chameleon-${currentCardType.id}-${currentStyle.id}-${Date.now()}.png`;link.href=exp.toDataURL("image/png");link.click();toast("Downloaded!");
};
window.emailCard=function(){window.location.href=`mailto:?subject=${encodeURIComponent(currentCardType.name+" Card")}&body=${encodeURIComponent("Created with Chameleon Artflow!\n\n"+(document.getElementById("cardMessage").value||""))}`;toast("Opening email...");};
window.clearCard=function(){if(!confirm("Clear everything?"))return;placedElements=[];textBlocks=[];selectedItem=null;document.getElementById("elementsLayer").innerHTML="";document.getElementById("cardMessage").value="";document.getElementById("cardTo").value="";document.getElementById("cardFrom").value="";document.getElementById("aiStatus").style.display="none";if(drawMode)toggleDrawMode();clearDrawing();generateScene();toast("Cleared!");};
window.toast=function(msg,err){const t=document.getElementById("toast");t.textContent=msg;t.className="toast"+(err?" error":"");t.classList.add("show");setTimeout(()=>t.classList.remove("show"),3000);};

document.addEventListener("keydown",function(e){
    if(e.key==="Escape"){closeGallery();closeHelp();if(drawMode)toggleDrawMode();selectItem(null);}
    if((e.key==="Delete"||e.key==="Backspace")&&selectedItem&&!["INPUT","TEXTAREA"].includes(document.activeElement.tagName)&&!document.activeElement.isContentEditable){e.preventDefault();deleteSelected();}
    if(e.ctrlKey&&e.key==='z'&&drawMode){e.preventDefault();undoDrawing();}
});

document.addEventListener("DOMContentLoaded",init);
})();
</script>
</body>
</html>
