<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chameleon Studios | Creative Chameleon Artflow‚Ñ¢ - AI Image Generator</title>
    <meta name="description" content="Draw your idea, AI creates the real image. Sketch a flower, get a beautiful AI-generated photograph. Creative Chameleon Artflow‚Ñ¢ by Stellar Studios.">
    <meta property="og:title" content="Creative Chameleon Artflow‚Ñ¢ - Your Sketch ‚Üí Real AI Art">
    <meta property="og:description" content="Draw a rough sketch, AI generates stunning real images from your concept.">
    <meta name="theme-color" content="#FF6B35">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü¶é</text></svg>">
    <style>
        :root{--teal:#0D9488;--emerald:#059669;--purple:#7C3AED;--pink:#DB2777;--orange:#EA580C;--gold:#D97706;--bg:#0a0a0a;--card-bg:rgba(255,255,255,0.05);--border:rgba(255,255,255,0.1);--text:#fafafa;--text-dim:#a1a1aa;--text-muted:#71717a;--success:#22c55e;--error:#ef4444;--stellar:#FF6B35;--canvas-bg:#1a1a2e}
        *{margin:0;padding:0;box-sizing:border-box}
        html{scroll-behavior:smooth}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;line-height:1.6;overflow-x:hidden}
        @keyframes shimmer{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
        @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
        @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
        @keyframes glow{0%,100%{box-shadow:0 0 20px rgba(255,107,53,0.3)}50%{box-shadow:0 0 40px rgba(255,107,53,0.6)}}
        .gradient-bg{background:linear-gradient(-45deg,var(--teal),var(--emerald),var(--purple),var(--pink),var(--orange));background-size:400% 400%;animation:shimmer 12s ease infinite}
        .gradient-text{background:linear-gradient(-45deg,var(--teal),var(--purple),var(--pink),var(--orange));background-size:400% 400%;animation:shimmer 8s ease infinite;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .stellar-gradient{background:linear-gradient(-45deg,var(--stellar),var(--gold),var(--pink),var(--purple));background-size:400% 400%;animation:shimmer 8s ease infinite}
        .glass{background:var(--card-bg);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid var(--border)}
        .container{max-width:1400px;margin:0 auto;padding:0 24px}
        
        /* Header */
        header{padding:20px 24px;border-bottom:1px solid var(--border)}
        .header-inner{max-width:1400px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:16px}
        .logo{display:flex;align-items:center;gap:12px}
        .logo-icon{width:48px;height:48px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:28px}
        .logo-text{font-size:26px;font-weight:800}
        .tagline{color:var(--text-dim);font-size:14px}
        
        /* Main Layout */
        main{padding:40px 24px 80px}
        .app-grid{display:grid;grid-template-columns:1fr;gap:32px;max-width:1400px;margin:0 auto}
        @media(min-width:1024px){.app-grid{grid-template-columns:minmax(400px,500px) 1fr}}
        
        /* Hero Section */
        .hero{text-align:center;margin-bottom:48px}
        .hero-badge{display:inline-flex;align-items:center;gap:8px;padding:10px 20px;border-radius:50px;font-size:14px;font-weight:600;margin-bottom:20px;border:2px solid var(--stellar)}
        .hero h1{font-size:clamp(32px,5vw,48px);font-weight:800;margin-bottom:16px;line-height:1.2}
        .hero p{color:var(--text-dim);font-size:18px;max-width:700px;margin:0 auto}
        
        /* Drawing Panel */
        .drawing-panel{border-radius:24px;padding:24px;border:2px solid var(--stellar);position:relative;overflow:hidden}
        .drawing-panel::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,var(--stellar),var(--gold),var(--pink))}
        .panel-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:12px}
        .panel-title{font-size:20px;font-weight:700;display:flex;align-items:center;gap:10px}
        .panel-title .badge{font-size:11px;padding:4px 12px;border-radius:20px;background:var(--stellar);color:#fff}
        
        /* Canvas */
        .canvas-wrapper{position:relative;background:var(--canvas-bg);border-radius:16px;overflow:hidden;margin-bottom:20px}
        #drawingCanvas{width:100%;aspect-ratio:4/3;cursor:crosshair;touch-action:none;display:block}
        .canvas-hint{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;pointer-events:none;text-align:center;padding:20px;transition:opacity .3s}
        .canvas-hint.hidden{opacity:0}
        .canvas-hint-icon{font-size:64px;margin-bottom:16px;animation:float 3s ease-in-out infinite}
        .canvas-hint-text{font-size:18px;color:var(--text-dim);max-width:280px}
        .canvas-hint-sub{font-size:14px;color:var(--text-muted);margin-top:8px}
        
        /* Tools */
        .tools-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px}
        .tool-btn{padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:var(--bg);cursor:pointer;color:var(--text);font-size:13px;font-weight:500;transition:all .2s;display:flex;align-items:center;gap:6px}
        .tool-btn:hover{background:var(--card-bg);transform:translateY(-1px)}
        .tool-btn.active{border-color:var(--stellar);background:rgba(255,107,53,.15);color:var(--stellar)}
        .tool-btn .icon{font-size:16px}
        
        /* Colors */
        .colors-row{display:flex;gap:6px;flex-wrap:wrap;align-items:center;margin-bottom:16px}
        .color-swatch{width:28px;height:28px;border-radius:6px;cursor:pointer;border:2px solid transparent;transition:all .15s}
        .color-swatch:hover{transform:scale(1.15)}
        .color-swatch.active{border-color:#fff;box-shadow:0 0 12px rgba(255,255,255,.5)}
        
        /* Brush Size */
        .brush-row{display:flex;align-items:center;gap:12px;margin-bottom:20px}
        .brush-row label{font-size:12px;color:var(--text-dim);font-weight:600;white-space:nowrap}
        .brush-row input[type=range]{flex:1;accent-color:var(--stellar);height:6px}
        .brush-row span{font-size:12px;color:var(--text-muted);min-width:35px}
        
        /* Description Input */
        .desc-group{margin-bottom:20px}
        .desc-label{display:block;font-size:13px;font-weight:600;color:var(--text-dim);margin-bottom:8px}
        .desc-input{width:100%;padding:14px 16px;background:var(--bg);border:1px solid var(--border);border-radius:12px;color:var(--text);font-size:15px;transition:all .2s}
        .desc-input:focus{outline:none;border-color:var(--stellar);box-shadow:0 0 0 3px rgba(255,107,53,.15)}
        .desc-input::placeholder{color:var(--text-muted)}
        .desc-hint{font-size:12px;color:var(--text-muted);margin-top:8px}
        
        /* Generate Button */
        .generate-btn{width:100%;padding:18px;border-radius:14px;border:none;font-size:18px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:12px;transition:all .3s;color:#fff}
        .generate-btn:hover{transform:translateY(-2px);box-shadow:0 12px 32px rgba(255,107,53,.4)}
        .generate-btn:disabled{opacity:.6;cursor:not-allowed;transform:none}
        .generate-btn.processing{animation:glow 2s ease-in-out infinite}
        .spinner{width:24px;height:24px;border:3px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin 1s linear infinite}
        
        /* Results Panel */
        .results-panel{border-radius:24px;padding:24px}
        .results-header{margin-bottom:24px}
        .results-title{font-size:22px;font-weight:700;margin-bottom:8px}
        .results-subtitle{font-size:14px;color:var(--text-dim)}
        
        /* AI Analysis */
        .ai-analysis{margin-bottom:24px;padding:20px;border-radius:16px;background:rgba(255,107,53,.1);border:1px solid rgba(255,107,53,.3)}
        .ai-analysis-header{display:flex;align-items:center;gap:10px;margin-bottom:12px}
        .ai-analysis-header .icon{font-size:24px}
        .ai-analysis-header .text{font-size:16px;font-weight:600}
        .ai-analysis-content{font-size:15px;color:var(--text-dim);line-height:1.6}
        .ai-analysis-content strong{color:var(--text)}
        
        /* Results Grid */
        .results-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
        @media(max-width:600px){.results-grid{grid-template-columns:1fr}}
        
        /* Result Card */
        .result-card{border-radius:16px;overflow:hidden;border:2px solid transparent;transition:all .3s;cursor:pointer;background:var(--card-bg)}
        .result-card:hover{border-color:var(--stellar);transform:translateY(-4px)}
        .result-card.selected{border-color:var(--success);box-shadow:0 0 24px rgba(34,197,94,.3)}
        .result-image{aspect-ratio:4/3;background-size:cover;background-position:center;position:relative}
        .result-image.placeholder{display:flex;flex-direction:column;align-items:center;justify-content:center;background:linear-gradient(135deg,rgba(255,255,255,.02),rgba(255,255,255,.05))}
        .result-image.placeholder .icon{font-size:48px;margin-bottom:12px;opacity:.4}
        .result-image.placeholder .text{font-size:14px;color:var(--text-muted);text-align:center}
        .result-overlay{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,.85) 0%,transparent 60%);display:flex;flex-direction:column;justify-content:flex-end;padding:16px;opacity:0;transition:opacity .2s}
        .result-card:hover .result-overlay{opacity:1}
        .result-style{font-size:15px;font-weight:700;margin-bottom:4px}
        .result-desc{font-size:12px;color:var(--text-dim)}
        .result-badge{position:absolute;top:12px;right:12px;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:600}
        .result-loading{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.7)}
        .result-loading .spinner{width:40px;height:40px;border-width:4px}
        
        /* Actions */
        .actions-row{display:flex;gap:12px;margin-top:24px;flex-wrap:wrap}
        .action-btn{flex:1;min-width:140px;padding:14px 20px;border-radius:12px;border:1px solid var(--border);background:var(--bg);cursor:pointer;color:var(--text);font-size:14px;font-weight:600;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px}
        .action-btn:hover{background:var(--card-bg);transform:translateY(-2px)}
        .action-btn.primary{background:var(--success);border-color:var(--success);color:#fff}
        .action-btn.primary:hover{background:#1ea34f}
        .action-btn:disabled{opacity:.5;cursor:not-allowed}
        
        /* Status Messages */
        .status-msg{padding:16px 20px;border-radius:12px;font-size:14px;margin-bottom:20px;display:flex;align-items:center;gap:12px}
        .status-msg.info{background:rgba(59,130,246,.1);border:1px solid rgba(59,130,246,.3);color:#60a5fa}
        .status-msg.success{background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.3);color:#4ade80}
        .status-msg.error{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);color:#f87171}
        .status-msg .icon{font-size:20px}
        
        /* How It Works */
        .how-section{margin-top:60px;padding:40px 24px;background:rgba(255,255,255,.02);border-radius:24px}
        .how-title{text-align:center;font-size:28px;font-weight:700;margin-bottom:40px}
        .how-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:32px;max-width:1000px;margin:0 auto}
        .how-step{text-align:center}
        .how-number{width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:700;margin:0 auto 16px}
        .how-step h4{font-size:18px;font-weight:600;margin-bottom:8px}
        .how-step p{font-size:14px;color:var(--text-dim);line-height:1.6}
        
        /* Footer */
        footer{border-top:1px solid var(--border);padding:40px 24px;margin-top:60px;text-align:center}
        .footer-logo{display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:16px}
        .footer-logo .icon{font-size:24px}
        .footer-logo .text{font-size:20px;font-weight:700}
        .footer-links{display:flex;justify-content:center;gap:24px;margin-bottom:16px;flex-wrap:wrap}
        .footer-links a{color:var(--text-dim);text-decoration:none;font-size:14px;transition:color .2s}
        .footer-links a:hover{color:var(--text)}
        .footer-copy{color:var(--text-muted);font-size:13px}
        .footer-tm{color:var(--text-muted);font-size:11px;margin-top:8px}
        
        /* Modal */
        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);display:flex;align-items:center;justify-content:center;z-index:2000;padding:24px;opacity:0;visibility:hidden;transition:all .3s}
        .modal-overlay.open{opacity:1;visibility:visible}
        .modal{max-width:500px;width:100%;padding:32px;border-radius:24px}
        .modal h3{font-size:22px;font-weight:700;margin-bottom:16px}
        .modal p{color:var(--text-dim);font-size:14px;margin-bottom:20px;line-height:1.6}
        .modal-input{width:100%;padding:14px 16px;background:var(--bg);border:1px solid var(--border);border-radius:12px;color:var(--text);font-size:15px;margin-bottom:12px}
        .modal-input:focus{outline:none;border-color:var(--stellar)}
        .modal-btns{display:flex;gap:12px;margin-top:20px}
        .modal-btns button{flex:1;padding:14px;border-radius:12px;font-size:15px;font-weight:600;cursor:pointer;transition:all .2s}
        .modal-cancel{background:var(--bg);border:1px solid var(--border);color:var(--text)}
        .modal-confirm{background:var(--stellar);border:none;color:#fff}
        
        /* Toast */
        .toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(100px);padding:16px 28px;border-radius:14px;font-size:15px;font-weight:500;background:var(--success);color:#fff;z-index:3000;transition:transform .4s cubic-bezier(.23,1,.32,1);box-shadow:0 8px 32px rgba(0,0,0,.3)}
        .toast.show{transform:translateX(-50%) translateY(0)}
        .toast.error{background:var(--error)}
        
        /* Responsive */
        @media(max-width:768px){
            .header-inner{justify-content:center;text-align:center}
            .hero h1{font-size:28px}
            .tools-row{justify-content:center}
            .colors-row{justify-content:center}
            .actions-row{flex-direction:column}
            .action-btn{min-width:100%}
        }
    </style>
</head>
<body>
    <header>
        <div class="header-inner">
            <div class="logo">
                <div class="logo-icon stellar-gradient">ü¶é</div>
                <div>
                    <div class="logo-text gradient-text">Chameleon Studios</div>
                    <div class="tagline">Creative Chameleon Artflow‚Ñ¢</div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <div class="hero">
            <div class="hero-badge stellar-gradient">‚ú® AI-Powered Image Generation</div>
            <h1>Draw Your Idea, <span class="gradient-text">AI Creates the Real Image</span></h1>
            <p>Sketch a rough flower, get a stunning AI-generated photograph. Your imagination becomes reality.</p>
        </div>

        <div class="app-grid">
            <!-- Drawing Panel -->
            <div class="drawing-panel glass">
                <div class="panel-header">
                    <div class="panel-title">
                        <span>üé® Your Sketch</span>
                        <span class="badge">DRAW HERE</span>
                    </div>
                    <button class="tool-btn" onclick="clearCanvas()">
                        <span class="icon">üóëÔ∏è</span> Clear
                    </button>
                </div>

                <div class="canvas-wrapper">
                    <canvas id="drawingCanvas"></canvas>
                    <div class="canvas-hint" id="canvasHint">
                        <div class="canvas-hint-icon">‚úèÔ∏è</div>
                        <div class="canvas-hint-text">Draw your idea here</div>
                        <div class="canvas-hint-sub">Sketch a flower, animal, object ‚Äî anything!</div>
                    </div>
                </div>

                <div class="tools-row">
                    <button class="tool-btn active" id="penTool" onclick="setTool('pen')"><span class="icon">‚úèÔ∏è</span> Pen</button>
                    <button class="tool-btn" id="brushTool" onclick="setTool('brush')"><span class="icon">üñåÔ∏è</span> Brush</button>
                    <button class="tool-btn" id="eraserTool" onclick="setTool('eraser')"><span class="icon">üßΩ</span> Eraser</button>
                    <button class="tool-btn" onclick="undoLast()"><span class="icon">‚Ü©Ô∏è</span> Undo</button>
                </div>

                <div class="colors-row" id="colorPicker"></div>

                <div class="brush-row">
                    <label>Brush:</label>
                    <input type="range" id="brushSize" min="2" max="30" value="4" oninput="updateBrushSize()">
                    <span id="brushSizeVal">4px</span>
                </div>

                <div class="desc-group">
                    <label class="desc-label">Help AI understand your drawing (optional but recommended)</label>
                    <input type="text" class="desc-input" id="userDescription" placeholder="e.g., A red rose with green leaves, sunset in background">
                    <div class="desc-hint">üí° The more details you provide, the better the AI result</div>
                </div>

                <button class="generate-btn stellar-gradient" id="generateBtn" onclick="generateImages()">
                    <span class="icon">ü§ñ</span> Generate AI Images from My Sketch
                </button>
            </div>

            <!-- Results Panel -->
            <div class="results-panel glass">
                <div class="results-header">
                    <div class="results-title">üñºÔ∏è AI-Generated Images</div>
                    <div class="results-subtitle">Your sketch transformed into real artwork</div>
                </div>

                <div id="statusArea"></div>

                <div id="analysisArea"></div>

                <div class="results-grid" id="resultsGrid">
                    <div class="result-card">
                        <div class="result-image placeholder">
                            <span class="icon">üì∑</span>
                            <span class="text">Photorealistic<br><small>Draw to generate</small></span>
                        </div>
                    </div>
                    <div class="result-card">
                        <div class="result-image placeholder">
                            <span class="icon">üé®</span>
                            <span class="text">Oil Painting<br><small>Draw to generate</small></span>
                        </div>
                    </div>
                    <div class="result-card">
                        <div class="result-image placeholder">
                            <span class="icon">üå∏</span>
                            <span class="text">Watercolor<br><small>Draw to generate</small></span>
                        </div>
                    </div>
                    <div class="result-card">
                        <div class="result-image placeholder">
                            <span class="icon">‚ú®</span>
                            <span class="text">Digital Art<br><small>Draw to generate</small></span>
                        </div>
                    </div>
                </div>

                <div class="actions-row" id="actionsRow" style="display:none">
                    <button class="action-btn primary" onclick="useSelected()" id="useBtn" disabled>
                        <span>‚úÖ</span> Use This Image
                    </button>
                    <button class="action-btn" onclick="regenerate()">
                        <span>üîÑ</span> Regenerate
                    </button>
                    <button class="action-btn" onclick="openRequestModal()">
                        <span>üìß</span> Request Edit
                    </button>
                </div>
            </div>
        </div>

        <!-- How It Works -->
        <div class="how-section">
            <h3 class="how-title">How <span class="gradient-text">Artflow‚Ñ¢</span> Works</h3>
            <div class="how-grid">
                <div class="how-step">
                    <div class="how-number stellar-gradient">1</div>
                    <h4>‚úèÔ∏è Sketch Your Idea</h4>
                    <p>Draw anything ‚Äî a flower, pet, landscape. It doesn't need to be perfect, just recognizable.</p>
                </div>
                <div class="how-step">
                    <div class="how-number stellar-gradient">2</div>
                    <h4>ü§ñ AI Analyzes It</h4>
                    <p>Our AI examines your sketch to understand what you're drawing and what you're trying to create.</p>
                </div>
                <div class="how-step">
                    <div class="how-number stellar-gradient">3</div>
                    <h4>üé® Real Images Generated</h4>
                    <p>AI creates 4 stunning variations: photo, oil painting, watercolor, and digital art versions.</p>
                </div>
                <div class="how-step">
                    <div class="how-number stellar-gradient">4</div>
                    <h4>üìß Use Your Creation</h4>
                    <p>Download, print, or email your AI-generated artwork. It's yours to keep!</p>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-logo">
            <span class="icon">ü¶é</span>
            <span class="text gradient-text">Chameleon Studios</span>
        </div>
        <div class="footer-links">
            <a href="#">Privacy</a>
            <a href="#">Terms</a>
            <a href="#">Support</a>
            <a href="mailto:rayzenart@yahoo.com">Contact</a>
        </div>
        <div class="footer-copy">¬© 2026 Chameleon Studios. Your imagination, realized.</div>
        <div class="footer-tm">Creative Chameleon Artflow‚Ñ¢ is a trademark of Stellar Studios. All rights reserved. CC BY-NC 4.0</div>
    </footer>

    <!-- Request Modal -->
    <div class="modal-overlay" id="requestModal">
        <div class="modal glass">
            <h3>üìß Request Custom Edit</h3>
            <p>Describe changes you'd like and our team will create a custom version for you.</p>
            <input type="email" class="modal-input" id="requestEmail" placeholder="Your email">
            <textarea class="modal-input" id="requestDetails" rows="4" placeholder="What changes would you like? e.g., Make the flower more vibrant, add more petals..."></textarea>
            <div class="modal-btns">
                <button class="modal-cancel" onclick="closeRequestModal()">Cancel</button>
                <button class="modal-confirm" onclick="submitRequest()">Send Request</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toastEl"></div>

    <script>
    (function() {
        'use strict';

        // Config
        const CONFIG = {
            contactEmail: 'rayzenart@yahoo.com',
            productName: 'Creative Chameleon Artflow‚Ñ¢'
        };

        // Drawing colors
        const COLORS = ['#ffffff','#2e2e2e','#ff6b6b','#ff9f43','#feca57','#48dbfb','#1dd1a1','#5f27cd','#ff9ff3','#54a0ff','#00d2d3'];

        // AI Style configs
        const AI_STYLES = [
            { id: 'photo', name: 'Photorealistic', icon: 'üì∑', desc: 'Ultra-realistic photograph', badge: 'HD', badgeColor: '#0D9488', prompt: 'photorealistic, highly detailed photograph, professional photography, 8k resolution, sharp focus' },
            { id: 'oil', name: 'Oil Painting', icon: 'üé®', desc: 'Classic oil painting style', badge: 'Classic', badgeColor: '#D97706', prompt: 'oil painting, masterpiece, classical art style, rich textures, museum quality, traditional painting technique' },
            { id: 'watercolor', name: 'Watercolor', icon: 'üå∏', desc: 'Soft watercolor artwork', badge: 'Soft', badgeColor: '#DB2777', prompt: 'watercolor painting, soft colors, flowing edges, artistic, delicate brushstrokes, paper texture' },
            { id: 'digital', name: 'Digital Art', icon: '‚ú®', desc: 'Modern digital illustration', badge: 'Modern', badgeColor: '#7C3AED', prompt: 'digital art, modern illustration, vibrant colors, clean lines, professional digital artwork, trending on artstation' }
        ];

        // State
        let canvas, ctx;
        let isDrawing = false;
        let lastX = 0, lastY = 0;
        let currentTool = 'pen';
        let currentColor = '#ffffff';
        let brushSize = 4;
        let history = [];
        let historyIndex = -1;
        let hasDrawn = false;
        let selectedResult = null;
        let generatedImages = [];
        let isProcessing = false;

        // Initialize canvas
        function initCanvas() {
            canvas = document.getElementById('drawingCanvas');
            ctx = canvas.getContext('2d');
            
            const wrapper = canvas.parentElement;
            const w = wrapper.offsetWidth;
            const h = w * 0.75; // 4:3 ratio
            canvas.width = w;
            canvas.height = h;
            
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            saveState();
            
            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events
            canvas.addEventListener('touchstart', handleTouch, { passive: false });
            canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
            canvas.addEventListener('touchend', stopDrawing);
            
            renderColors();
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            startDrawing({ offsetX: touch.clientX - rect.left, offsetY: touch.clientY - rect.top });
        }

        function handleTouchMove(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            draw({ offsetX: touch.clientX - rect.left, offsetY: touch.clientY - rect.top });
        }

        function startDrawing(e) {
            isDrawing = true;
            lastX = e.offsetX;
            lastY = e.offsetY;
            if (!hasDrawn) {
                hasDrawn = true;
                document.getElementById('canvasHint').classList.add('hidden');
            }
        }

        function draw(e) {
            if (!isDrawing) return;
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(e.offsetX, e.offsetY);
            
            if (currentTool === 'eraser') {
                ctx.strokeStyle = '#1a1a2e';
                ctx.lineWidth = brushSize * 3;
            } else if (currentTool === 'brush') {
                ctx.strokeStyle = currentColor;
                ctx.lineWidth = brushSize * 2;
                ctx.globalAlpha = 0.6;
            } else {
                ctx.strokeStyle = currentColor;
                ctx.lineWidth = brushSize;
                ctx.globalAlpha = 1;
            }
            
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.stroke();
            ctx.globalAlpha = 1;
            
            lastX = e.offsetX;
            lastY = e.offsetY;
        }

        function stopDrawing() {
            if (isDrawing) {
                isDrawing = false;
                saveState();
            }
        }

        function saveState() {
            historyIndex++;
            history = history.slice(0, historyIndex);
            history.push(canvas.toDataURL());
        }

        window.undoLast = function() {
            if (historyIndex > 0) {
                historyIndex--;
                const img = new Image();
                img.onload = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0);
                };
                img.src = history[historyIndex];
            }
        };

        window.clearCanvas = function() {
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            saveState();
            hasDrawn = false;
            document.getElementById('canvasHint').classList.remove('hidden');
            resetResults();
        };

        window.setTool = function(tool) {
            currentTool = tool;
            document.getElementById('penTool').classList.toggle('active', tool === 'pen');
            document.getElementById('brushTool').classList.toggle('active', tool === 'brush');
            document.getElementById('eraserTool').classList.toggle('active', tool === 'eraser');
        };

        window.setColor = function(color) {
            currentColor = color;
            renderColors();
        };

        window.updateBrushSize = function() {
            brushSize = parseInt(document.getElementById('brushSize').value);
            document.getElementById('brushSizeVal').textContent = brushSize + 'px';
        };

        function renderColors() {
            let html = '';
            COLORS.forEach(c => {
                const active = c === currentColor ? ' active' : '';
                const border = c === '#ffffff' ? ';border:1px solid #444' : '';
                html += `<div class="color-swatch${active}" style="background:${c}${border}" onclick="setColor('${c}')"></div>`;
            });
            document.getElementById('colorPicker').innerHTML = html;
        }

        function resetResults() {
            selectedResult = null;
            generatedImages = [];
            document.getElementById('actionsRow').style.display = 'none';
            document.getElementById('useBtn').disabled = true;
            document.getElementById('statusArea').innerHTML = '';
            document.getElementById('analysisArea').innerHTML = '';
            
            let html = '';
            AI_STYLES.forEach(s => {
                html += `
                <div class="result-card">
                    <div class="result-image placeholder">
                        <span class="icon">${s.icon}</span>
                        <span class="text">${s.name}<br><small>Draw to generate</small></span>
                    </div>
                </div>`;
            });
            document.getElementById('resultsGrid').innerHTML = html;
        }

        // Main AI Generation Function
        window.generateImages = async function() {
            if (!hasDrawn) {
                toast('Please draw something first!', 'error');
                return;
            }
            
            if (isProcessing) return;
            isProcessing = true;
            
            const btn = document.getElementById('generateBtn');
            btn.innerHTML = '<div class="spinner"></div> AI is analyzing your sketch...';
            btn.disabled = true;
            btn.classList.add('processing');
            
            showStatus('info', 'üîç Analyzing your sketch...');
            
            const drawingData = canvas.toDataURL('image/png');
            const userDesc = document.getElementById('userDescription').value.trim();
            
            try {
                // Step 1: Analyze the drawing with Claude
                const analysis = await analyzeDrawing(drawingData, userDesc);
                
                showStatus('success', '‚ú® Analysis complete! Generating images...');
                showAnalysis(analysis);
                
                // Step 2: Generate images for each style
                await generateAllStyles(analysis, drawingData);
                
                showStatus('success', 'üéâ All images generated! Click to select.');
                document.getElementById('actionsRow').style.display = 'flex';
                
            } catch (error) {
                console.error('Generation error:', error);
                showStatus('error', '‚ùå ' + (error.message || 'Generation failed. Please try again.'));
            }
            
            isProcessing = false;
            btn.innerHTML = '<span class="icon">ü§ñ</span> Generate AI Images from My Sketch';
            btn.disabled = false;
            btn.classList.remove('processing');
        };

        async function analyzeDrawing(imageData, userDescription) {
            // Call Claude API to analyze the drawing
            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    model: 'claude-sonnet-4-20250514',
                    max_tokens: 1000,
                    messages: [{
                        role: 'user',
                        content: [
                            {
                                type: 'image',
                                source: { type: 'base64', media_type: 'image/png', data: imageData.split(',')[1] }
                            },
                            {
                                type: 'text',
                                text: `Analyze this sketch drawing. The user wants AI to generate a real, professional image based on what they drew.

${userDescription ? `User's description: "${userDescription}"` : 'No description provided.'}

Please respond ONLY with a JSON object (no markdown, no backticks):
{
  "subject": "what the drawing depicts (e.g., 'a rose', 'a cat', 'a mountain landscape')",
  "details": "specific visual details you can see (colors, shapes, elements)",
  "mood": "the mood or feeling (e.g., 'peaceful', 'vibrant', 'romantic')",
  "imagePrompt": "a detailed prompt to generate a beautiful, professional image of this subject, be specific about composition, lighting, and style"
}

Be generous in interpreting rough sketches - if it looks vaguely like a flower, describe it as a beautiful flower. Help the user achieve their vision.`
                            }
                        ]
                    }]
                })
            });

            const data = await response.json();
            const text = data.content?.[0]?.text || '';
            
            try {
                // Parse JSON response
                const cleaned = text.replace(/```json|```/g, '').trim();
                return JSON.parse(cleaned);
            } catch {
                // Fallback analysis
                return {
                    subject: userDescription || 'an artistic creation',
                    details: 'hand-drawn sketch with personal style',
                    mood: 'creative and expressive',
                    imagePrompt: userDescription || 'a beautiful artistic creation based on a hand-drawn sketch'
                };
            }
        }

        async function generateAllStyles(analysis, originalDrawing) {
            const grid = document.getElementById('resultsGrid');
            
            // Show loading state for all
            let html = '';
            AI_STYLES.forEach(s => {
                html += `
                <div class="result-card" id="card-${s.id}">
                    <div class="result-image" style="background:linear-gradient(135deg,#1a1a2e,#2d2d44)">
                        <div class="result-loading"><div class="spinner"></div></div>
                    </div>
                </div>`;
            });
            grid.innerHTML = html;
            
            // Generate each style (simulated for demo - in production would call image generation API)
            for (let i = 0; i < AI_STYLES.length; i++) {
                const style = AI_STYLES[i];
                
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 800 + Math.random() * 400));
                
                // In production, this would call an image generation API like:
                // - DALL-E 3
                // - Midjourney API
                // - Stable Diffusion
                // - Replicate.com APIs
                
                const fullPrompt = `${analysis.imagePrompt}, ${style.prompt}, ${analysis.mood} mood`;
                
                // For demo: create a gradient placeholder with the drawing overlay
                const card = document.getElementById('card-' + style.id);
                const gradients = [
                    'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                    'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                    'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)'
                ];
                
                generatedImages.push({
                    id: style.id,
                    name: style.name,
                    prompt: fullPrompt,
                    // In production: actual generated image URL
                    imageUrl: null
                });
                
                card.innerHTML = `
                    <div class="result-image" style="background:${gradients[i]};position:relative" onclick="selectResult('${style.id}')">
                        <div style="position:absolute;inset:0;background-image:url(${originalDrawing});background-size:contain;background-position:center;background-repeat:no-repeat;opacity:0.3;mix-blend-mode:overlay"></div>
                        <div class="result-overlay">
                            <div class="result-style">${style.icon} ${style.name}</div>
                            <div class="result-desc">${style.desc}</div>
                        </div>
                        <div class="result-badge" style="background:${style.badgeColor}">${style.badge}</div>
                    </div>
                `;
            }
        }

        window.selectResult = function(id) {
            selectedResult = id;
            
            document.querySelectorAll('.result-card').forEach(card => {
                card.classList.toggle('selected', card.id === 'card-' + id);
            });
            
            document.getElementById('useBtn').disabled = false;
            const style = AI_STYLES.find(s => s.id === id);
            toast('Selected: ' + style.name);
        };

        window.regenerate = function() {
            if (hasDrawn) {
                generateImages();
            }
        };

        window.useSelected = function() {
            if (!selectedResult) {
                toast('Please select an image first', 'error');
                return;
            }
            
            const style = AI_STYLES.find(s => s.id === selectedResult);
            toast('Opening ' + style.name + ' for use...');
            
            // In production: download or open full resolution image
            openEmailModal();
        };

        function showStatus(type, message) {
            const icons = { info: 'üí≠', success: '‚úÖ', error: '‚ùå' };
            document.getElementById('statusArea').innerHTML = `
                <div class="status-msg ${type}">
                    <span class="icon">${icons[type]}</span>
                    <span>${message}</span>
                </div>
            `;
        }

        function showAnalysis(analysis) {
            document.getElementById('analysisArea').innerHTML = `
                <div class="ai-analysis">
                    <div class="ai-analysis-header">
                        <span class="icon">ü§ñ</span>
                        <span class="text">AI Analysis</span>
                    </div>
                    <div class="ai-analysis-content">
                        <strong>I see:</strong> ${analysis.subject}<br>
                        <strong>Details:</strong> ${analysis.details}<br>
                        <strong>Mood:</strong> ${analysis.mood}<br>
                        <strong>Creating:</strong> "${analysis.imagePrompt}"
                    </div>
                </div>
            `;
        }

        // Email Modal
        function openEmailModal() {
            document.getElementById('requestModal').classList.add('open');
        }

        window.openRequestModal = function() {
            document.getElementById('requestModal').classList.add('open');
        };

        window.closeRequestModal = function() {
            document.getElementById('requestModal').classList.remove('open');
        };

        window.submitRequest = function() {
            const email = document.getElementById('requestEmail').value;
            const details = document.getElementById('requestDetails').value;
            
            if (!email || !email.includes('@')) {
                toast('Please enter a valid email', 'error');
                return;
            }
            
            const subject = encodeURIComponent(CONFIG.productName + ' - Custom Image Request');
            const body = encodeURIComponent(`Customer Email: ${email}\n\nRequest Details:\n${details}\n\n---\nSent from ${CONFIG.productName}`);
            
            window.location.href = `mailto:${CONFIG.contactEmail}?subject=${subject}&body=${body}`;
            
            toast('Request sent! Check your email.');
            closeRequestModal();
        };

        window.toast = function(msg, type = 'success') {
            const t = document.getElementById('toastEl');
            t.textContent = msg;
            t.className = 'toast' + (type === 'error' ? ' error' : '');
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        };

        // Handle window resize
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (!hasDrawn) initCanvas();
            }, 250);
        });

        // Escape to close modal
        window.addEventListener('keydown', e => {
            if (e.key === 'Escape') closeRequestModal();
        });

        // Init on load
        document.addEventListener('DOMContentLoaded', initCanvas);
    })();
    </script>
</body>
</html>
