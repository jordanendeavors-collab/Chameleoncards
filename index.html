<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Creative Chameleon Artflow‚Ñ¢ | Cards, Invites & Events</title>
    <meta name="description" content="Draw your art, create stunning cards, invites, and event announcements. 100% offline by Stellar Studios.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü¶é</text></svg>">
    <style>
        :root {
            --bg: #09090b;
            --surface: #18181b;
            --card: rgba(255,255,255,0.03);
            --border: rgba(255,255,255,0.08);
            --text: #fafafa;
            --dim: #a1a1aa;
            --muted: #52525b;
            --stellar: #FF6B35;
            --stellar-dim: rgba(255,107,53,0.15);
            --teal: #14b8a6;
            --purple: #a855f7;
            --pink: #ec4899;
            --success: #22c55e;
            --error: #ef4444;
            --gold: #f59e0b;
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.5;
            overflow-x: hidden;
        }
        
        /* === HEADER === */
        header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(9,9,11,0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border);
            padding: 12px 16px;
        }
        .header-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }
        .logo { display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .logo-icon {
            width: 40px; height: 40px;
            background: linear-gradient(135deg, var(--stellar), var(--gold));
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 22px;
        }
        .logo-text { font-size: 20px; font-weight: 800; }
        .logo-text span { color: var(--stellar); }
        
        .nav-tabs {
            display: flex;
            gap: 4px;
            margin-left: auto;
            background: var(--surface);
            padding: 4px;
            border-radius: 10px;
        }
        .nav-tab {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: var(--dim);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .nav-tab:hover { color: var(--text); }
        .nav-tab.active { background: var(--stellar); color: #fff; }
        
        /* === MAIN LAYOUT === */
        main { padding: 20px 16px 60px; }
        .container { max-width: 1400px; margin: 0 auto; }
        
        /* === STEP INDICATOR === */
        .steps-bar {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        .step-pill {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 50px;
            font-size: 13px;
            color: var(--dim);
            transition: all 0.3s;
        }
        .step-pill.active {
            background: var(--stellar-dim);
            border-color: var(--stellar);
            color: var(--stellar);
        }
        .step-pill.done {
            background: rgba(34,197,94,0.1);
            border-color: var(--success);
            color: var(--success);
        }
        .step-num {
            width: 22px; height: 22px;
            background: currentColor;
            color: var(--bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
        }
        .step-pill.active .step-num, .step-pill.done .step-num { background: currentColor; }
        
        /* === PANELS === */
        .panel {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .panel-title {
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .badge {
            background: var(--stellar);
            color: #fff;
            font-size: 10px;
            font-weight: 700;
            padding: 3px 8px;
            border-radius: 10px;
        }
        
        /* === GRID LAYOUTS === */
        .two-col {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        @media (min-width: 900px) {
            .two-col { grid-template-columns: 1fr 1fr; }
        }
        .three-col {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
        }
        
        /* === CANVAS === */
        .canvas-wrap {
            position: relative;
            background: #12121a;
            border-radius: 12px;
            overflow: hidden;
        }
        #drawCanvas {
            width: 100%;
            aspect-ratio: 4/3;
            display: block;
            cursor: crosshair;
            touch-action: none;
        }
        .canvas-hint {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            text-align: center;
            padding: 20px;
            transition: opacity 0.3s;
        }
        .canvas-hint.hidden { opacity: 0; }
        .canvas-hint-icon { font-size: 48px; margin-bottom: 8px; }
        .canvas-hint-text { font-size: 14px; color: var(--dim); }
        
        /* === TOOLS === */
        .tools-row {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin: 12px 0;
        }
        .tool-btn {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
        }
        .tool-btn:hover { background: var(--surface); }
        .tool-btn.active { border-color: var(--stellar); background: var(--stellar-dim); color: var(--stellar); }
        
        .colors-row {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin: 12px 0;
        }
        .color-dot {
            width: 26px; height: 26px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.15s;
        }
        .color-dot:hover { transform: scale(1.15); }
        .color-dot.active { border-color: #fff; box-shadow: 0 0 8px rgba(255,255,255,0.5); }
        
        .slider-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 12px 0;
        }
        .slider-row label { font-size: 12px; color: var(--dim); white-space: nowrap; }
        .slider-row input[type=range] { flex: 1; accent-color: var(--stellar); }
        .slider-row span { font-size: 11px; color: var(--muted); min-width: 30px; }
        
        /* === BUTTONS === */
        .btn {
            padding: 12px 20px;
            border-radius: 10px;
            border: none;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }
        .btn:hover { transform: translateY(-1px); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-primary {
            background: linear-gradient(135deg, var(--stellar), #e55a2b);
            color: #fff;
        }
        .btn-primary:hover { box-shadow: 0 8px 20px rgba(255,107,53,0.3); }
        .btn-secondary {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text);
        }
        .btn-success { background: var(--success); color: #fff; }
        .btn-full { width: 100%; }
        .btn-lg { padding: 16px 24px; font-size: 16px; }
        
        /* === CARD TYPE SELECTOR === */
        .card-types {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
        }
        .card-type {
            padding: 14px 8px;
            border-radius: 12px;
            border: 2px solid var(--border);
            background: var(--surface);
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }
        .card-type:hover { border-color: var(--stellar); transform: translateY(-2px); }
        .card-type.active { border-color: var(--stellar); background: var(--stellar-dim); }
        .card-type-icon { font-size: 28px; margin-bottom: 6px; }
        .card-type-name { font-size: 12px; font-weight: 600; }
        
        /* === FORM ELEMENTS === */
        .form-group { margin-bottom: 16px; }
        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: var(--dim);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .form-input, .form-textarea {
            width: 100%;
            padding: 12px 14px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
        }
        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--stellar);
            box-shadow: 0 0 0 3px var(--stellar-dim);
        }
        .form-input::placeholder, .form-textarea::placeholder { color: var(--muted); }
        .form-textarea { min-height: 100px; resize: vertical; }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        .form-hint {
            font-size: 11px;
            color: var(--muted);
            margin-top: 4px;
        }
        
        /* === SCENE RESULTS === */
        .scenes-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        .scene-card {
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--surface);
        }
        .scene-card:hover { border-color: var(--stellar); transform: translateY(-2px); }
        .scene-card.selected { border-color: var(--success); box-shadow: 0 0 16px rgba(34,197,94,0.3); }
        .scene-canvas {
            width: 100%;
            aspect-ratio: 4/3;
            display: block;
            background: #12121a;
        }
        .scene-label {
            padding: 10px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .scene-label small { color: var(--dim); font-weight: 400; margin-left: auto; }
        
        /* === CARD PREVIEW === */
        .card-preview-wrap {
            perspective: 1000px;
            margin: 20px 0;
        }
        .card-preview {
            position: relative;
            aspect-ratio: 5/7;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            cursor: pointer;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .card-preview:hover { transform: rotateY(5deg) rotateX(2deg); }
        .card-preview.flipped { transform: rotateY(180deg); }
        .card-face {
            position: absolute;
            inset: 0;
            backface-visibility: hidden;
            border-radius: 16px;
            overflow: hidden;
        }
        .card-front {
            display: flex;
            flex-direction: column;
        }
        .card-back {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, var(--surface), var(--bg));
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }
        .card-scene {
            position: absolute;
            inset: 0;
        }
        .card-scene canvas {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .card-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0.5));
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 24px;
            color: #fff;
            text-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }
        .card-type-badge {
            display: inline-block;
            padding: 6px 14px;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(8px);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            width: fit-content;
        }
        .card-message {
            font-size: clamp(18px, 4vw, 28px);
            font-weight: 600;
            line-height: 1.4;
            margin: auto 0;
            text-align: center;
        }
        .card-footer {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }
        .card-back-content .icon { font-size: 48px; margin-bottom: 12px; }
        .card-back-content .title { font-size: 18px; font-weight: 700; margin-bottom: 4px; }
        .card-back-content .sub { font-size: 12px; color: var(--dim); }
        
        /* === EVENT DETAILS === */
        .event-fields {
            background: var(--surface);
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
        }
        .event-fields-title {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* === DETECTION BOX === */
        .detection-box {
            background: var(--stellar-dim);
            border: 1px solid rgba(255,107,53,0.3);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 16px;
        }
        .detection-header {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .detection-text {
            font-size: 12px;
            color: var(--dim);
            line-height: 1.6;
        }
        .detection-text strong { color: var(--text); }
        
        /* === ACTIONS === */
        .actions-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 16px;
        }
        .actions-row .btn { flex: 1; min-width: 120px; }
        
        /* === TOAST === */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--success);
            color: #fff;
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            z-index: 1000;
            transition: transform 0.3s ease;
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        }
        .toast.show { transform: translateX(-50%) translateY(0); }
        .toast.error { background: var(--error); }
        
        /* === MODAL === */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        .modal-overlay.open { opacity: 1; visibility: visible; }
        .modal {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 24px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .modal-close {
            margin-left: auto;
            background: none;
            border: none;
            color: var(--dim);
            font-size: 24px;
            cursor: pointer;
        }
        .modal-btns {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .modal-btns .btn { flex: 1; }
        
        /* === FOOTER === */
        footer {
            text-align: center;
            padding: 40px 20px;
            border-top: 1px solid var(--border);
            margin-top: 60px;
        }
        .footer-brand { font-size: 18px; font-weight: 700; margin-bottom: 8px; }
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        .footer-links a { color: var(--dim); text-decoration: none; font-size: 13px; }
        .footer-links a:hover { color: var(--text); }
        .footer-copy { font-size: 12px; color: var(--muted); }
        
        /* === RESPONSIVE === */
        @media (max-width: 768px) {
            .nav-tabs { width: 100%; justify-content: center; margin-left: 0; margin-top: 10px; }
            .form-row { grid-template-columns: 1fr; }
            .scenes-grid { grid-template-columns: 1fr; }
            .card-types { grid-template-columns: repeat(3, 1fr); }
            .actions-row { flex-direction: column; }
            .actions-row .btn { min-width: 100%; }
        }
        
        /* === SECTION VISIBILITY === */
        .section { display: none; }
        .section.active { display: block; }
        
        /* === QUICK TEMPLATES === */
        .quick-templates {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 8px;
        }
        .quick-template {
            padding: 6px 12px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 12px;
            color: var(--dim);
            cursor: pointer;
            transition: all 0.2s;
        }
        .quick-template:hover {
            background: var(--stellar-dim);
            border-color: var(--stellar);
            color: var(--stellar);
        }
    </style>
</head>
<body>
    <header>
        <div class="header-inner">
            <div class="logo" onclick="goHome()">
                <div class="logo-icon">ü¶é</div>
                <div class="logo-text">Chameleon <span>Artflow‚Ñ¢</span></div>
            </div>
            <div class="nav-tabs">
                <button class="nav-tab active" data-section="create" onclick="showSection('create')">‚ú® Create</button>
                <button class="nav-tab" data-section="gallery" onclick="showSection('gallery')">üñºÔ∏è Gallery</button>
                <button class="nav-tab" data-section="help" onclick="showSection('help')">‚ùì Help</button>
            </div>
        </div>
    </header>
    
    <main>
        <div class="container">
            <!-- CREATE SECTION -->
            <section class="section active" id="section-create">
                <!-- Step Indicator -->
                <div class="steps-bar">
                    <div class="step-pill active" id="step1-pill">
                        <span class="step-num">1</span>
                        <span>Draw</span>
                    </div>
                    <div class="step-pill" id="step2-pill">
                        <span class="step-num">2</span>
                        <span>Card Type</span>
                    </div>
                    <div class="step-pill" id="step3-pill">
                        <span class="step-num">3</span>
                        <span>Customize</span>
                    </div>
                    <div class="step-pill" id="step4-pill">
                        <span class="step-num">4</span>
                        <span>Finish</span>
                    </div>
                </div>
                
                <div class="two-col">
                    <!-- LEFT COLUMN: Drawing + Scene Generation -->
                    <div>
                        <!-- STEP 1: DRAW -->
                        <div class="panel" id="step1-panel">
                            <div class="panel-header">
                                <div class="panel-title">‚úèÔ∏è Draw Your Art <span class="badge">STEP 1</span></div>
                                <button class="tool-btn" onclick="clearCanvas()">üóëÔ∏è Clear</button>
                            </div>
                            
                            <div class="canvas-wrap">
                                <canvas id="drawCanvas"></canvas>
                                <div class="canvas-hint" id="canvasHint">
                                    <div class="canvas-hint-icon">üé®</div>
                                    <div class="canvas-hint-text">Draw a flower, heart, sun, tree...</div>
                                </div>
                            </div>
                            
                            <div class="tools-row">
                                <button class="tool-btn active" id="toolPen" onclick="setTool('pen')">‚úèÔ∏è Pen</button>
                                <button class="tool-btn" id="toolBrush" onclick="setTool('brush')">üñåÔ∏è Brush</button>
                                <button class="tool-btn" id="toolEraser" onclick="setTool('eraser')">üßΩ Eraser</button>
                                <button class="tool-btn" onclick="undo()">‚Ü©Ô∏è Undo</button>
                            </div>
                            
                            <div class="colors-row" id="colorPicker"></div>
                            
                            <div class="slider-row">
                                <label>Size:</label>
                                <input type="range" id="brushSize" min="2" max="30" value="4" oninput="updateSize()">
                                <span id="sizeLabel">4px</span>
                            </div>
                            
                            <button class="btn btn-primary btn-full btn-lg" id="generateBtn" onclick="generateScenes()">
                                üé® Generate Scene from Drawing
                            </button>
                        </div>
                        
                        <!-- SCENE RESULTS -->
                        <div class="panel" id="scenesPanel" style="display:none">
                            <div class="panel-header">
                                <div class="panel-title">üñºÔ∏è Generated Scenes</div>
                            </div>
                            
                            <div class="detection-box" id="detectionBox">
                                <div class="detection-header">ü§ñ AI Detected</div>
                                <div class="detection-text" id="detectionText"></div>
                            </div>
                            
                            <div class="scenes-grid" id="scenesGrid"></div>
                            
                            <div class="actions-row" style="margin-top:16px">
                                <button class="btn btn-secondary" onclick="keepDrawing()">
                                    ‚úèÔ∏è Keep Drawing
                                </button>
                                <button class="btn btn-primary" onclick="proceedToCardType()" id="proceedBtn" disabled>
                                    ‚úÖ Use Scene ‚Üí Card Type
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- RIGHT COLUMN: Card Type + Customize + Preview -->
                    <div>
                        <!-- STEP 2: CARD TYPE -->
                        <div class="panel" id="step2-panel" style="display:none">
                            <div class="panel-header">
                                <div class="panel-title">üìã Card Type <span class="badge">STEP 2</span></div>
                            </div>
                            
                            <div class="card-types" id="cardTypes"></div>
                            
                            <!-- Event Details (shown for invites) -->
                            <div class="event-fields" id="eventFields" style="display:none">
                                <div class="event-fields-title">üìÖ Event Details</div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Date</label>
                                        <input type="date" class="form-input" id="eventDate">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Time</label>
                                        <input type="time" class="form-input" id="eventTime">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Location</label>
                                    <input type="text" class="form-input" id="eventLocation" placeholder="e.g., 123 Main St, City">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">RSVP Info (optional)</label>
                                    <input type="text" class="form-input" id="eventRSVP" placeholder="e.g., RSVP by Jan 15 to email@example.com">
                                </div>
                            </div>
                        </div>
                        
                        <!-- STEP 3: CUSTOMIZE -->
                        <div class="panel" id="step3-panel" style="display:none">
                            <div class="panel-header">
                                <div class="panel-title">‚úçÔ∏è Customize <span class="badge">STEP 3</span></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Your Message</label>
                                <textarea class="form-textarea" id="cardMessage" placeholder="Write your heartfelt message..." oninput="updatePreview()"></textarea>
                                <div class="quick-templates" id="quickTemplates"></div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">To</label>
                                    <input type="text" class="form-input" id="cardTo" placeholder="Recipient name" oninput="updatePreview()">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">From</label>
                                    <input type="text" class="form-input" id="cardFrom" placeholder="Your name" oninput="updatePreview()">
                                </div>
                            </div>
                        </div>
                        
                        <!-- STEP 4: PREVIEW & FINISH -->
                        <div class="panel" id="step4-panel" style="display:none">
                            <div class="panel-header">
                                <div class="panel-title">üëÅÔ∏è Preview <span class="badge">STEP 4</span></div>
                            </div>
                            
                            <div class="card-preview-wrap">
                                <div class="card-preview" id="cardPreview" onclick="flipCard()">
                                    <div class="card-face card-front">
                                        <div class="card-scene" id="cardScene"></div>
                                        <div class="card-overlay">
                                            <div class="card-type-badge" id="previewBadge">Thank You</div>
                                            <div class="card-message" id="previewMessage">Your message here...</div>
                                            <div class="card-footer">
                                                <span id="previewTo"></span>
                                                <span id="previewFrom"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-face card-back">
                                        <div class="card-back-content">
                                            <div class="icon">ü¶é</div>
                                            <div class="title">Made with Chameleon Artflow‚Ñ¢</div>
                                            <div class="sub">Stellar Studios</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <p style="text-align:center;font-size:12px;color:var(--dim);margin-bottom:16px">Click card to flip</p>
                            
                            <div class="actions-row">
                                <button class="btn btn-success" onclick="downloadCard()">‚¨áÔ∏è Download</button>
                                <button class="btn btn-secondary" onclick="printCard()">üñ®Ô∏è Print</button>
                                <button class="btn btn-secondary" onclick="emailCard()">üìß Email</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- GALLERY SECTION -->
            <section class="section" id="section-gallery">
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title">üñºÔ∏è Inspiration Gallery</div>
                    </div>
                    <p style="color:var(--dim);margin-bottom:20px">Example cards created with Artflow‚Ñ¢. Click any to use as inspiration.</p>
                    <div class="three-col" id="galleryGrid"></div>
                </div>
            </section>
            
            <!-- HELP SECTION -->
            <section class="section" id="section-help">
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title">‚ùì How to Use Artflow‚Ñ¢</div>
                    </div>
                    
                    <div class="three-col">
                        <div style="padding:20px;text-align:center">
                            <div style="font-size:48px;margin-bottom:12px">‚úèÔ∏è</div>
                            <h4 style="margin-bottom:8px">1. Draw Your Art</h4>
                            <p style="font-size:13px;color:var(--dim)">Sketch a simple shape - flower, heart, sun, tree. Don't worry about perfection!</p>
                        </div>
                        <div style="padding:20px;text-align:center">
                            <div style="font-size:48px;margin-bottom:12px">üé®</div>
                            <h4 style="margin-bottom:8px">2. AI Generates Scene</h4>
                            <p style="font-size:13px;color:var(--dim)">AI recognizes your drawing and creates a full scene with multiple elements, background, and lighting.</p>
                        </div>
                        <div style="padding:20px;text-align:center">
                            <div style="font-size:48px;margin-bottom:12px">üíå</div>
                            <h4 style="margin-bottom:8px">3. Make It a Card</h4>
                            <p style="font-size:13px;color:var(--dim)">Choose card type (Thank You, Invite, etc.), add your message, and download or share!</p>
                        </div>
                    </div>
                    
                    <div style="margin-top:30px">
                        <h4 style="margin-bottom:12px">Card Types Available</h4>
                        <ul style="color:var(--dim);font-size:14px;line-height:2;padding-left:20px">
                            <li>üôè <strong>Thank You</strong> - Express gratitude</li>
                            <li>üëã <strong>Welcome</strong> - New employee, neighbor, member</li>
                            <li>üì® <strong>Invitation</strong> - Parties, events, gatherings</li>
                            <li>üéÇ <strong>Birthday</strong> - Celebrate another year</li>
                            <li>üéÑ <strong>Holiday</strong> - Seasonal greetings</li>
                            <li>üíï <strong>Love</strong> - Valentine's, anniversary</li>
                            <li>üéâ <strong>Congrats</strong> - Achievements, milestones</li>
                            <li>üíí <strong>Wedding</strong> - Invites and congrats</li>
                            <li>üë∂ <strong>Baby</strong> - Announcements and showers</li>
                            <li>üéì <strong>Graduation</strong> - Academic achievements</li>
                            <li>üå∏ <strong>Get Well</strong> - Healing wishes</li>
                            <li>üì¢ <strong>Announcement</strong> - General communications</li>
                            <li>üè¢ <strong>Corporate</strong> - Business communications</li>
                        </ul>
                    </div>
                </div>
            </section>
        </div>
    </main>
    
    <footer>
        <div class="footer-brand">ü¶é Chameleon Studios</div>
        <div class="footer-links">
            <a href="mailto:rayzenart@yahoo.com">Contact</a>
            <a href="#">Privacy</a>
            <a href="#">Terms</a>
        </div>
        <div class="footer-copy">Creative Chameleon Artflow‚Ñ¢ is a trademark of Stellar Studios. All rights reserved. CC BY-NC 4.0</div>
    </footer>
    
    <!-- Email Modal -->
    <div class="modal-overlay" id="emailModal">
        <div class="modal">
            <div class="modal-header">
                üìß Send Card via Email
                <button class="modal-close" onclick="closeModal('emailModal')">√ó</button>
            </div>
            <div class="form-group">
                <label class="form-label">Recipient Email</label>
                <input type="email" class="form-input" id="recipientEmail" placeholder="friend@example.com">
            </div>
            <div class="form-group">
                <label class="form-label">Your Email (optional)</label>
                <input type="email" class="form-input" id="senderEmail" placeholder="you@example.com">
            </div>
            <div class="modal-btns">
                <button class="btn btn-secondary" onclick="closeModal('emailModal')">Cancel</button>
                <button class="btn btn-primary" onclick="sendEmail()">Send Card</button>
            </div>
        </div>
    </div>
    
    <div class="toast" id="toast"></div>

<script>
// =====================================================
// CHAMELEON ARTFLOW‚Ñ¢ - COMPLETE CARD/EVENT GENERATOR
// 100% OFFLINE - NO API CALLS
// =====================================================

(function() {
    'use strict';
    
    // === CONFIG ===
    const CONFIG = {
        contactEmail: 'rayzenart@yahoo.com',
        productName: 'Creative Chameleon Artflow‚Ñ¢'
    };
    
    // === CARD TYPES ===
    const CARD_TYPES = [
        { id: 'thankyou', name: 'Thank You', icon: 'üôè', templates: ['Thank you so much!', 'Your kindness means the world', 'Grateful beyond words', 'Thanks a million!'] },
        { id: 'welcome', name: 'Welcome', icon: 'üëã', templates: ['Welcome to the team!', 'So glad you\'re here', 'Welcome aboard!', 'Happy to have you!'] },
        { id: 'invite', name: 'Invitation', icon: 'üì®', templates: ['You\'re invited!', 'Join us for a celebration', 'We\'d love to have you', 'Please join us'], hasEventFields: true },
        { id: 'birthday', name: 'Birthday', icon: 'üéÇ', templates: ['Happy Birthday!', 'Wishing you the best day', 'Another year of awesome!', 'Make a wish!'] },
        { id: 'holiday', name: 'Holiday', icon: 'üéÑ', templates: ['Happy Holidays!', 'Season\'s Greetings', 'Warmest wishes this season', 'Joy to you and yours'] },
        { id: 'love', name: 'Love', icon: 'üíï', templates: ['I love you', 'You have my heart', 'Forever yours', 'My favorite person'] },
        { id: 'congrats', name: 'Congrats', icon: 'üéâ', templates: ['Congratulations!', 'You did it!', 'So proud of you', 'Well deserved!'] },
        { id: 'wedding', name: 'Wedding', icon: 'üíí', templates: ['Congrats to the happy couple!', 'Wishing you forever', 'Here\'s to love', 'Best wishes always'], hasEventFields: true },
        { id: 'baby', name: 'Baby', icon: 'üë∂', templates: ['Welcome to the world!', 'A star is born', 'Tiny fingers, tiny toes', 'Congratulations!'] },
        { id: 'graduation', name: 'Graduation', icon: 'üéì', templates: ['Congrats, grad!', 'The future is yours', 'You did it!', 'Dream big!'] },
        { id: 'getwell', name: 'Get Well', icon: 'üå∏', templates: ['Get well soon', 'Sending healing thoughts', 'Feel better!', 'Wishing you health'] },
        { id: 'announce', name: 'Announcement', icon: 'üì¢', templates: ['Big news!', 'We\'re excited to share', 'Mark your calendars', 'Important update'] },
        { id: 'corporate', name: 'Corporate', icon: 'üè¢', templates: ['Thank you for your business', 'We appreciate you', 'Looking forward to working together', 'Professional regards'] }
    ];
    
    const COLORS = ['#ffffff','#ff6b6b','#feca57','#48dbfb','#1dd1a1','#a29bfe','#fd79a8','#fdcb6e','#e17055','#636e72'];
    
    // === SHAPE DETECTION ===
    const SHAPES = {
        flower: { variations: ['rose','daisy','tulip','sunflower'], colors: { rose:['#ff6b6b','#e55039'], daisy:['#fff','#feca57'], tulip:['#a29bfe','#6c5ce7'], sunflower:['#f9ca24','#6ab04c'] } },
        heart: { variations: ['romantic','playful','elegant'], colors: { romantic:['#ff6b6b','#c0392b'], playful:['#fd79a8','#e84393'], elegant:['#8B0000','#2c2c54'] } },
        sun: { variations: ['sunrise','sunset','bright'], colors: { sunrise:['#f9ca24','#ee5a24'], sunset:['#e55039','#6c5ce7'], bright:['#f9ca24','#74b9ff'] } },
        tree: { variations: ['oak','pine','cherry','autumn'], colors: { oak:['#6ab04c','#8B4513'], pine:['#2d5a27','#5d4e37'], cherry:['#fd79a8','#6ab04c'], autumn:['#e17055','#f9ca24'] } },
        star: { variations: ['night','magical','golden'], colors: { night:['#f9ca24','#74b9ff'], magical:['#a29bfe','#fd79a8'], golden:['#f9ca24','#f0932b'] } },
        cloud: { variations: ['fluffy','stormy','sunset'], colors: { fluffy:['#fff','#74b9ff'], stormy:['#636e72','#a29bfe'], sunset:['#fd79a8','#f0932b'] } },
        mountain: { variations: ['snowy','forest','misty'], colors: { snowy:['#636e72','#fff'], forest:['#636e72','#6ab04c'], misty:['#636e72','#a29bfe'] } }
    };
    
    // === STATE ===
    let canvas, ctx;
    let isDrawing = false;
    let lastX = 0, lastY = 0;
    let tool = 'pen';
    let color = '#ffffff';
    let size = 4;
    let history = [];
    let historyIdx = -1;
    let hasDrawn = false;
    
    let selectedScene = null;
    let selectedCardType = null;
    let detectedShape = null;
    let cardFlipped = false;
    let sceneCanvases = [];
    
    // === INITIALIZATION ===
    function init() {
        initCanvas();
        renderColors();
        renderCardTypes();
        renderGallery();
        updateSteps(1);
    }
    
    function initCanvas() {
        canvas = document.getElementById('drawCanvas');
        ctx = canvas.getContext('2d');
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        canvas.addEventListener('mousedown', startDraw);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDraw);
        canvas.addEventListener('mouseout', stopDraw);
        canvas.addEventListener('touchstart', handleTouch, {passive:false});
        canvas.addEventListener('touchmove', handleTouchMove, {passive:false});
        canvas.addEventListener('touchend', stopDraw);
    }
    
    function resizeCanvas() {
        const w = canvas.parentElement.offsetWidth;
        const h = w * 0.75;
        canvas.width = w;
        canvas.height = h;
        ctx.fillStyle = '#12121a';
        ctx.fillRect(0, 0, w, h);
        saveHistory();
    }
    
    // === DRAWING ===
    function handleTouch(e) { e.preventDefault(); const t=e.touches[0]; const r=canvas.getBoundingClientRect(); startDraw({offsetX:t.clientX-r.left,offsetY:t.clientY-r.top}); }
    function handleTouchMove(e) { e.preventDefault(); const t=e.touches[0]; const r=canvas.getBoundingClientRect(); draw({offsetX:t.clientX-r.left,offsetY:t.clientY-r.top}); }
    
    function startDraw(e) {
        isDrawing = true;
        lastX = e.offsetX;
        lastY = e.offsetY;
        if (!hasDrawn) {
            hasDrawn = true;
            document.getElementById('canvasHint').classList.add('hidden');
        }
    }
    
    function draw(e) {
        if (!isDrawing) return;
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.strokeStyle = tool === 'eraser' ? '#12121a' : color;
        ctx.lineWidth = tool === 'eraser' ? size * 3 : (tool === 'brush' ? size * 2 : size);
        ctx.globalAlpha = tool === 'brush' ? 0.6 : 1;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.stroke();
        ctx.globalAlpha = 1;
        lastX = e.offsetX;
        lastY = e.offsetY;
    }
    
    function stopDraw() {
        if (isDrawing) { isDrawing = false; saveHistory(); }
    }
    
    function saveHistory() {
        historyIdx++;
        history = history.slice(0, historyIdx);
        history.push(canvas.toDataURL());
    }
    
    window.undo = function() {
        if (historyIdx > 0) {
            historyIdx--;
            const img = new Image();
            img.onload = () => { ctx.clearRect(0,0,canvas.width,canvas.height); ctx.drawImage(img,0,0); };
            img.src = history[historyIdx];
        }
    };
    
    window.clearCanvas = function() {
        // Reset canvas
        ctx.fillStyle = '#12121a';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // Reset history
        history = [];
        historyIdx = -1;
        saveHistory();
        
        // Reset state
        hasDrawn = false;
        isDrawing = false;
        selectedScene = null;
        selectedCardType = null;
        detectedShape = null;
        cardFlipped = false;
        sceneCanvases = [];
        
        // Reset UI
        document.getElementById('canvasHint').classList.remove('hidden');
        document.getElementById('scenesPanel').style.display = 'none';
        document.getElementById('step2-panel').style.display = 'none';
        document.getElementById('step3-panel').style.display = 'none';
        document.getElementById('step4-panel').style.display = 'none';
        document.getElementById('proceedBtn').disabled = true;
        document.getElementById('eventFields').style.display = 'none';
        
        // Clear card type selection
        document.querySelectorAll('.card-type').forEach(c => c.classList.remove('active'));
        
        // Clear form fields
        document.getElementById('cardMessage').value = '';
        document.getElementById('cardTo').value = '';
        document.getElementById('cardFrom').value = '';
        if (document.getElementById('eventDate')) document.getElementById('eventDate').value = '';
        if (document.getElementById('eventTime')) document.getElementById('eventTime').value = '';
        if (document.getElementById('eventLocation')) document.getElementById('eventLocation').value = '';
        if (document.getElementById('eventRSVP')) document.getElementById('eventRSVP').value = '';
        
        // Reset steps
        updateSteps(1);
        
        // Reset generate button text
        document.getElementById('generateBtn').innerHTML = 'üé® Generate Scene from Drawing';
        
        toast('Canvas cleared - start fresh!');
    };
    
    window.setTool = function(t) {
        tool = t;
        document.getElementById('toolPen').classList.toggle('active', t === 'pen');
        document.getElementById('toolBrush').classList.toggle('active', t === 'brush');
        document.getElementById('toolEraser').classList.toggle('active', t === 'eraser');
    };
    
    window.setColor = function(c) {
        color = c;
        renderColors();
    };
    
    window.updateSize = function() {
        size = parseInt(document.getElementById('brushSize').value);
        document.getElementById('sizeLabel').textContent = size + 'px';
    };
    
    function renderColors() {
        let html = '';
        COLORS.forEach(c => {
            const active = c === color ? ' active' : '';
            const border = c === '#ffffff' ? ';border:1px solid #444' : '';
            html += '<div class="color-dot'+active+'" style="background:'+c+border+'" onclick="setColor(\''+c+'\')"></div>';
        });
        document.getElementById('colorPicker').innerHTML = html;
    }
    
    // === SHAPE DETECTION ===
    function analyzeDrawing() {
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;
        let pixels = [];
        let minX = canvas.width, maxX = 0, minY = canvas.height, maxY = 0;
        let totalR = 0, totalG = 0, totalB = 0, colorCount = 0;
        
        for (let y = 0; y < canvas.height; y++) {
            for (let x = 0; x < canvas.width; x++) {
                const i = (y * canvas.width + x) * 4;
                const r = data[i], g = data[i+1], b = data[i+2];
                if (!(r < 30 && g < 30 && b < 40)) {
                    pixels.push({x,y,r,g,b});
                    minX = Math.min(minX, x); maxX = Math.max(maxX, x);
                    minY = Math.min(minY, y); maxY = Math.max(maxY, y);
                    totalR += r; totalG += g; totalB += b; colorCount++;
                }
            }
        }
        
        if (pixels.length < 50) return { detected: false };
        
        const width = maxX - minX;
        const height = maxY - minY;
        const aspectRatio = width / (height || 1);
        const centerX = (minX + maxX) / 2;
        const centerY = (minY + maxY) / 2;
        const avgColor = { r: Math.round(totalR/colorCount), g: Math.round(totalG/colorCount), b: Math.round(totalB/colorCount) };
        
        // Radial detection
        let radialScore = 0;
        pixels.forEach(p => {
            const dist = Math.sqrt((p.x-centerX)**2 + (p.y-centerY)**2);
            const maxDist = Math.max(width, height) / 2;
            if (dist > maxDist * 0.3 && dist < maxDist * 0.9) radialScore++;
        });
        const radialRatio = radialScore / pixels.length;
        
        // Detect shape
        let shape = 'flower';
        let confidence = 0.5;
        
        if (radialRatio > 0.4 && aspectRatio > 0.7 && aspectRatio < 1.4) {
            if (avgColor.r > 200 && avgColor.g > 150) { shape = 'sun'; confidence = 0.7; }
            else { shape = 'flower'; confidence = 0.75; }
        } else if (aspectRatio > 0.8 && aspectRatio < 1.2) {
            if (avgColor.r > avgColor.b && avgColor.r > 150) { shape = 'heart'; confidence = 0.6; }
            else { shape = 'cloud'; confidence = 0.55; }
        } else if (aspectRatio < 0.6) {
            if (avgColor.g > avgColor.r) { shape = 'tree'; confidence = 0.65; }
        } else if (aspectRatio > 1.5) {
            shape = 'mountain'; confidence = 0.55;
        }
        
        const shapeData = SHAPES[shape] || SHAPES.flower;
        const variation = shapeData.variations[Math.floor(Math.random() * shapeData.variations.length)];
        
        return { detected: true, shape, variation, confidence, shapeData, bounds: {minX,maxX,minY,maxY,width,height,centerX,centerY}, avgColor };
    }
    
    // === SCENE GENERATION ===
    window.generateScenes = function() {
        if (!hasDrawn) { toast('Please draw something first!', true); return; }
        
        const analysis = analyzeDrawing();
        if (!analysis.detected) { toast('Draw more to help AI detect the shape', true); return; }
        
        detectedShape = analysis;
        
        // Show detection
        document.getElementById('detectionText').innerHTML = 
            '<strong>Shape:</strong> ' + analysis.shape + ' (' + analysis.variation + ')<br>' +
            '<strong>Confidence:</strong> ' + Math.round(analysis.confidence * 100) + '%<br>' +
            '<strong>Creating:</strong> Full scene with multiple ' + analysis.shape + 's, background, lighting';
        
        document.getElementById('scenesPanel').style.display = 'block';
        
        // Reset scene selection
        selectedScene = null;
        document.getElementById('proceedBtn').disabled = true;
        
        // Generate 4 scenes
        const styles = [
            { name: 'Garden', icon: 'üå∫', style: 'garden' },
            { name: 'Artistic', icon: 'üé®', style: 'artistic' },
            { name: 'Dreamy', icon: '‚ú®', style: 'dreamy' },
            { name: 'Vibrant', icon: 'üåà', style: 'vibrant' }
        ];
        
        let html = '';
        sceneCanvases = [];
        
        styles.forEach((s, i) => {
            html += '<div class="scene-card" id="scene-'+i+'" onclick="selectScene('+i+')">' +
                '<canvas class="scene-canvas" id="sceneCanvas'+i+'"></canvas>' +
                '<div class="scene-label">'+s.icon+' '+s.name+'</div>' +
            '</div>';
        });
        
        document.getElementById('scenesGrid').innerHTML = html;
        
        // Render each scene
        setTimeout(() => {
            styles.forEach((s, i) => {
                const sc = document.getElementById('sceneCanvas'+i);
                sc.width = sc.parentElement.offsetWidth;
                sc.height = sc.width * 0.75;
                sceneCanvases[i] = sc;
                renderScene(sc, analysis, s.style);
            });
        }, 50);
        
        // Update button text
        document.getElementById('generateBtn').innerHTML = 'üîÑ Regenerate Scenes';
        
        updateSteps(1);
        toast('‚ú® 4 scenes generated! Add more to drawing or select a scene.');
    };
    
    function renderScene(canvas, analysis, style) {
        const cx = canvas.getContext('2d');
        const w = canvas.width, h = canvas.height;
        
        // Sky
        const skyGrad = cx.createLinearGradient(0,0,0,h);
        const skies = {
            garden: ['#87CEEB','#B0E0E6','#F0F8FF'],
            artistic: ['#6B8E9F','#A8C8D8','#D4E4EC'],
            dreamy: ['#E8D5E0','#F5E6E8','#FFF5F5'],
            vibrant: ['#4A90D9','#74B9FF','#A8D8FF']
        };
        const skyColors = skies[style];
        skyGrad.addColorStop(0, skyColors[0]);
        skyGrad.addColorStop(0.6, skyColors[1]);
        skyGrad.addColorStop(1, skyColors[2]);
        cx.fillStyle = skyGrad;
        cx.fillRect(0,0,w,h);
        
        // Ground
        if (['flower','tree','heart'].includes(analysis.shape)) {
            const groundGrad = cx.createLinearGradient(0, h*0.7, 0, h);
            groundGrad.addColorStop(0, style === 'vibrant' ? '#4CAF50' : '#7CB342');
            groundGrad.addColorStop(1, style === 'vibrant' ? '#2E7D32' : '#558B2F');
            cx.fillStyle = groundGrad;
            cx.fillRect(0, h*0.65, w, h*0.35);
        }
        
        // Clouds
        if (['flower','sun','bird'].includes(analysis.shape)) {
            cx.fillStyle = 'rgba(255,255,255,0.8)';
            for (let i = 0; i < 3; i++) {
                const cloudX = w*0.1 + i*w*0.35 + Math.random()*30;
                const cloudY = h*0.1 + Math.random()*h*0.1;
                const cloudSize = 20 + Math.random()*25;
                drawCloud(cx, cloudX, cloudY, cloudSize);
            }
        }
        
        // Main elements (multiple)
        const palette = analysis.shapeData.colors[analysis.variation] || ['#ff6b6b','#4CAF50'];
        const count = 4 + Math.floor(Math.random()*4);
        
        for (let i = 0; i < count; i++) {
            const x = w*0.1 + Math.random()*w*0.8;
            const y = h*0.35 + Math.random()*h*0.45;
            const elemSize = 25 + Math.random()*40;
            const elemColor = palette[i % palette.length];
            
            switch(analysis.shape) {
                case 'flower': drawFlower(cx, x, y, elemSize, elemColor, style); break;
                case 'heart': drawHeart(cx, x, y, elemSize, elemColor); break;
                case 'sun': if(i===0) drawSun(cx, w/2, h*0.2, 60, palette[0]); break;
                case 'tree': drawTree(cx, x, h*0.65, elemSize*1.5, palette); break;
                case 'star': drawStar(cx, x, y*0.5, elemSize*0.6, elemColor); break;
                case 'cloud': drawCloud(cx, x, y*0.4, elemSize, 'rgba(255,255,255,0.9)'); break;
                case 'mountain': drawMountain(cx, x, h*0.65, elemSize*3, elemColor); break;
                default: drawFlower(cx, x, y, elemSize, elemColor, style);
            }
        }
        
        // Atmosphere
        if (style === 'dreamy' || style === 'artistic') {
            cx.fillStyle = 'rgba(255,255,255,0.03)';
            cx.fillRect(0,0,w,h);
        }
        
        // Particles
        if (style === 'vibrant' || style === 'dreamy') {
            cx.fillStyle = 'rgba(255,255,255,0.5)';
            for (let i = 0; i < 15; i++) {
                cx.beginPath();
                cx.arc(Math.random()*w, Math.random()*h*0.7, 1+Math.random()*2, 0, Math.PI*2);
                cx.fill();
            }
        }
    }
    
    function drawFlower(cx, x, y, size, color, style) {
        const petals = 5 + Math.floor(Math.random()*3);
        // Stem
        cx.strokeStyle = '#2E7D32';
        cx.lineWidth = size/10;
        cx.beginPath();
        cx.moveTo(x, y);
        cx.quadraticCurveTo(x + size/4, y + size, x, y + size*1.5);
        cx.stroke();
        // Petals
        cx.fillStyle = color;
        for (let i = 0; i < petals; i++) {
            const angle = (i/petals) * Math.PI * 2;
            const px = x + Math.cos(angle) * size*0.4;
            const py = y + Math.sin(angle) * size*0.4;
            cx.beginPath();
            cx.ellipse(px, py, size*0.25, size*0.45, angle, 0, Math.PI*2);
            cx.fill();
        }
        // Center
        cx.fillStyle = '#FDD835';
        cx.beginPath();
        cx.arc(x, y, size*0.18, 0, Math.PI*2);
        cx.fill();
    }
    
    function drawHeart(cx, x, y, size, color) {
        cx.fillStyle = color;
        cx.beginPath();
        cx.moveTo(x, y + size*0.3);
        cx.bezierCurveTo(x, y, x-size*0.5, y, x-size*0.5, y+size*0.3);
        cx.bezierCurveTo(x-size*0.5, y+size*0.6, x, y+size*0.9, x, y+size);
        cx.bezierCurveTo(x, y+size*0.9, x+size*0.5, y+size*0.6, x+size*0.5, y+size*0.3);
        cx.bezierCurveTo(x+size*0.5, y, x, y, x, y+size*0.3);
        cx.fill();
    }
    
    function drawSun(cx, x, y, size, color) {
        const glow = cx.createRadialGradient(x, y, size*0.3, x, y, size);
        glow.addColorStop(0, color);
        glow.addColorStop(0.5, color + '80');
        glow.addColorStop(1, 'transparent');
        cx.fillStyle = glow;
        cx.fillRect(x-size, y-size, size*2, size*2);
        cx.fillStyle = color;
        cx.beginPath();
        cx.arc(x, y, size*0.4, 0, Math.PI*2);
        cx.fill();
        cx.strokeStyle = color;
        cx.lineWidth = size/15;
        for (let i = 0; i < 12; i++) {
            const angle = (i/12)*Math.PI*2;
            cx.beginPath();
            cx.moveTo(x + Math.cos(angle)*size*0.5, y + Math.sin(angle)*size*0.5);
            cx.lineTo(x + Math.cos(angle)*size*0.8, y + Math.sin(angle)*size*0.8);
            cx.stroke();
        }
    }
    
    function drawTree(cx, x, groundY, size, palette) {
        cx.fillStyle = '#5D4037';
        cx.fillRect(x-size*0.08, groundY-size*0.5, size*0.16, size*0.5);
        cx.fillStyle = palette[0] || '#4CAF50';
        [{dx:0,dy:-size*0.6,r:size*0.35},{dx:-size*0.2,dy:-size*0.45,r:size*0.3},{dx:size*0.2,dy:-size*0.45,r:size*0.3},{dx:0,dy:-size*0.8,r:size*0.25}].forEach(p => {
            cx.beginPath();
            cx.arc(x+p.dx, groundY+p.dy, p.r, 0, Math.PI*2);
            cx.fill();
        });
    }
    
    function drawStar(cx, x, y, size, color) {
        cx.fillStyle = color;
        cx.beginPath();
        for (let i = 0; i < 5; i++) {
            const angle = (i*4*Math.PI/5) - Math.PI/2;
            const px = x + Math.cos(angle)*size;
            const py = y + Math.sin(angle)*size;
            if (i === 0) cx.moveTo(px, py);
            else cx.lineTo(px, py);
        }
        cx.closePath();
        cx.fill();
    }
    
    function drawCloud(cx, x, y, size) {
        cx.beginPath();
        cx.arc(x, y, size, 0, Math.PI*2);
        cx.arc(x+size*0.7, y-size*0.2, size*0.7, 0, Math.PI*2);
        cx.arc(x+size*1.2, y, size*0.6, 0, Math.PI*2);
        cx.arc(x-size*0.5, y, size*0.5, 0, Math.PI*2);
        cx.fill();
    }
    
    function drawMountain(cx, x, baseY, size, color) {
        cx.fillStyle = color;
        cx.beginPath();
        cx.moveTo(x-size/2, baseY);
        cx.lineTo(x, baseY-size*0.6);
        cx.lineTo(x+size/2, baseY);
        cx.closePath();
        cx.fill();
        cx.fillStyle = '#fff';
        cx.beginPath();
        cx.moveTo(x-size*0.12, baseY-size*0.45);
        cx.lineTo(x, baseY-size*0.6);
        cx.lineTo(x+size*0.12, baseY-size*0.45);
        cx.closePath();
        cx.fill();
    }
    
    window.selectScene = function(idx) {
        selectedScene = idx;
        document.querySelectorAll('.scene-card').forEach((c,i) => c.classList.toggle('selected', i === idx));
        document.getElementById('proceedBtn').disabled = false;
        toast('Scene ' + (idx+1) + ' selected');
    };
    
    window.keepDrawing = function() {
        // Hide scenes panel, let user continue drawing
        document.getElementById('scenesPanel').style.display = 'none';
        selectedScene = null;
        document.getElementById('proceedBtn').disabled = true;
        
        // Scroll back to canvas
        document.getElementById('step1-panel').scrollIntoView({behavior:'smooth'});
        
        toast('Add more to your drawing, then generate again!');
    };
    
    window.proceedToCardType = function() {
        if (selectedScene === null) { toast('Please select a scene first', true); return; }
        document.getElementById('step2-panel').style.display = 'block';
        updateSteps(2);
        document.getElementById('step2-panel').scrollIntoView({behavior:'smooth'});
    };
    
    // === CARD TYPE ===
    function renderCardTypes() {
        let html = '';
        CARD_TYPES.forEach(ct => {
            html += '<div class="card-type" id="cardType-'+ct.id+'" onclick="selectCardType(\''+ct.id+'\')">' +
                '<div class="card-type-icon">'+ct.icon+'</div>' +
                '<div class="card-type-name">'+ct.name+'</div>' +
            '</div>';
        });
        document.getElementById('cardTypes').innerHTML = html;
    }
    
    window.selectCardType = function(id) {
        selectedCardType = CARD_TYPES.find(ct => ct.id === id);
        document.querySelectorAll('.card-type').forEach(c => c.classList.remove('active'));
        document.getElementById('cardType-'+id).classList.add('active');
        
        // Show/hide event fields
        document.getElementById('eventFields').style.display = selectedCardType.hasEventFields ? 'block' : 'none';
        
        // Show customize panel
        document.getElementById('step3-panel').style.display = 'block';
        document.getElementById('step4-panel').style.display = 'block';
        
        // Render quick templates
        let templatesHtml = '';
        selectedCardType.templates.forEach(t => {
            templatesHtml += '<span class="quick-template" onclick="useTemplate(\''+t.replace(/'/g,"\\'")+'\')">' + t + '</span>';
        });
        document.getElementById('quickTemplates').innerHTML = templatesHtml;
        
        updateSteps(3);
        updatePreview();
        
        document.getElementById('step3-panel').scrollIntoView({behavior:'smooth'});
    };
    
    window.useTemplate = function(t) {
        document.getElementById('cardMessage').value = t;
        updatePreview();
    };
    
    // === PREVIEW ===
    window.updatePreview = function() {
        if (!selectedCardType) return;
        
        const msg = document.getElementById('cardMessage').value || 'Your message here...';
        const to = document.getElementById('cardTo').value;
        const from = document.getElementById('cardFrom').value;
        
        document.getElementById('previewBadge').textContent = selectedCardType.icon + ' ' + selectedCardType.name;
        document.getElementById('previewMessage').textContent = msg;
        document.getElementById('previewTo').textContent = to ? 'Dear ' + to + ',' : '';
        document.getElementById('previewFrom').textContent = from ? '‚Äî ' + from : '';
        
        // Copy scene to card
        if (selectedScene !== null && sceneCanvases[selectedScene]) {
            const sceneDiv = document.getElementById('cardScene');
            sceneDiv.innerHTML = '';
            const previewCanvas = document.createElement('canvas');
            const sourceCanvas = sceneCanvases[selectedScene];
            previewCanvas.width = sourceCanvas.width;
            previewCanvas.height = sourceCanvas.height;
            previewCanvas.getContext('2d').drawImage(sourceCanvas, 0, 0);
            previewCanvas.style.width = '100%';
            previewCanvas.style.height = '100%';
            previewCanvas.style.objectFit = 'cover';
            sceneDiv.appendChild(previewCanvas);
        }
        
        updateSteps(4);
    };
    
    window.flipCard = function() {
        cardFlipped = !cardFlipped;
        document.getElementById('cardPreview').classList.toggle('flipped', cardFlipped);
    };
    
    // === STEP MANAGEMENT ===
    function updateSteps(current) {
        for (let i = 1; i <= 4; i++) {
            const pill = document.getElementById('step'+i+'-pill');
            pill.classList.remove('active', 'done');
            if (i < current) pill.classList.add('done');
            else if (i === current) pill.classList.add('active');
        }
    }
    
    // === ACTIONS ===
    window.downloadCard = function() {
        if (selectedScene === null) { toast('Please complete your card first', true); return; }
        
        // Create high-res export
        const exportCanvas = document.createElement('canvas');
        exportCanvas.width = 800;
        exportCanvas.height = 1120; // 5:7 ratio
        const ex = exportCanvas.getContext('2d');
        
        // Draw scene scaled
        ex.drawImage(sceneCanvases[selectedScene], 0, 0, 800, 1120);
        
        // Draw overlay
        ex.fillStyle = 'rgba(0,0,0,0.4)';
        ex.fillRect(0, 0, 800, 1120);
        
        // Draw text
        ex.fillStyle = '#fff';
        ex.textAlign = 'center';
        ex.font = 'bold 24px sans-serif';
        ex.fillText(selectedCardType.icon + ' ' + selectedCardType.name, 400, 60);
        
        ex.font = 'bold 48px sans-serif';
        const msg = document.getElementById('cardMessage').value || 'Your message';
        wrapText(ex, msg, 400, 500, 700, 56);
        
        ex.font = '24px sans-serif';
        const to = document.getElementById('cardTo').value;
        const from = document.getElementById('cardFrom').value;
        if (to) ex.fillText('Dear ' + to + ',', 100, 1020);
        if (from) { ex.textAlign = 'right'; ex.fillText('‚Äî ' + from, 700, 1060); }
        
        // Download
        const link = document.createElement('a');
        link.download = 'chameleon-card.png';
        link.href = exportCanvas.toDataURL('image/png');
        link.click();
        
        toast('Card downloaded!');
    };
    
    function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
        const words = text.split(' ');
        let line = '';
        let testLine, metrics, testWidth;
        
        for (let n = 0; n < words.length; n++) {
            testLine = line + words[n] + ' ';
            metrics = ctx.measureText(testLine);
            testWidth = metrics.width;
            if (testWidth > maxWidth && n > 0) {
                ctx.fillText(line.trim(), x, y);
                line = words[n] + ' ';
                y += lineHeight;
            } else {
                line = testLine;
            }
        }
        ctx.fillText(line.trim(), x, y);
    }
    
    window.printCard = function() {
        window.print();
        toast('Printing...');
    };
    
    window.emailCard = function() {
        document.getElementById('emailModal').classList.add('open');
    };
    
    window.sendEmail = function() {
        const recipient = document.getElementById('recipientEmail').value;
        if (!recipient || !recipient.includes('@')) { toast('Enter a valid email', true); return; }
        
        const subject = encodeURIComponent(selectedCardType ? selectedCardType.name + ' Card from Chameleon Studios' : 'Card from Chameleon Studios');
        const body = encodeURIComponent(
            'You\'ve received a beautiful card!\n\n' +
            (document.getElementById('cardMessage').value || '') + '\n\n' +
            '---\nCreated with ' + CONFIG.productName + '\nby Stellar Studios'
        );
        
        window.location.href = 'mailto:' + recipient + '?cc=' + CONFIG.contactEmail + '&subject=' + subject + '&body=' + body;
        closeModal('emailModal');
        toast('Opening email...');
    };
    
    // === GALLERY ===
    function renderGallery() {
        const examples = [
            { type: 'thankyou', shape: 'flower', msg: 'Thank you so much!' },
            { type: 'birthday', shape: 'sun', msg: 'Happy Birthday!' },
            { type: 'invite', shape: 'heart', msg: 'You\'re Invited!' },
            { type: 'congrats', shape: 'star', msg: 'Congratulations!' },
            { type: 'welcome', shape: 'tree', msg: 'Welcome!' },
            { type: 'holiday', shape: 'cloud', msg: 'Happy Holidays!' }
        ];
        
        let html = '';
        examples.forEach((ex, i) => {
            const ct = CARD_TYPES.find(c => c.id === ex.type);
            html += '<div class="scene-card" style="cursor:pointer" onclick="toast(\'Draw your own to create!\')">'+
                '<div style="aspect-ratio:4/3;background:linear-gradient(135deg,#87CEEB,#B0E0E6);display:flex;align-items:center;justify-content:center;font-size:64px">'+ct.icon+'</div>'+
                '<div class="scene-label">'+ct.name+' <small>'+ex.msg+'</small></div>'+
            '</div>';
        });
        
        document.getElementById('galleryGrid').innerHTML = html;
    }
    
    // === NAVIGATION ===
    window.showSection = function(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById('section-'+id).classList.add('active');
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.toggle('active', t.dataset.section === id));
    };
    
    window.goHome = function() {
        showSection('create');
    };
    
    // === MODALS ===
    window.closeModal = function(id) {
        document.getElementById(id).classList.remove('open');
    };
    
    // === TOAST ===
    window.toast = function(msg, isError) {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.className = 'toast' + (isError ? ' error' : '');
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 2500);
    };
    
    // === KEYBOARD ===
    document.addEventListener('keydown', e => {
        if (e.key === 'Escape') {
            document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('open'));
        }
    });
    
    // === INIT ===
    document.addEventListener('DOMContentLoaded', init);
})();
</script>
</body>
</html>
